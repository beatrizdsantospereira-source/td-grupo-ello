<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trilha de Aprendizagem T&D - Grupo Ello - v2</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1600px; margin: 0 auto; }
        .login-screen { display: flex; align-items: center; justify-content: center; min-height: 80vh; }
        .login-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 450px; width: 100%; }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h1 { color: #1e3c72; font-size: 28px; margin-bottom: 10px; }
        .login-header p { color: #666; font-size: 14px; }
        .login-tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .login-tab { flex: 1; padding: 12px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s; }
        .login-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; }
        .login-form { display: none; }
        .login-form.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #333; font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .btn-login { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        .btn-login:hover { transform: translateY(-2px); }
        .login-info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #667eea; }
        .login-info h4 { color: #1e3c72; margin-bottom: 8px; font-size: 14px; }
        .login-info p { color: #666; font-size: 13px; line-height: 1.5; }
        .error-message { background: #ff4757; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; }
        .error-message.show { display: block; }
        .header { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header-info h1 { color: #1e3c72; font-size: 24px; margin-bottom: 5px; }
        .header-info p { color: #666; font-size: 13px; }
        .user-badge { background: #f8f9fa; padding: 10px 20px; border-radius: 25px; display: inline-flex; align-items: center; gap: 10px; border: 2px solid #e0e0e0; }
        .user-badge .role { background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; }
        .user-badge .role.admin { background: #ff4757; }
        .user-badge .name { font-weight: bold; color: #333; }
        .mode-toggle { display: flex; gap: 10px; }
        .mode-btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s; }
        .mode-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .mode-btn:not(.active) { background: #e0e0e0; color: #666; }
        .mode-btn.disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-logout { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); text-align: center; }
        .stat-icon { font-size: 32px; margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: bold; color: #1e3c72; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
        .badges-container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin-bottom: 25px; }
        .category-section { margin-bottom: 40px; }
        .category-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #1e3c72; }
        .category-icon { font-size: 36px; }
        .category-info h3 { color: #1e3c72; font-size: 22px; margin-bottom: 5px; }
        .category-info p { color: #666; font-size: 13px; }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .badge { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 15px; text-align: center; transition: all 0.3s; cursor: pointer; border: 3px solid transparent; position: relative; }
        .badge.unlocked { background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); border-color: #ffd700; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4); }
        .badge.unlocked::before { content: '✓'; position: absolute; top: 5px; right: 5px; background: #28a745; color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
        .badge.locked { opacity: 0.5; filter: grayscale(100%); }
        .badge:hover:not(.locked) { transform: translateY(-5px); }
        .badge.read-only { cursor: default; }
        .badge-icon { font-size: 48px; margin-bottom: 10px; }
        .badge-name { font-weight: bold; color: #1e3c72; margin-bottom: 8px; font-size: 14px; }
        .badge.unlocked .badge-name { color: white; }
        .badge-desc { font-size: 12px; color: #666; line-height: 1.4; }
        .badge.unlocked .badge-desc { color: rgba(255,255,255,0.95); }
        .badge-points { background: #1e3c72; color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-top: 10px; display: inline-block; }
        .badge.unlocked .badge-points { background: white; color: #1e3c72; }
        .badge-tag { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: bold; }
        .admin-container { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .admin-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .section-title { color: #1e3c72; font-size: 22px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #1e3c72; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; width: 100%; }
        .btn-primary:hover { transform: translateY(-2px); }
        .list-item { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .list-item-info { flex: 1; }
        .list-item-name { font-weight: bold; color: #333; margin-bottom: 5px; }
        .list-item-details { font-size: 12px; color: #666; }
        .btn-delete { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .btn-secondary { background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-top: 10px; width: 100%; }
        .leaderboard { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .leaderboard-item { display: flex; align-items: center; padding: 20px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px; }
        .leaderboard-position { font-size: 28px; font-weight: bold; color: #1e3c72; margin-right: 20px; min-width: 50px; }
        .leaderboard-position.first { color: #ffd700; }
        .leaderboard-position.second { color: #c0c0c0; }
        .leaderboard-position.third { color: #cd7f32; }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 5px; }
        .leaderboard-badges { font-size: 14px; }
        .leaderboard-points { font-size: 24px; font-weight: bold; color: #1e3c72; }
        .eval-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin-bottom: 25px; }
        .info-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 25px; }
        .info-box strong { color: #856404; }
        .question { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #667eea; }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .question-number { background: #667eea; color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .question-type { background: #e0e0e0; color: #333; padding: 5px 12px; border-radius: 20px; font-size: 11px; }
        .question-text { font-weight: bold; color: #333; margin-bottom: 15px; font-size: 15px; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option { display: flex; align-items: center; padding: 12px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .option:hover { border-color: #667eea; background: #f8f9fa; }
        .option input { margin-right: 10px; cursor: pointer; width: 18px; height: 18px; }
        .option label { cursor: pointer; flex: 1; font-size: 14px; }
        .textarea-answer { width: 100%; min-height: 100px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical; }
        .textarea-answer:focus { outline: none; border-color: #667eea; }
        .result-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 20px; text-align: center; margin-top: 30px; }
        .result-card h2 { font-size: 32px; margin-bottom: 20px; }
        .result-card p { font-size: 18px; margin-bottom: 10px; }
        .score-big { font-size: 72px; font-weight: bold; margin: 20px 0; }
        .btn-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        @media (max-width: 768px) { .admin-container { grid-template-columns: 1fr; } .badges-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); } .header { flex-direction: column; text-align: center; } }
        .login-logo { text-align: center; margin-bottom: 25px; }
        .login-logo img { max-width: 180px; height: auto; }
        
        /* Barra de Progresso */
        .progress-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); margin-bottom: 25px; }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .progress-title { font-size: 18px; font-weight: bold; color: #1e3c72; }
        .progress-percentage { font-size: 24px; font-weight: bold; color: #667eea; }
        .progress-bar-outer { background: #e0e0e0; border-radius: 15px; height: 30px; overflow: hidden; position: relative; }
        .progress-bar-inner { background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #28a745 100%); height: 100%; border-radius: 15px; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; }
        .progress-bar-inner span { color: white; font-weight: bold; font-size: 12px; }
        .progress-details { display: flex; justify-content: space-between; margin-top: 10px; font-size: 13px; color: #666; }
        
        /* Quiz Diário */
        .quiz-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .quiz-modal { background: white; padding: 40px; border-radius: 20px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .quiz-header { text-align: center; margin-bottom: 30px; }
        .quiz-header h2 { color: #1e3c72; font-size: 28px; margin-bottom: 10px; }
        .quiz-header p { color: #666; font-size: 14px; }
        .quiz-streak { background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); color: white; padding: 10px 20px; border-radius: 25px; display: inline-block; margin-bottom: 20px; font-weight: bold; }
        .quiz-question { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #667eea; }
        
        /* ===== TREINAMENTOS PONTUAIS STYLES ===== */
        .pending-training-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 16px;
            padding: 25px;
            color: white;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(238, 90, 36, 0.3);
            animation: pulse-training 2s infinite;
        }
        .pending-training-card.urgent {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            animation: pulse-urgent 1s infinite;
        }
        .pending-training-card.completed {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            animation: none;
        }
        @keyframes pulse-training {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }
        @keyframes pulse-urgent {
            0%, 100% { box-shadow: 0 8px 25px rgba(192, 57, 43, 0.3); }
            50% { box-shadow: 0 8px 35px rgba(192, 57, 43, 0.6); }
        }
        .training-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .training-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .training-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .training-desc {
            opacity: 0.9;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .training-deadline {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .training-deadline-urgent {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 8px;
        }
        .training-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .training-btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
        }
        .training-btn.material {
            background: white;
            color: #ee5a24;
        }
        .training-btn.avaliar {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }
        .training-btn:hover {
            transform: scale(1.05);
        }
        .training-progress {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 8px;
            margin-top: 15px;
            overflow: hidden;
        }
        .training-progress-bar {
            background: white;
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        /* ===== CONTEÚDOS STYLES ===== */
        .content-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .content-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
        }
        .content-icon {
            font-size: 48px;
            flex-shrink: 0;
        }
        .content-info {
            flex: 1;
        }
        .content-title {
            font-size: 18px;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        .content-desc {
            font-size: 14px;
            color: #666;
        }
        .content-actions {
            display: flex;
            gap: 10px;
        }
        .content-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .content-btn.open {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .content-btn.open:hover {
            transform: scale(1.05);
        }
        .content-btn.delete {
            background: #dc3545;
            color: white;
        }
        .content-btn.edit {
            background: #ffc107;
            color: #333;
        }
        .no-content {
            text-align: center;
            padding: 50px;
            color: #999;
        }
        .no-content-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }
        
        /* ===== DASHBOARD ADMIN STYLES ===== */
        .admin-dashboard { display: none; }
        .admin-dashboard.active { display: block; }
        
        .dashboard-welcome {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            border-radius: 20px;
            padding: 35px;
            color: white;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .welcome-text h1 { font-size: 28px; margin-bottom: 8px; }
        .welcome-text p { opacity: 0.9; font-size: 16px; }
        .welcome-stats { display: flex; gap: 40px; flex-wrap: wrap; }
        .welcome-stat { text-align: center; }
        .welcome-stat-value { font-size: 42px; font-weight: bold; }
        .welcome-stat-label { font-size: 13px; opacity: 0.8; }
        
        .priority-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #dc3545;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .priority-section.no-pending { border-left-color: #28a745; }
        .priority-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .priority-title {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .priority-section.no-pending .priority-title { color: #28a745; }
        .priority-count {
            background: #dc3545;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .priority-section.no-pending .priority-count { background: #28a745; }
        
        .priority-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .priority-item {
            background: #fff8f8;
            border: 1px solid #ffcdd2;
            border-radius: 12px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            flex-wrap: wrap;
        }
        .priority-item:hover {
            background: #ffebee;
            transform: translateX(5px);
        }
        .priority-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        .priority-info { flex: 1; min-width: 150px; }
        .priority-name { font-weight: 600; color: #333; }
        .priority-detail { font-size: 13px; color: #666; margin-top: 3px; }
        .priority-meta { font-size: 11px; color: #999; margin-top: 5px; }
        .priority-action {
            background: #1e3c72;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
        }
        .priority-action:hover { background: #2a5298; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }
        
        .kpi-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        @media (max-width: 600px) {
            .kpi-grid { grid-template-columns: 1fr; }
        }
        .kpi-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }
        .kpi-card.purple::before { background: #667eea; }
        .kpi-card.green::before { background: #28a745; }
        .kpi-card.orange::before { background: #fd7e14; }
        .kpi-card.blue::before { background: #17a2b8; }
        .kpi-label { font-size: 13px; color: #666; margin-bottom: 8px; }
        .kpi-value { font-size: 32px; font-weight: bold; color: #1e3c72; }
        
        .team-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            background: #f0f0f0;
            border: 2px solid transparent;
            transition: all 0.3s;
            font-size: 13px;
        }
        .filter-btn:hover { background: #e0e0e0; }
        .filter-btn.active {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
        }
        .filter-btn .count {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }
        .filter-btn.active .count { background: rgba(255,255,255,0.2); }
        
        .team-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .team-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
        }
        .team-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        .team-card-header {
            padding: 20px;
            color: white;
            position: relative;
        }
        .team-card-header.poli { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .team-card-header.esalq { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .team-card-header.mackenzie { background: linear-gradient(135deg, #667eea, #764ba2); }
        .team-card-header.eca { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .team-card-header.b2c { background: linear-gradient(135deg, #fa709a, #fee140); }
        .team-card-header.backoffice { background: linear-gradient(135deg, #30cfd0, #330867); }
        .team-card-title { font-size: 18px; font-weight: bold; }
        .team-card-subtitle { font-size: 13px; opacity: 0.9; margin-top: 3px; }
        .team-card-count {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 32px;
            font-weight: bold;
            opacity: 0.3;
        }
        .team-card-body { padding: 20px; }
        .team-card-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        .team-card-stat:last-child { border-bottom: none; }
        .team-stat-label { color: #666; }
        .team-stat-value { font-weight: 600; color: #333; }
        .team-stat-value.pending { color: #dc3545; }
        .team-stat-value.success { color: #28a745; }
        
        .quick-actions-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            padding: 15px;
            background: #f8f9fa;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s;
            text-align: left;
        }
        .quick-action-btn:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        .quick-action-btn:last-child { margin-bottom: 0; }
        .action-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        .action-icon.purple { background: #ede7f6; }
        .action-icon.green { background: #e8f5e9; }
        .action-icon.blue { background: #e3f2fd; }
        .action-icon.orange { background: #fff3e0; }
        .action-icon.pink { background: #fce4ec; }
        .action-text { flex: 1; }
        .action-title { font-weight: 600; color: #333; font-size: 15px; }
        .action-desc { font-size: 12px; color: #666; margin-top: 2px; }
        .action-arrow { color: #999; font-size: 18px; }
        
        .activity-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .activity-list { max-height: 350px; overflow-y: auto; }
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-top: 5px;
            flex-shrink: 0;
        }
        .activity-dot.eval { background: #667eea; }
        .activity-dot.badge { background: #28a745; }
        .activity-dot.quiz { background: #fd7e14; }
        .activity-dot.new { background: #17a2b8; }
        .activity-content { flex: 1; }
        .activity-text { color: #333; font-size: 14px; }
        .activity-text strong { color: #1e3c72; }
        .activity-time { font-size: 12px; color: #999; margin-top: 3px; }
        
        .section-header-dash {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .section-title-dash {
            font-size: 18px;
            font-weight: bold;
            color: #1e3c72;
        }
        .section-link {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        }
        .section-link:hover { text-decoration: underline; }
        
        .detail-panel {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .detail-panel.active { display: block; }
        .detail-back-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .detail-back-btn:hover { text-decoration: underline; }
        
        .eval-details-container { margin-top: 20px; }
        .quiz-question-text { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 20px; }
        .quiz-options { display: flex; flex-direction: column; gap: 12px; }
        .quiz-option { padding: 15px 20px; background: white; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-size: 15px; }
        .quiz-option:hover { border-color: #667eea; background: #f8f9fa; }
        .quiz-option.selected { border-color: #667eea; background: #667eea; color: white; }
        .quiz-option.correct { border-color: #28a745; background: #28a745; color: white; }
        .quiz-option.incorrect { border-color: #dc3545; background: #dc3545; color: white; }
        .quiz-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: transform 0.2s; }
        .quiz-btn:hover { transform: translateY(-2px); }
        .quiz-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .quiz-result { text-align: center; padding: 30px; }
        .quiz-result-icon { font-size: 80px; margin-bottom: 20px; }
        .quiz-result h3 { font-size: 24px; margin-bottom: 10px; }
        .quiz-result p { color: #666; font-size: 16px; margin-bottom: 20px; }
        .quiz-points { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 15px 30px; border-radius: 25px; font-size: 20px; font-weight: bold; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-screen" class="login-screen">
            <div class="login-card">
<div class="login-logo">
                    <img src="data:image/jpeg;base64,
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" alt="Grupo Ello">
                </div>
                <div class="login-header">
                    <h1>🏆 Trilha de Aprendizagem T&D</h1>
                    <p>Grupo Ello - T&D</p>
                </div>
                <div class="login-tabs">
                    <div class="login-tab active" onclick="switchLoginTab('employee')">👤 Colaborador</div>
                    <div class="login-tab" onclick="switchLoginTab('admin')">🔐 Admin</div>
                </div>
                <div class="error-message" id="error-message"></div>
                <form id="employee-form" class="login-form active" onsubmit="loginEmployee(event)">
                    <div class="form-group">
                        <label>Código de Acesso:</label>
                        <input type="text" id="employee-code" placeholder="Ex: MARIA202501" style="text-transform: uppercase;" required>
                    </div>
                    <button type="submit" class="btn-login">👁️ Ver Meu Progresso</button>
                    <div class="login-info">
                        <h4>💡 Como obter seu código?</h4>
                        <p>Seu código de acesso é fornecido pelo setor de T&D. Se você não possui, entre em contato com o RH.</p>
                    </div>
                </form>
                <form id="admin-form" class="login-form" onsubmit="loginAdmin(event)">
                    <div class="form-group">
                        <label>Usuário:</label>
                        <input type="text" id="admin-username" required>
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="admin-password" required>
                    </div>
                    <button type="submit" class="btn-login">🔓 Entrar</button>
                </form>
            </div>
        </div>
        
        <div id="main-system" style="display: none;">
            <div class="header">
                <div class="header-info">
                    <h1>🏆 Trilha de Aprendizagem T&D</h1>
                    <p>Sistema Completo: Badges + Avaliações</p>
                </div>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <div class="user-badge">
                        <span class="role" id="user-role">-</span>
                        <span class="name" id="user-name">-</span>
                    </div>
                    <div class="mode-toggle">
                        <button class="mode-btn active" id="badges-btn" onclick="switchMode('view')">👁️ Badges</button>
                        <button class="mode-btn" onclick="switchMode('content')">📚 Conteúdos</button>
                        <button class="mode-btn" onclick="switchMode('eval')">📝 Avaliações</button>
                        <button class="mode-btn disabled" id="admin-btn" onclick="switchMode('admin')">⚙️ Admin</button>
                    </div>
                    <button class="btn-logout" onclick="logout()">🚪 Sair</button>
                </div>
            </div>
            
            <div id="view-mode" class="view-section active">
                <!-- TREINAMENTOS PONTUAIS PENDENTES -->
                <div id="pending-trainings-container" style="display:none;margin-bottom:25px;"></div>
                
                <!-- Barra de Progresso -->
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-title">🎯 Seu Progresso na Trilha</span>
                        <span class="progress-percentage" id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar-outer">
                        <div class="progress-bar-inner" id="progress-bar" style="width: 0%;">
                            <span id="progress-bar-text"></span>
                        </div>
                    </div>
                    <div class="progress-details">
                        <span id="progress-badges">0 de 0 badges</span>
                        <span id="progress-points">0 de 0 pontos</span>
                    </div>
                </div>
                
                <!-- Quiz Diário Progress -->
                <div class="quiz-progress-card" id="quiz-progress-card" style="background:white;padding:20px;border-radius:15px;margin-bottom:25px;box-shadow:0 5px 20px rgba(0,0,0,0.1);">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                        <h3 style="color:#1e3c72;margin:0;">🎯 Quiz Diário</h3>
                        <button class="btn-primary" id="quiz-play-btn" onclick="showDailyQuiz()" style="padding:8px 16px;width:auto;">▶️ Responder Quiz</button>
                    </div>
                    <div id="quiz-user-progress"></div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">⭐</div><div class="stat-value" id="total-points">0</div><div class="stat-label">Pontos</div></div>
                    <div class="stat-card"><div class="stat-icon">🏅</div><div class="stat-value" id="badges-count">0/0</div><div class="stat-label">Badges</div></div>
                    <div class="stat-card"><div class="stat-icon">📊</div><div class="stat-value" id="completion">0%</div><div class="stat-label">Progresso</div></div>
                </div>
                <div class="badges-container" id="badges-container"></div>
            </div>
            
            <div id="eval-mode" class="view-section">
                <div class="eval-card">
                    <h2 class="section-title">📝 Sistema de Avaliações</h2>
                    <div class="info-box">
                        <strong>⚠️ ATENÇÃO:</strong> Os resultados serão mostrados após o envio das respostas!
                    </div>
                    <div id="eval-buttons"></div>
                </div>
                <div id="eval-content"></div>
            </div>
            
            <!-- SEÇÃO DE CONTEÚDOS -->
            <div id="content-mode" class="view-section">
                <div class="eval-card">
                    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;margin-bottom:20px;">
                        <h2 class="section-title" style="margin:0;border:none;padding:0;">📚 Conteúdos do Treinamento</h2>
                        <button id="add-content-btn" class="btn-primary" style="width:auto;display:none;" onclick="showAddContentForm()">➕ Adicionar Conteúdo</button>
                    </div>
                    <p style="color:#666;margin-bottom:25px;">Acesse os materiais de apoio para o seu treinamento.</p>
                    
                    <!-- Formulário de Adicionar (só admin) -->
                    <div id="add-content-form" style="display:none;background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:25px;border:2px dashed #667eea;">
                        <h3 style="color:#1e3c72;margin-bottom:15px;">➕ Novo Conteúdo</h3>
                        <div class="form-group">
                            <label>Título do Conteúdo</label>
                            <input type="text" id="content-title" placeholder="Ex: Manual do Colaborador B2B">
                        </div>
                        <div class="form-group">
                            <label>Descrição (opcional)</label>
                            <input type="text" id="content-desc" placeholder="Ex: Guia completo com informações importantes">
                        </div>
                        <div class="form-group">
                            <label>Link do PDF/Documento</label>
                            <input type="text" id="content-url" placeholder="https://drive.google.com/... ou link direto do PDF">
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
                            <div class="form-group">
                                <label>Função</label>
                                <select id="content-function">
                                    <option value="Todos">📌 Todos</option>
                                    <option value="B2B">🏢 B2B</option>
                                    <option value="B2C">🛒 B2C</option>
                                    <option value="Backoffice">⚙️ Backoffice</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Marca</label>
                                <select id="content-brand">
                                    <option value="Todas">📌 Todas</option>
                                    <option value="POLI">🔵 POLI</option>
                                    <option value="ESALQ/PECEGE">🟡 ESALQ/PECEGE</option>
                                    <option value="MACKENZIE">🔴 MACKENZIE</option>
                                    <option value="ECA USP">🟣 ECA USP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ícone</label>
                                <select id="content-icon">
                                    <option value="📄">📄 Documento</option>
                                    <option value="📕">📕 Manual</option>
                                    <option value="📗">📗 Guia</option>
                                    <option value="📘">📘 Apostila</option>
                                    <option value="📋">📋 Checklist</option>
                                    <option value="📊">📊 Planilha</option>
                                    <option value="🎯">🎯 Objetivos</option>
                                    <option value="💡">💡 Dicas</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button class="btn-primary" onclick="addContent()">✅ Salvar</button>
                            <button class="btn-secondary" onclick="hideAddContentForm()">❌ Cancelar</button>
                        </div>
                    </div>
                    
                    <!-- Formulário de Editar (só admin) -->
                    <div id="edit-content-form" style="display:none;background:#fff3cd;padding:20px;border-radius:12px;margin-bottom:25px;border:2px solid #ffc107;">
                        <h3 style="color:#856404;margin-bottom:15px;">✏️ Editar Conteúdo</h3>
                        <input type="hidden" id="edit-content-idx">
                        <div class="form-group">
                            <label>Título do Conteúdo</label>
                            <input type="text" id="edit-content-title" placeholder="Ex: Manual do Colaborador B2B">
                        </div>
                        <div class="form-group">
                            <label>Descrição (opcional)</label>
                            <input type="text" id="edit-content-desc" placeholder="Ex: Guia completo com informações importantes">
                        </div>
                        <div class="form-group">
                            <label>Link do PDF/Documento</label>
                            <input type="text" id="edit-content-url" placeholder="https://drive.google.com/... ou link direto do PDF">
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
                            <div class="form-group">
                                <label>Função</label>
                                <select id="edit-content-function">
                                    <option value="Todos">📌 Todos</option>
                                    <option value="B2B">🏢 B2B</option>
                                    <option value="B2C">🛒 B2C</option>
                                    <option value="Backoffice">⚙️ Backoffice</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Marca</label>
                                <select id="edit-content-brand">
                                    <option value="Todas">📌 Todas</option>
                                    <option value="POLI">🔵 POLI</option>
                                    <option value="ESALQ/PECEGE">🟡 ESALQ/PECEGE</option>
                                    <option value="MACKENZIE">🔴 MACKENZIE</option>
                                    <option value="ECA USP">🟣 ECA USP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ícone</label>
                                <select id="edit-content-icon">
                                    <option value="📄">📄 Documento</option>
                                    <option value="📕">📕 Manual</option>
                                    <option value="📗">📗 Guia</option>
                                    <option value="📘">📘 Apostila</option>
                                    <option value="📋">📋 Checklist</option>
                                    <option value="📊">📊 Planilha</option>
                                    <option value="🎯">🎯 Objetivos</option>
                                    <option value="💡">💡 Dicas</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button class="btn-primary" style="background:linear-gradient(135deg, #ffc107, #ff8f00);" onclick="saveEditContent()">✅ Salvar Alterações</button>
                            <button class="btn-secondary" onclick="hideEditContentForm()">❌ Cancelar</button>
                        </div>
                    </div>
                    
                    <!-- Lista de Conteúdos -->
                    <div id="content-list"></div>
                </div>
            </div>
            
            <div id="admin-mode" class="view-section">
                <!-- DASHBOARD PRINCIPAL -->
                <div id="admin-dashboard" class="admin-dashboard active">
                    <!-- Welcome Section -->
                    <div class="dashboard-welcome">
                        <div class="welcome-text">
                            <h1 id="welcome-greeting">Bom dia! 👋</h1>
                            <p id="welcome-message">Carregando informações...</p>
                        </div>
                        <div class="welcome-stats">
                            <div class="welcome-stat">
                                <div class="welcome-stat-value" id="dash-total-colab">0</div>
                                <div class="welcome-stat-label">Colaboradores</div>
                            </div>
                            <div class="welcome-stat">
                                <div class="welcome-stat-value" id="dash-taxa-aprovacao">0%</div>
                                <div class="welcome-stat-label">Aprovação</div>
                            </div>
                            <div class="welcome-stat">
                                <div class="welcome-stat-value" id="dash-total-badges">0</div>
                                <div class="welcome-stat-label">Badges</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Priority Section -->
                    <div class="priority-section" id="priority-section">
                        <div class="priority-header">
                            <div class="priority-title" id="priority-title">🚨 Requer sua atenção</div>
                            <span class="priority-count" id="priority-count">0 pendências</span>
                        </div>
                        <div class="priority-list" id="priority-list">
                            <!-- Preenchido via JS -->
                        </div>
                    </div>
                    
                    <!-- Dashboard Grid -->
                    <div class="dashboard-grid">
                        <!-- Left Column -->
                        <div>
                            <!-- KPIs -->
                            <div class="kpi-section">
                                <div class="section-header-dash">
                                    <div class="section-title-dash">📊 Indicadores de Performance</div>
                                </div>
                                <div class="kpi-grid">
                                    <div class="kpi-card purple">
                                        <div class="kpi-label">Avaliações Concluídas</div>
                                        <div class="kpi-value" id="kpi-avaliacoes">0</div>
                                    </div>
                                    <div class="kpi-card green">
                                        <div class="kpi-label">Taxa de Aprovação</div>
                                        <div class="kpi-value" id="kpi-aprovacao">0%</div>
                                    </div>
                                    <div class="kpi-card orange">
                                        <div class="kpi-label">Média Geral</div>
                                        <div class="kpi-value" id="kpi-media">0%</div>
                                    </div>
                                    <div class="kpi-card blue">
                                        <div class="kpi-label">Quiz Completados</div>
                                        <div class="kpi-value" id="kpi-quiz">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Team Filter + Cards -->
                            <div class="kpi-section">
                                <div class="section-header-dash">
                                    <div class="section-title-dash">👥 Equipes</div>
                                    <span class="section-link" onclick="showAllTrainees()">Ver todos colaboradores →</span>
                                </div>
                                <div class="team-filter" id="team-filter">
                                    <button class="filter-btn active" data-filter="all">Todas <span class="count" id="filter-all-count">0</span></button>
                                    <button class="filter-btn" data-filter="b2b">B2B <span class="count" id="filter-b2b-count">0</span></button>
                                    <button class="filter-btn" data-filter="b2c">B2C <span class="count" id="filter-b2c-count">0</span></button>
                                    <button class="filter-btn" data-filter="backoffice">Backoffice <span class="count" id="filter-back-count">0</span></button>
                                </div>
                                <div class="team-cards-grid" id="team-cards-grid">
                                    <!-- Preenchido via JS -->
                                </div>
                            </div>
                            
                            <!-- Activity Section -->
                            <div class="activity-section">
                                <div class="section-header-dash">
                                    <div class="section-title-dash">🕐 Atividade Recente</div>
                                </div>
                                <div class="activity-list" id="activity-list">
                                    <!-- Preenchido via JS -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div>
                            <div class="quick-actions-panel">
                                <div class="section-header-dash">
                                    <div class="section-title-dash">⚡ Ações Rápidas</div>
                                </div>
                                
                                <button class="quick-action-btn" onclick="showPendingCorrections()">
                                    <div class="action-icon purple">📝</div>
                                    <div class="action-text">
                                        <div class="action-title">Corrigir Avaliações</div>
                                        <div class="action-desc" id="pending-corrections-count">0 pendentes</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                                
                                <button class="quick-action-btn" onclick="showPunctualTrainingsPanel()">
                                    <div class="action-icon" style="background:#ffebee;">🎯</div>
                                    <div class="action-text">
                                        <div class="action-title">Treinamentos Pontuais</div>
                                        <div class="action-desc" id="punctual-trainings-count">Criar e gerenciar</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                                
                                <button class="quick-action-btn" onclick="showBadgesPanel()">
                                    <div class="action-icon green">🏅</div>
                                    <div class="action-text">
                                        <div class="action-title">Atribuir Badges</div>
                                        <div class="action-desc">Reconhecer conquistas</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                                
                                <button class="quick-action-btn" onclick="showAddTraineePanel()">
                                    <div class="action-icon blue">👤</div>
                                    <div class="action-text">
                                        <div class="action-title">Novo Colaborador</div>
                                        <div class="action-desc">Cadastrar acesso</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                                
                                <button class="quick-action-btn" onclick="showAllTrainees()">
                                    <div class="action-icon orange">👥</div>
                                    <div class="action-text">
                                        <div class="action-title">Gerenciar Colaboradores</div>
                                        <div class="action-desc">Ver e editar cadastros</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                                
                                <button class="quick-action-btn" onclick="exportAllReports()">
                                    <div class="action-icon pink">📊</div>
                                    <div class="action-text">
                                        <div class="action-title">Relatórios</div>
                                        <div class="action-desc">Exportar dados</div>
                                    </div>
                                    <span class="action-arrow">→</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- PAINEL DE DETALHES (gerenciar colaborador, badges, etc) -->
                <div id="detail-panel" class="detail-panel">
                    <button class="detail-back-btn" onclick="backToDashboard()">← Voltar ao Dashboard</button>
                    <div id="detail-content"></div>
                </div>
                
                <!-- Container para detalhes de avaliação -->
                <div id="eval-details-container" class="eval-details-container"></div>
            </div>
        </div>
        
        <!-- Modal Quiz Diário -->
        <div id="quiz-overlay" class="quiz-overlay" style="display: none;">
            <div class="quiz-modal">
                <div id="quiz-content"></div>
            </div>
        </div>
    </div>
    <script>
// ========== FIREBASE CONFIG ==========
let db = null;
let useFirebase = false;
let unsubscribeTrainees = null;

const FIREBASE_CONFIG = {"apiKey":"AIzaSyAnNHt38voyE5BrTdb3aoa9TWa1qO200RQ","authDomain":"td-grupo-ello-2026.firebaseapp.com","projectId":"td-grupo-ello-2026","storageBucket":"td-grupo-ello-2026.firebasestorage.app","messagingSenderId":"730370049526","appId":"1:730370049526:web:cd60a1385700587082f3d7","measurementId":"G-M558R3EL5H"};

function initFirebase() {
    return new Promise((resolve) => {
        if (typeof firebase === 'undefined') {
            console.log('Firebase não disponível, usando localStorage');
            resolve(false);
            return;
        }
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(FIREBASE_CONFIG);
            }
            db = firebase.firestore();
            db.collection('_test').doc('_ping').set({t: new Date().toISOString()})
                .then(() => {
                    console.log('Firebase conectado!');
                    resolve(true);
                })
                .catch(e => {
                    console.log('Erro Firebase:', e.message);
                    resolve(false);
                });
        } catch(e) {
            console.log('Erro init Firebase:', e);
            resolve(false);
        }
    });
}

// ========== DADOS ==========
const badgeCategories = {
'ECA USP':{icon:'🎓',name:'ECA USP',description:'Escola de Comunicações e Artes',badges:[
{id:'eca_lato',icon:'📚',name:'Lato vs Stricto',desc:'Diferencia tipos de pós-graduação',points:30},
{id:'eca1',icon:'🎨',name:'Expert ECA',desc:'História e estrutura da ECA',points:50},
{id:'eca2',icon:'📊',name:'Mestre BI',desc:'Business Intelligence e Analytics',points:40},
{id:'eca3',icon:'💻',name:'Marketing Digital',desc:'Comunicação e Marketing Digital',points:40},
{id:'eca4',icon:'🤖',name:'IA Negócios',desc:'Inteligência Artificial',points:40}]},
'ESALQ/PECEGE':{icon:'🌱',name:'ESALQ/PECEGE',description:'USP Piracicaba',badges:[
{id:'esalq_lato',icon:'📚',name:'Lato vs Stricto',desc:'Diferencia tipos de pós-graduação',points:30},
{id:'esalq1',icon:'🏛️',name:'História Esalq',desc:'1901 até integração USP',points:50},
{id:'esalq2',icon:'🌾',name:'Agronegócio',desc:'MBA em Agronegócios',points:40},
{id:'esalq3',icon:'🌍',name:'ESG',desc:'Compliance e Sustentabilidade',points:40},
{id:'esalq4',icon:'💹',name:'Finanças',desc:'Banking e Investimentos',points:40}]},
'MACKENZIE':{icon:'🏛️',name:'MACKENZIE',description:'150 anos de tradição',badges:[
{id:'mack_lato',icon:'📚',name:'Lato vs Stricto',desc:'Diferencia tipos de pós-graduação',points:30},
{id:'mack1',icon:'⛪',name:'História',desc:'150 anos Mackenzie',points:50},
{id:'mack2',icon:'🎓',name:'MBA Expert',desc:'Estrutura MBA',points:40},
{id:'mack3',icon:'🏢',name:'Multi-Campus',desc:'Todas as unidades',points:30}]},
'POLI':{icon:'🔧',name:'POLI',description:'Escola Politécnica USP',badges:[
{id:'poli_lato',icon:'📚',name:'Lato vs Stricto',desc:'Diferencia tipos de pós-graduação',points:30},
{id:'poli1',icon:'⚙️',name:'Expert Poli',desc:'Conhece Poli USP Pro',points:50},
{id:'poli2',icon:'🏭',name:'Eng. Produção',desc:'MBA Engenharia',points:40},
{id:'poli3',icon:'🏗️',name:'Vanzolini',desc:'Fundação Vanzolini',points:40},
{id:'poli4',icon:'📊',name:'Data Science',desc:'Analytics para Operações',points:40}]},
'B2B - Técnicas de Vendas':{icon:'🎯',name:'B2B - Técnicas de Vendas',description:'Habilidades comerciais',isB2B:true,badges:[
{id:'b2b_funcoes',icon:'📋',name:'Funções Vendedor B2B',desc:'Funções e atribuições do vendedor',points:35},
{id:'b2b_rotina',icon:'🕐',name:'Rotina de Vendas',desc:'Apresentação da rotina de vendas',points:35},
{id:'b2b_etapas',icon:'📊',name:'Etapas Prospecção',desc:'Etapas de prospecção',points:40},
{id:'b2b_spin',icon:'🗣️',name:'SPIN Selling',desc:'Técnicas de Vendas - SPIN',points:50},
{id:'b2b_escuta',icon:'👂',name:'Escuta Ativa',desc:'Técnicas de Vendas - Escuta ativa',points:45},
{id:'b2b_rapport',icon:'🤝',name:'Rapport',desc:'Técnicas de Vendas - Rapport',points:45}]},
'B2B - Sistema iEllo':{icon:'💻',name:'B2B - Sistema iEllo',description:'Operação no sistema',isB2B:true,badges:[
{id:'b2b_sist_prosp',icon:'💻',name:'Sistema Prospecção',desc:'Treinamento no sistema (prospecção)',points:40},
{id:'b2b_fluxo_prosp',icon:'🔄',name:'Fluxo Prospecção iEllo',desc:'Fluxo de prospecção no iEllo',points:40},
{id:'b2b_filtros',icon:'🔍',name:'Filtros Central',desc:'Filtros da central de atendimento',points:35},
{id:'b2b_historico',icon:'📝',name:'Inserção Histórico',desc:'Treinamento de inserção de histórico',points:30},
{id:'b2b_follow',icon:'📆',name:'Agendamento Follow',desc:'Treinamento de agendamento de follow',points:35},
{id:'b2b_agenda',icon:'📅',name:'Consulta Agenda',desc:'Consulta de agenda no iEllo',points:30},
{id:'b2b_emp_perdida',icon:'❌',name:'Empresa Perdida',desc:'Treinamento de empresa perdida',points:30}]},
'B2B - E-mails':{icon:'📧',name:'B2B - E-mails',description:'Comunicação por e-mail',isB2B:true,badges:[
{id:'b2b_email_modelo',icon:'📧',name:'E-mail Modelos',desc:'Envio de e-mail - modelos prontos',points:30},
{id:'b2b_email_anexo',icon:'📎',name:'E-mail com Anexo',desc:'Envio de e-mail com anexo',points:30},
{id:'b2b_dir_email',icon:'📬',name:'Direcionamento E-mails',desc:'Direcionamento de e-mails',points:30},
{id:'b2b_email_lead',icon:'📧',name:'E-mail Lead',desc:'Envio de e-mail - lead',points:30}]},
'B2B - Reuniões':{icon:'👥',name:'B2B - Reuniões',description:'Gestão de reuniões',isB2B:true,badges:[
{id:'b2b_ag_reuniao',icon:'🗓️',name:'Agendamento Reunião',desc:'Treinamento de agendamento de reunião',points:35},
{id:'b2b_reg_reuniao',icon:'✍️',name:'Registro Reunião',desc:'Treinamento de registro de reunião',points:35},
{id:'b2b_reunioes',icon:'👥',name:'Treinamento Reuniões',desc:'Treinamento de reuniões',points:40},
{id:'b2b_prep_reuniao',icon:'📋',name:'Preparação Reunião',desc:'Preparação para reunião',points:35},
{id:'b2b_perfis_rh',icon:'👤',name:'Perfis de RH',desc:'Treinamento de perfis de RH',points:35},
{id:'b2b_plan_reuniao',icon:'📝',name:'Planejamento Reunião',desc:'Planejamento de reunião',points:35},
{id:'b2b_pos_reuniao',icon:'✅',name:'Pós Reunião',desc:'Registro, envio de materiais, etc',points:40},
{id:'b2b_simul_reuniao',icon:'🎭',name:'Simulação Reuniões',desc:'Simulação de reuniões',points:45}]},
'B2B - Ligações':{icon:'📞',name:'B2B - Ligações',description:'Atendimento telefônico',isB2B:true,badges:[
{id:'b2b_ligacoes',icon:'📞',name:'Treinamento Ligações',desc:'Treinamento de ligações',points:35},
{id:'b2b_reg_ligacoes',icon:'📱',name:'Registro Ligações',desc:'Treinamento de registro de ligações',points:30},
{id:'b2b_reg_whats',icon:'💬',name:'Registro WhatsApp',desc:'Registro de WhatsApp, ligação e histórico',points:35}]},
'B2B - Divulgação':{icon:'📢',name:'B2B - Divulgação',description:'Marketing e divulgação',isB2B:true,badges:[
{id:'b2b_divulgacao',icon:'📢',name:'Treinamento Divulgação',desc:'Treinamento de divulgação',points:35},
{id:'b2b_peca_divulg',icon:'🎨',name:'Montagem Peça',desc:'Montagem de peça de divulgação',points:35},
{id:'b2b_reg_divulg',icon:'📋',name:'Registro Divulgação',desc:'Registro de divulgação no sistema',points:30},
{id:'b2b_cont_divulg',icon:'🔁',name:'Continuação Divulgação',desc:'Continuação da divulgação',points:30},
{id:'b2b_concl_divulg',icon:'✅',name:'Conclusão Divulgação',desc:'Conclusão da divulgação',points:30}]},
'B2B - Plantão':{icon:'🏥',name:'B2B - Plantão',description:'Gestão de plantões',isB2B:true,badges:[
{id:'b2b_ag_plantao',icon:'🏥',name:'Agendamento Plantão',desc:'Treinamento de agendamento de plantão',points:35},
{id:'b2b_reg_plantao',icon:'📝',name:'Registro Plantão',desc:'Treinamento de registro de plantão',points:30},
{id:'b2b_leads_plantao',icon:'👥',name:'Leads do Plantão',desc:'Inserção de leads do plantão',points:35},
{id:'b2b_reembolso',icon:'💰',name:'Solicitação Reembolso',desc:'Treinamento de solicitação de reembolso',points:30}]},
'B2B - Leads':{icon:'🎯',name:'B2B - Leads',description:'Gestão de leads',isB2B:true,badges:[
{id:'b2b_ins_leads',icon:'➕',name:'Inserção de Leads',desc:'Treinamento de inserção de leads',points:35},
{id:'b2b_fluxo_leads',icon:'🔄',name:'Fluxo de Leads',desc:'Treinamento de fluxo de leads',points:40},
{id:'b2b_lead_site',icon:'🌐',name:'Lead Site Escola',desc:'Fluxo de lead no site da escola',points:35},
{id:'b2b_lead_iello',icon:'💻',name:'Lead Sistema iEllo',desc:'Fluxo de lead no sistema iEllo',points:40},
{id:'b2b_doc_lead',icon:'📄',name:'Documento Lead',desc:'Inserção de documento - lead',points:30},
{id:'b2b_filtros_lead',icon:'🔍',name:'Filtros de Leads',desc:'Treinamento de filtros de leads',points:30},
{id:'b2b_atend_leads',icon:'🎯',name:'Atendimento Leads',desc:'Atendimento e conversão de leads',points:45}]},
'B2B - Termos':{icon:'📑',name:'B2B - Termos',description:'Gestão de termos e contratos',isB2B:true,badges:[
{id:'b2b_fluxo_termos',icon:'📑',name:'Fluxo de Termos',desc:'Treinamento de fluxo de termos',points:35},
{id:'b2b_termo_word',icon:'📝',name:'Termo Padrão Word',desc:'Envio de termo padrão - modelo word',points:30},
{id:'b2b_termo_email',icon:'📧',name:'Termo Corpo E-mail',desc:'Envio de termo - corpo do e-mail',points:30},
{id:'b2b_reg_termo',icon:'📋',name:'Registro Info Termo',desc:'Registro de informações de termo',points:30},
{id:'b2b_filtros_termo',icon:'🔍',name:'Filtros de Termo',desc:'Treinamento de filtros de termo',points:30}]},

'B2C - E-mails':{icon:'📧',name:'B2C - E-mails',description:'Comunicação por e-mail',isB2C:true,badges:[
{id:'b2c_filtros',icon:'🔍',name:'Filtros Central',desc:'Filtros da central de atendimento',points:35},
{id:'b2c_email_modelo',icon:'📧',name:'E-mail Modelos',desc:'Envio de e-mail - modelos prontos',points:30},
{id:'b2c_email_anexo',icon:'📎',name:'E-mail com Anexo',desc:'Envio de e-mail com anexo',points:30},
{id:'b2c_dir_email',icon:'📬',name:'Direcionamento E-mails',desc:'Direcionamento de e-mails',points:30}]},
'B2C - Leads':{icon:'🎯',name:'B2C - Leads',description:'Gestão de leads',isB2C:true,badges:[
{id:'b2c_ins_leads',icon:'➕',name:'Inserção de Leads',desc:'Treinamento de inserção de leads',points:35},
{id:'b2c_fluxo_leads',icon:'🔄',name:'Fluxo de Leads',desc:'Treinamento de fluxo de leads',points:40},
{id:'b2c_doc_lead',icon:'📄',name:'Documento Lead',desc:'Inserção de documento - lead',points:30},
{id:'b2c_reg_whats',icon:'💬',name:'Registro WhatsApp',desc:'Registro de WhatsApp, ligação e histórico',points:35},
{id:'b2c_filtros_lead',icon:'🔍',name:'Filtros de Leads',desc:'Treinamento de filtros de leads',points:30},
{id:'b2c_atend_leads',icon:'🎯',name:'Atendimento Leads',desc:'Atendimento e conversão de leads',points:45}]},

'Backoffice - E-mails':{icon:'📧',name:'Backoffice - E-mails',description:'Comunicação por e-mail',isBackoffice:true,badges:[
{id:'back_filtros',icon:'🔍',name:'Filtros Central',desc:'Filtros da central de atendimento',points:35},
{id:'back_email_modelo',icon:'📧',name:'E-mail Modelos',desc:'Envio de e-mail - modelos prontos',points:30},
{id:'back_email_anexo',icon:'📎',name:'E-mail com Anexo',desc:'Envio de e-mail com anexo',points:30},
{id:'back_dir_email',icon:'📬',name:'Direcionamento E-mails',desc:'Direcionamento de e-mails',points:30}]},
'Backoffice - Leads':{icon:'🎯',name:'Backoffice - Leads',description:'Gestão de leads',isBackoffice:true,badges:[
{id:'back_ins_leads',icon:'➕',name:'Inserção de Leads',desc:'Treinamento de inserção de leads',points:35},
{id:'back_fluxo_leads',icon:'🔄',name:'Fluxo de Leads',desc:'Treinamento de fluxo de leads',points:40},
{id:'back_doc_lead',icon:'📄',name:'Documento Lead',desc:'Inserção de documento - lead',points:30},
{id:'back_reg_whats',icon:'💬',name:'Registro WhatsApp',desc:'Registro de WhatsApp, ligação e histórico',points:35},
{id:'back_filtros_lead',icon:'🔍',name:'Filtros de Leads',desc:'Treinamento de filtros de leads',points:30}]},
'Backoffice - Cobrança':{icon:'💰',name:'Backoffice - Cobrança',description:'Cobrança e retenção',isBackoffice:true,badges:[
{id:'back_cob_doc',icon:'📋',name:'Cobrança Documentação',desc:'Treinamento de cobrança de documentação',points:35},
{id:'back_cob_pag',icon:'💳',name:'Cobrança Pagamento',desc:'Treinamento de cobrança de pagamento',points:35},
{id:'back_retencao',icon:'🎯',name:'Atendimento e Retenção',desc:'Atendimento e retenção de leads',points:45}]},

'Geral - Institucional':{icon:'🏢',name:'Geral - Institucional',description:'Conhecimento da empresa',badges:[
{id:'geral_grupo',icon:'🏢',name:'Apresentação Grupo Ello',desc:'Conhece o Grupo Ello',points:30},
{id:'geral_historia',icon:'📜',name:'História da Empresa',desc:'Conhece a história da empresa',points:30},
{id:'geral_diretoria',icon:'👔',name:'Diretoria',desc:'Conhece a diretoria',points:20},
{id:'geral_diversidade',icon:'🌈',name:'Diversidade',desc:'Treinamento de diversidade',points:30},
{id:'geral_imagem',icon:'👤',name:'Imagem Pessoal',desc:'Treinamento de imagem pessoal',points:25},
{id:'geral_mba',icon:'🎓',name:'MBA e Pós-Graduação',desc:'Conhece MBA e Pós',points:40},
{id:'geral_marcas',icon:'🏷️',name:'Marcas',desc:'Conhece as marcas parceiras',points:35},
{id:'geral_clientes',icon:'🤝',name:'Nossos Clientes',desc:'Conhece os clientes',points:30}]},
'Geral - Treinamento Inicial':{icon:'📋',name:'Geral - Treinamento Inicial',description:'Integração e onboarding',badges:[
{id:'geral_area_td',icon:'📋',name:'Área de Treinamento',desc:'Apresentação da área de T&D',points:25},
{id:'geral_topicos',icon:'📝',name:'Tópicos Presencial',desc:'Tópicos do treinamento presencial',points:30},
{id:'geral_experiencia',icon:'📅',name:'Período Experiência',desc:'Acompanhamento no período de experiência',points:35},
{id:'geral_info',icon:'🔎',name:'Buscar Informações',desc:'Onde buscar informações corretas',points:25},
{id:'geral_comunicacao',icon:'💬',name:'Comunicação Interna',desc:'Meios de comunicação internos',points:25},
{id:'geral_equipe',icon:'👥',name:'Apresentação Equipe',desc:'Conhece a equipe',points:25}]},
'Geral - Produto e Cursos':{icon:'🎓',name:'Geral - Produto e Cursos',description:'Conhecimento de produtos',badges:[
{id:'geral_produto',icon:'📦',name:'Produto e Negócio',desc:'Apresentação produto e modelo de negócio',points:40},
{id:'geral_marca',icon:'🎯',name:'Apresentação Marca',desc:'Apresentação da marca',points:35},
{id:'geral_site',icon:'🌐',name:'Site da Escola',desc:'Conhecendo o site da escola',points:30},
{id:'geral_cursos',icon:'📚',name:'Apresentação Cursos',desc:'Modalidades, valores, etc',points:40}]},
'Geral - Overview':{icon:'🔭',name:'Geral - Overview',description:'Visão geral completa',badges:[
{id:'geral_overview',icon:'🔭',name:'Overview Geral',desc:'Visão geral completa do treinamento',points:50}]}
};

const Q={
"b2b_comum":[
// Alternativas primeiro
{"n":1,"t":"Sinais de Reunião Bem Recebida","tipo":"multi","q":"Quais são os sinais de que uma reunião de apresentação está sendo bem recebida pelo RH?","opts":["Perguntas sobre o Grupo Ello","Interesse nos cursos oferecidos pela escola","Perguntas sobre os materiais de trabalho que utilizamos (notebook, celular, etc)","Perguntas detalhadas e interesse em saber mais sobre o projeto","Demonstração de interesse pela posição e fala do RH"],"correct":[1,3,4]},
{"n":2,"t":"Informações Essenciais Pré-Reunião","tipo":"multi","q":"Quais informações são essenciais de serem coletadas antes da apresentação de parceria para garantir sua eficácia?","opts":["Pesquisar sobre a empresa no Google, LinkedIn, redes sociais, etc","Pesquisar histórico de atendimento","Pesquisar o número de colaboradores da empresa","Pesquisar sobre a pessoa (RH), que falaremos na reunião","Pesquisar sobre o CEO da empresa","Pesquisar se a empresa usa o Teams","Pesquisar se os funcionários recebem material adequado para trabalhar"],"correct":[0,1,2,3]},
{"n":3,"t":"Segmentação de Mercado","tipo":"single","q":"Qual é a importância da segmentação de mercado na prospecção das empresas?","opts":["Permite um foco mais eficiente nos recursos","Ajuda a personalizar a abordagem de vendas","Facilita o acompanhamento e medição de resultados","Todas as opções acima"],"correct":3},
{"n":4,"t":"Projeto Multicompany","tipo":"single","q":"O que é o projeto Multicompany?","opts":["Turmas de cursos de pós-graduação de colaboradores da mesma empresa","Turmas de cursos de pós-graduação de colaboradores de empresas diversas","Turmas de cursos de pós e graduação para colaboradores da mesma empresa","Turmas de cursos de graduação de colaboradores de empresas diversas"],"correct":1},
{"n":5,"t":"Benefícios do Multicompany","tipo":"single","q":"Quais benefícios as empresas obtêm ao participar do Projeto Multicompany?","opts":["Facilitar o acesso à educação aos colaboradores","Acesso à uma opção gratuita de retenção de talentos","Aumento de opções no pacote de benefícios da empresa","Todas as opções"],"correct":3},
{"n":6,"t":"Ferramentas para Reunião Eficiente","tipo":"single","q":"Quais ferramentas ou recursos você utilizaria para garantir uma reunião bem estruturada e eficiente?","opts":["Pesquisa prévia sobre a empresa, preparação do material e tópicos que serão abordados na reunião. Identificação do perfil do RH e direcionamento da conversa.","Pesquisar se os funcionários da empresa recebem um bom salário","Pesquisa sobre a empresa, pesquisa sobre a vida pessoal do RH (onde mora, se tem filhos), e pesquisa sobre o número de colaboradores da empresa","Pesquisa sobre o vendedor anterior da empresa, e pesquisa no LinkedIn sobre o nicho da empresa"],"correct":0},
{"n":7,"t":"Perguntas para Identificar Perfil do RH","tipo":"multi","q":"Quais perguntas iniciais você faria para identificar rapidamente o perfil do RH?","opts":["Como estão estruturadas as parcerias da empresa, atualmente?","Como funciona o pacote de benefícios da empresa?","Quais ações de incentivo educacional você realiza na empresa?","Que tipo de benefícios educacionais a empresa mais valoriza?","Qual a carga horária de trabalho semanal do colaborador da empresa?","Os funcionários da empresa recebem benefícios como VR, VA, VT ou cartão de multibenefícios?","Qual a periodicidade para aplicação dos indicadores de desempenho dos colaboradores?"],"correct":[0,1,2,3]},
{"n":8,"t":"Perfis de RH Receptivos","tipo":"single","q":"Quais perfis de RH são mais receptivos a parcerias educacionais e por quê?","opts":["RH Generalista, porque precisa de soluções abrangentes","RH de Treinamento, porque foca no desenvolvimento de habilidades","RH de Benefícios, porque busca valor agregado para os colaboradores","Todos os perfis mencionados"],"correct":3},
// Dissertativas técnicas
{"n":9,"t":"Importância do Follow-up","tipo":"text","q":"Qual a importância do follow-up após uma reunião com a empresa?"},
{"n":10,"t":"Identificação do Perfil do RH","tipo":"text","q":"Como a identificação correta do perfil do RH pode impactar o sucesso da parceria e o aproveitamento da reunião?"},
{"n":11,"t":"Identificação de Empresas Propensas","tipo":"text","q":"Como você identifica as empresas mais propensas a se beneficiar da parceria?"},
{"n":12,"t":"Etapas do Multicompany","tipo":"text","q":"Quais são as etapas envolvidas no desenvolvimento de um projeto dentro do Multicompany?"},
// Avaliação do treinamento por último
{"n":13,"t":"Avaliação do Treinamento","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"b2b_poli":[
// Alternativas primeiro
{"n":14,"t":"Setores Beneficiados - POLI","tipo":"single","q":"Quais setores de mercado são mais beneficiados pelos programas da POLI USP Pro?","opts":["Finanças e Gestão","Engenharia e Indústria","Tecnologia da Informação","Todos os setores mencionados"],"correct":3},
{"n":15,"t":"Vantagens Competitivas - POLI","tipo":"multi","q":"Quais vantagens competitivas a POLI USP Pro oferece em comparação com outras instituições de educação continuada?","opts":["Localização privilegiada na cidade de São Paulo","Corpo docente composto por professores renomados da USP","Flexibilidade nos formatos dos cursos","Opções de pagamento facilitadas"],"correct":[1,2]},
// Dissertativas
{"n":16,"t":"Explicar POLI USP Pro","tipo":"text","q":"Explique de forma breve o que é a POLI USP Pro"},
{"n":17,"t":"Diferença POLI vs USP Tradicional","tipo":"text","q":"Qual a diferença entre a POLI USP Pro e os cursos tradicionais da USP?"},
// Avaliação do treinamento por último
{"n":18,"t":"Avaliação do Treinamento POLI","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"b2b_esalq":[
// Alternativas primeiro
{"n":19,"t":"Setores Beneficiados - ESALQ","tipo":"single","q":"Quais setores de mercado são mais beneficiados pelos programas do MBA USP ESALQ?","opts":["Finanças e Gestão","Engenharia e Indústria","Tecnologia da Informação","Todos os setores mencionados"],"correct":3},
{"n":20,"t":"Vantagens Competitivas - ESALQ","tipo":"multi","q":"Quais vantagens competitivas o MBA USP ESALQ oferece em comparação com outras instituições de educação continuada?","opts":["Localização privilegiada na cidade de São Paulo","Corpo docente composto por professores renomados da USP","Flexibilidade nos formatos dos cursos","Opções de pagamento facilitadas"],"correct":[1,2]},
// Dissertativas
{"n":21,"t":"Explicar MBA USP ESALQ","tipo":"text","q":"Explique de forma breve o que é o MBA USP ESALQ"},
{"n":22,"t":"Diferença ESALQ vs USP Tradicional","tipo":"text","q":"Qual a diferença entre o MBA USP ESALQ e os cursos tradicionais da USP?"},
// Avaliação do treinamento por último
{"n":23,"t":"Avaliação do Treinamento ESALQ","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"b2b_mackenzie":[
// Alternativas primeiro
{"n":24,"t":"Setores Beneficiados - MACKENZIE","tipo":"single","q":"Quais setores de mercado são mais beneficiados pelos programas do Multicompany MACKENZIE?","opts":["Finanças e Gestão","Engenharia e Indústria","Tecnologia da Informação","Todos os setores mencionados"],"correct":3},
{"n":25,"t":"Vantagens Competitivas - MACKENZIE","tipo":"single","q":"Quais vantagens competitivas o Multicompany MACKENZIE oferece em comparação com outras instituições de educação continuada?","opts":["Localização privilegiada na cidade de São Paulo","Networking","Opções de pagamento facilitadas","Corpo docente composto por professores renomados","Todas as opções acima"],"correct":4},
// Dissertativas
{"n":26,"t":"Falar da Universidade Mackenzie","tipo":"text","q":"Fale um pouco da Universidade Presbiteriana Mackenzie"},
{"n":27,"t":"MBA vs Pós-Graduação (Lato vs Stricto)","tipo":"text","q":"Qual a diferença entre MBA e Pós-Graduação?"},
// Avaliação do treinamento por último
{"n":28,"t":"Avaliação do Treinamento MACKENZIE","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"b2b_eca":[
// Alternativas primeiro
{"n":29,"t":"Setores Beneficiados - ECA USP","tipo":"single","q":"Quais setores de mercado são mais beneficiados pelos programas da ECA USP (Comunicação, Marketing, BI)?","opts":["Comunicação e Marketing","Business Intelligence & Analytics","Artes e Design","Todos os setores mencionados"],"correct":3},
{"n":30,"t":"Vantagens Competitivas - ECA USP","tipo":"multi","q":"Quais vantagens competitivas a ECA USP oferece em comparação com outras instituições?","opts":["Corpo docente renomado da USP","Flexibilidade nos formatos (EAD)","Especialização em Comunicação e Artes","Localização privilegiada em São Paulo"],"correct":[0,1,2]},
// Dissertativas
{"n":31,"t":"Explicar ECA USP","tipo":"text","q":"Explique de forma breve o que é a ECA USP (Escola de Comunicações e Artes)"},
{"n":32,"t":"Diferença ECA vs USP Tradicional","tipo":"text","q":"Qual a diferença entre a ECA USP e os cursos tradicionais da USP?"},
// Avaliação do treinamento por último
{"n":33,"t":"Avaliação do Treinamento ECA","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"b2c":[
// Alternativas primeiro
{"n":34,"t":"Canais de Atendimento B2C","tipo":"multi","q":"Quais canais você utiliza para atendimento ao lead?","opts":["Telefone","E-mail","WhatsApp","Presencial"],"correct":[0,1,2]},
{"n":35,"t":"Primeira Abordagem ao Lead","tipo":"single","q":"Como deve ser feita a abordagem inicial ao lead?","opts":["Contato telefônico + envio de material + agendamento de follow-up","Apenas envio de material por e-mail","Esperar o lead retornar contato","Enviar proposta comercial imediatamente"],"correct":0},
{"n":36,"t":"Lead Negativo - Procedimento","tipo":"single","q":"O que fazer quando o lead não quer seguir com inscrição?","opts":["Perguntar se deseja receber informações na próxima turma + colocar histórico + dar PERDIDO no sistema","Insistir na venda","Apenas dar PERDIDO no sistema","Transferir para outro vendedor"],"correct":0},
{"n":37,"t":"Documentação Obrigatória","tipo":"multi","q":"Quais documentos são obrigatórios para inscrição?","opts":["RG (não pode ser substituído)","CPF (ou CNH)","Diploma de Graduação","Formulário online preenchido","Certidão de nascimento"],"correct":[0,1,2,3]},
{"n":38,"t":"Prazo Follow-up","tipo":"single","q":"Qual o prazo ideal para retornar contato com lead após envio de material?","opts":["1 semana","3 dias","24 a 48 horas","Aguardar lead retornar"],"correct":2},
{"n":39,"t":"Qualificação de Lead","tipo":"single","q":"Como identificar se um lead está qualificado?","opts":["Possui graduação completa + demonstra interesse real + está dentro do público-alvo da parceria","Apenas se possui condições financeiras para pagar","Se respondeu rápido ao primeiro contato","Se tem cargo de gerência ou superior"],"correct":0},
{"n":40,"t":"Contorno de Objeções","tipo":"multi","q":"Quais as objeções mais comuns e como contorná-las?","opts":["\"Está caro\" - Mostrar desconto exclusivo da parceria e opções de pagamento","\"Não tenho tempo\" - Destacar flexibilidade do EAD e aulas ao vivo gravadas","\"Preciso pensar\" - Criar senso de urgência (vagas limitadas, turma fechando)","\"Já fiz pós-graduação\" - Mostrar diferencial da certificação USP/Mackenzie"],"correct":[0,1,2,3]},
// Dissertativas técnicas
{"n":41,"t":"Processo de Inscrição","tipo":"text","q":"Descreva brevemente as etapas do processo de inscrição desde o contato inicial até a matrícula"},
{"n":42,"t":"Tratamento de Pendências Documentais","tipo":"text","q":"Como proceder quando o lead envia documentação incompleta ou com problemas?"},
// Avaliação do treinamento por último
{"n":43,"t":"Avaliação do Treinamento B2C","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
],
"backoffice":[
// Alternativas primeiro
{"n":44,"t":"Fluxo de Trabalho - Ordem Correta","tipo":"multi","q":"Ordene corretamente as etapas do processo de matrícula:","opts":["1. Trabalhar lead","2. Aprovação interna de formulário","3. Matrícula eletrônica","4. Validar matrícula com a marca","5. Inserir aluno na marca","6. Processo seletivo (quando aplicável)","7. Status do processo seletivo","8. Gerar boleto 1ª parcela","9. Pagamento 1ª parcela"],"correct":[0,1,2,3,4,5,6,7,8]},
{"n":45,"t":"Aprovação de Formulários","tipo":"multi","q":"O que verificar na aprovação de formulários?","opts":["Dados pessoais completos e corretos","Documentos anexados corretamente (formato e legibilidade)","Curso selecionado está correto","Empresa/parceria identificada","Score de crédito do aluno"],"correct":[0,1,2,3]},
{"n":46,"t":"Validação de Documentação","tipo":"multi","q":"Quais documentos precisam de validação especial (autenticação)?","opts":["Diploma de graduação (autenticação em cartório, digital ou física da universidade)","Histórico de graduação (autenticação em cartório, digital ou física)","Comprovante de vínculo empregatício (quando aplicável)","RG (cópia simples aceita)"],"correct":[0,1,2]},
{"n":47,"t":"Sistemas Utilizados","tipo":"multi","q":"Quais sistemas você utiliza no dia a dia do Backoffice?","opts":["iELLO (sistema interno Grupo Ello)","Sistemas das marcas (APOLO para ESALQ, MOVE para POLI, etc)","E-mail corporativo","CRM externo"],"correct":[0,1,2]},
{"n":48,"t":"Cobrança de Documentos Faltantes","tipo":"single","q":"Qual o prazo para cobrar documentos faltantes após identificar a pendência?","opts":["No mesmo dia","2-3 dias após identificar pendência","1 semana","Aguardar aluno enviar espontaneamente"],"correct":1},
{"n":49,"t":"Processo Seletivo POLI","tipo":"single","q":"Como funciona o processo seletivo específico da POLI?","opts":["Análise curricular eliminatória","Prova escrita presencial","Entrevista online","Não há processo seletivo na POLI"],"correct":0},
{"n":50,"t":"Gestão Financeira - Responsabilidades","tipo":"multi","q":"Quais são suas responsabilidades na parte financeira?","opts":["Gerar boleto da 1ª parcela após aprovação","Confirmar pagamento da 1ª parcela","Informar inadimplência ao setor responsável","Negociar desconto diretamente com aluno"],"correct":[0,1,2]},
// Dissertativas técnicas
{"n":51,"t":"Matrícula Eletrônica no iELLO","tipo":"text","q":"Descreva o processo de matrícula eletrônica no sistema iELLO"},
{"n":52,"t":"Validação com a Marca","tipo":"text","q":"Como proceder para validar a matrícula com a escola parceira?"},
{"n":53,"t":"Boas Práticas Backoffice","tipo":"text","q":"Quais boas práticas você aplicaria para garantir zero erros no processo de matrícula?"},
// Avaliação do treinamento por último
{"n":54,"t":"Avaliação do Treinamento Backoffice","tipo":"text","q":"Como você avalia o treinamento de integração (conteúdo, didática e aprendizado)? Dicas e sugestões de melhoria são bem-vindas."}
]
};

let trainees=[];let currentTrainee=0;let currentUser=null;let isAdmin=false;
let adminCreds={username:'admin',password:'ello2025'};
let currentEval={type:'',brand:'',answers:{},started:false};
let adminSelectedTrainee=-1;
let evalHistory=[];

// ========== QUIZ DIÁRIO ==========
const quizDiario = {
    dia1: [
        {q: "Qual é a marca do Grupo Ello focada em Agronegócio?", opts: ["POLI", "ECA USP", "ESALQ/PECEGE", "MACKENZIE"], correct: 2},
        {q: "Qual a escola do Grupo Ello especializada em Comunicação e Artes?", opts: ["POLI", "ESALQ", "MACKENZIE", "ECA USP"], correct: 3},
        {q: "Quantos anos de tradição o Mackenzie possui?", opts: ["100 anos", "125 anos", "150 anos", "175 anos"], correct: 2}
    ],
    dia2: [
        {q: "Qual a diferença entre Lato Sensu e Stricto Sensu?", opts: ["Lato é mais caro", "Stricto é especialização, Lato é mestrado", "Lato é especialização/MBA, Stricto é mestrado/doutorado", "Não há diferença"], correct: 2},
        {q: "A POLI USP Pro é focada em qual área?", opts: ["Agronegócio", "Comunicação", "Engenharia e Tecnologia", "Direito"], correct: 2},
        {q: "Qual o público-alvo dos cursos oferecidos pelas marcas do Grupo Ello?", opts: ["Estudantes do ensino médio", "Profissionais que buscam pós-graduação e MBA", "Aposentados", "Crianças e adolescentes"], correct: 1}
    ],
    dia3: [
        {q: "Quais são os meios de comunicação interna do Grupo Ello?", opts: ["Apenas e-mail", "E-mail e Teams", "Somente telefone", "Carta e fax"], correct: 1},
        {q: "O que significa a sigla T&D?", opts: ["Tecnologia e Desenvolvimento", "Treinamento e Desenvolvimento", "Tempo e Dedicação", "Trabalho e Desempenho"], correct: 1},
        {q: "Qual o principal diferencial das marcas do Grupo Ello?", opts: ["Preço mais baixo do mercado", "Parceria com universidades renomadas (USP, Mackenzie)", "Cursos 100% presenciais", "Sem necessidade de diploma"], correct: 1}
    ],
    dia4: [
        {q: "O que é um lead?", opts: ["Cliente que já comprou", "Potencial cliente interessado", "Fornecedor da empresa", "Funcionário novo"], correct: 1},
        {q: "Qual sistema interno o Grupo Ello utiliza?", opts: ["Salesforce", "HubSpot", "iELLO", "Pipedrive"], correct: 2},
        {q: "Qual a importância do histórico no sistema?", opts: ["Apenas burocracia", "Rastrear interações e dar continuidade ao atendimento", "Ocupar espaço no servidor", "Não tem importância"], correct: 1}
    ],
    dia5: [
        {q: "Qual é o requisito mínimo de formação para ingressar em um curso de pós-graduação?", opts: ["Ensino médio completo", "Graduação completa", "Mestrado", "Não há requisito"], correct: 1},
        {q: "O que o aluno precisa apresentar para comprovar sua formação acadêmica?", opts: ["Apenas RG", "Diploma de graduação", "Carteira de trabalho", "Comprovante de residência"], correct: 1},
        {q: "O que é o Projeto Multicompany?", opts: ["Venda de cursos online", "Turmas de pós-graduação para colaboradores de empresas parceiras", "Sistema de gestão interna", "Programa de estágio"], correct: 1}
    ]
};

let currentQuizQuestions = [];
let currentQuizIndex = 0;
let quizScore = 0;
let quizAnswered = false;
let selectedQuizOption = -1;
let pendingQuizDays = [];
let currentQuizDayIndex = 0;

function getTodayKey() {
    const today = new Date();
    return `${today.getFullYear()}-${today.getMonth()+1}-${today.getDate()}`;
}

function hasCompletedQuizToday(trainee) {
    if (!trainee.quizData) return false;
    return trainee.quizData.lastQuizDate === getTodayKey();
}

function getCompletedDays(trainee) {
    if (!trainee.quizData || !trainee.quizData.completedDays) return [];
    return trainee.quizData.completedDays;
}

function getPendingDays(trainee) {
    const completed = getCompletedDays(trainee);
    const releasedDays = trainee.releasedQuizDays || [];
    const allDays = [1, 2, 3, 4, 5];
    
    // Retorna dias que: não foram completados E estão liberados manualmente
    return allDays.filter(d => !completed.includes(d) && releasedDays.includes(d)).sort((a, b) => a - b);
}

function getQuizStreak(trainee) {
    if (!trainee.quizData) return 0;
    return trainee.quizData.streak || 0;
}

function getTotalQuizPoints(trainee) {
    if (!trainee.quizData) return 0;
    return trainee.quizData.totalPoints || 0;
}

function getQuizHistory(trainee) {
    if (!trainee.quizData) return [];
    return trainee.quizData.history || [];
}

async function saveQuizData(trainee, dayCompleted, pointsEarned, questionsCorrect) {
    // Inicializar quizData se não existir
    if (!trainee.quizData) {
        trainee.quizData = {
            completedDays: [],
            totalPoints: 0,
            streak: 0,
            history: [],
            lastQuizDate: null
        };
    }
    
    // Adicionar dia completado
    if (!trainee.quizData.completedDays.includes(dayCompleted)) {
        trainee.quizData.completedDays.push(dayCompleted);
    }
    
    // Adicionar pontos
    trainee.quizData.totalPoints += pointsEarned;
    
    // Atualizar streak se acertou todas
    if (questionsCorrect === 3) {
        trainee.quizData.streak++;
    }
    
    // Adicionar ao histórico
    trainee.quizData.history.push({
        day: dayCompleted,
        date: new Date().toLocaleString('pt-BR'),
        correct: questionsCorrect,
        points: pointsEarned
    });
    
    // Marcar data de hoje
    trainee.quizData.lastQuizDate = getTodayKey();
    
    // Salvar no Firebase ou localStorage
    if (useFirebase && db && trainee.firebaseId) {
        await db.collection('trainees').doc(trainee.firebaseId).update({
            quizData: trainee.quizData,
            points: trainee.points
        });
    } else {
        saveToLocalStorage();
    }
}

function checkPendingQuizzes() {
    if (!currentUser || !currentUser.code) return false;
    
    // Se já completou hoje, não mostrar
    if (hasCompletedQuizToday(currentUser)) return false;
    
    // Verificar dias pendentes
    pendingQuizDays = getPendingDays(currentUser);
    
    return pendingQuizDays.length > 0;
}

function showDailyQuiz() {
    const overlay = document.getElementById('quiz-overlay');
    const content = document.getElementById('quiz-content');
    
    pendingQuizDays = getPendingDays(currentUser);
    const completedDays = getCompletedDays(currentUser);
    
    if (pendingQuizDays.length === 0) {
        // Verificar se completou todos ou se não tem dias liberados
        if (completedDays.length === 5) {
            // Todos os dias completos
            content.innerHTML = `
                <div class="quiz-result">
                    <div class="quiz-result-icon">🎓</div>
                    <h3>Parabéns!</h3>
                    <p>Você já completou todos os 5 dias de quiz!</p>
                    <p style="margin-top:10px;">Total de pontos do quiz: <strong>${getTotalQuizPoints(currentUser)} pts</strong></p>
                    <button class="quiz-btn" onclick="closeQuiz()">Continuar</button>
                </div>
            `;
        } else {
            // Não tem dias liberados
            content.innerHTML = `
                <div class="quiz-result">
                    <div class="quiz-result-icon">🔒</div>
                    <h3>Aguarde!</h3>
                    <p>Os próximos dias do quiz ainda não foram liberados.</p>
                    <p style="margin-top:10px;color:#666;">Entre em contato com o T&D para liberação.</p>
                    <p style="margin-top:10px;">Dias completados: <strong>${completedDays.length}/5</strong></p>
                    <button class="quiz-btn" onclick="closeQuiz()">Fechar</button>
                </div>
            `;
        }
        overlay.style.display = 'flex';
        return;
    }
    
    currentQuizDayIndex = 0;
    showQuizDayIntro();
}

function showQuizDayIntro() {
    const overlay = document.getElementById('quiz-overlay');
    const content = document.getElementById('quiz-content');
    
    const day = pendingQuizDays[currentQuizDayIndex];
    const totalPending = pendingQuizDays.length;
    const completedDays = getCompletedDays(currentUser);
    const streak = getQuizStreak(currentUser);
    
    let html = `
        <div class="quiz-header">
            <h2>🎯 Quiz Diário</h2>
            ${totalPending > 1 ? `<p style="background:#fff3cd;padding:10px;border-radius:8px;margin-bottom:10px;">📚 Você tem <strong>${totalPending} dias</strong> de quiz pendentes!</p>` : ''}
            <p>Dia <strong>${day}</strong> de 5 - Responda as 3 perguntas</p>
            <p style="margin-top:5px;"><strong>+5 pontos</strong> por acerto!</p>
            ${streak > 0 ? `<div class="quiz-streak">🔥 Dias perfeitos: ${streak}</div>` : ''}
        </div>
        <div style="display:flex;justify-content:center;gap:10px;margin:20px 0;">
            ${[1,2,3,4,5].map(d => `
                <div style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;
                    ${completedDays.includes(d) ? 'background:#28a745;color:white;' : d === day ? 'background:#667eea;color:white;' : 'background:#e0e0e0;color:#666;'}">
                    ${completedDays.includes(d) ? '✓' : d}
                </div>
            `).join('')}
        </div>
        <button class="quiz-btn" onclick="startQuizDay(${day})">Começar Dia ${day}</button>
    `;
    
    content.innerHTML = html;
    overlay.style.display = 'flex';
}

function startQuizDay(day) {
    currentQuizQuestions = quizDiario['dia' + day] || quizDiario.dia1;
    currentQuizIndex = 0;
    quizScore = 0;
    showQuizQuestion(day);
}

function showQuizQuestion(day) {
    const content = document.getElementById('quiz-content');
    const q = currentQuizQuestions[currentQuizIndex];
    quizAnswered = false;
    selectedQuizOption = -1;
    
    content.innerHTML = `
        <div class="quiz-header" style="margin-bottom:15px;">
            <h2 style="font-size:20px;">🎯 Dia ${day}/5</h2>
        </div>
        <div class="quiz-question">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                <span style="background:#667eea;color:white;padding:5px 12px;border-radius:20px;font-size:12px;font-weight:bold;">Pergunta ${currentQuizIndex + 1}/3</span>
                <span style="color:#666;font-size:14px;">Acertos: ${quizScore}/3</span>
            </div>
            <div class="quiz-question-text">${q.q}</div>
            <div class="quiz-options">
                ${q.opts.map((opt, i) => `
                    <div class="quiz-option" onclick="selectQuizOption(${i})" id="quiz-opt-${i}">${opt}</div>
                `).join('')}
            </div>
        </div>
        <button class="quiz-btn" id="quiz-submit-btn" onclick="submitQuizAnswer(${day})" disabled>Confirmar Resposta</button>
    `;
}

function selectQuizOption(index) {
    if (quizAnswered) return;
    
    document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
    document.getElementById('quiz-opt-' + index).classList.add('selected');
    selectedQuizOption = index;
    document.getElementById('quiz-submit-btn').disabled = false;
}

function submitQuizAnswer(day) {
    if (selectedQuizOption === -1 || quizAnswered) return;
    
    quizAnswered = true;
    const q = currentQuizQuestions[currentQuizIndex];
    const correct = selectedQuizOption === q.correct;
    
    document.querySelectorAll('.quiz-option').forEach((opt, i) => {
        opt.classList.remove('selected');
        if (i === q.correct) {
            opt.classList.add('correct');
        } else if (i === selectedQuizOption && !correct) {
            opt.classList.add('incorrect');
        }
    });
    
    if (correct) {
        quizScore++;
    }
    
    const btn = document.getElementById('quiz-submit-btn');
    if (currentQuizIndex < 2) {
        btn.textContent = 'Próxima Pergunta →';
        btn.onclick = function() { nextQuizQuestion(day); };
    } else {
        btn.textContent = 'Ver Resultado';
        btn.onclick = function() { finishQuizDay(day); };
    }
    btn.disabled = false;
}

function nextQuizQuestion(day) {
    currentQuizIndex++;
    showQuizQuestion(day);
}

async function finishQuizDay(day) {
    const content = document.getElementById('quiz-content');
    const allCorrect = quizScore === 3;
    const pointsEarned = quizScore * 5;
    
    // Adicionar pontos ao colaborador
    currentUser.points += pointsEarned;
    trainees[currentTrainee].points = currentUser.points;
    
    // Salvar dados do quiz no Firebase
    await saveQuizData(currentUser, day, pointsEarned, quizScore);
    
    // Atualizar referência local
    trainees[currentTrainee] = currentUser;
    
    // Atualizar lista de pendentes e resetar índice
    pendingQuizDays = getPendingDays(currentUser);
    currentQuizDayIndex = 0; // Sempre resetar para 0
    
    const hasMoreDays = pendingQuizDays.length > 0;
    const nextDay = hasMoreDays ? pendingQuizDays[0] : null;
    const newStreak = getQuizStreak(currentUser);
    
    let message = '';
    let icon = '';
    if (quizScore === 3) {
        icon = '🏆';
        message = 'Perfeito! Você acertou todas!';
    } else if (quizScore === 2) {
        icon = '🎉';
        message = 'Muito bem! Quase perfeito!';
    } else if (quizScore === 1) {
        icon = '👍';
        message = 'Bom! Continue estudando!';
    } else {
        icon = '📚';
        message = 'Não desanime! Revise o conteúdo!';
    }
    
    content.innerHTML = `
        <div class="quiz-result">
            <div class="quiz-result-icon">${icon}</div>
            <h3>${message}</h3>
            <p>Dia ${day} - Você acertou <strong>${quizScore} de 3</strong> perguntas</p>
            <div class="quiz-points">+${pointsEarned} pontos</div>
            ${allCorrect && newStreak > 0 ? `<p style="margin-top:10px;">🔥 Dias perfeitos: <strong>${newStreak}</strong></p>` : ''}
            ${hasMoreDays ? `
                <p style="margin-top:15px;background:#fff3cd;padding:10px;border-radius:8px;">
                    📚 Ainda ${pendingQuizDays.length === 1 ? 'resta 1 dia' : `restam ${pendingQuizDays.length} dias`} pendente${pendingQuizDays.length > 1 ? 's' : ''}!
                </p>
                <button class="quiz-btn" onclick="continueToNextDay()">Continuar para o Dia ${nextDay}</button>
            ` : `
                <p style="margin-top:15px;color:#28a745;font-weight:bold;">🎓 Parabéns! Você completou todos os 5 dias!</p>
                <p>Total de pontos do quiz: <strong>${getTotalQuizPoints(currentUser)} pts</strong></p>
                <button class="quiz-btn" onclick="closeQuiz()">Finalizar</button>
            `}
        </div>
    `;
}

function continueToNextDay() {
    // O pendingQuizDays já foi atualizado, então o índice 0 é sempre o próximo dia
    currentQuizDayIndex = 0;
    // Recarregar lista de pendentes para garantir ordem correta
    pendingQuizDays = getPendingDays(currentUser);
    showQuizDayIntro();
}

function closeQuiz() {
    document.getElementById('quiz-overlay').style.display = 'none';
    updateView();
}

// ========== FIREBASE DATA FUNCTIONS ==========
async function loadData() {
    if (useFirebase && db) {
        // Carregar do Firebase com listener em tempo real
        return new Promise((resolve) => {
            if (unsubscribeTrainees) unsubscribeTrainees();
            unsubscribeTrainees = db.collection('trainees').onSnapshot(snap => {
                trainees = [];
                evalHistory = []; // Resetar evalHistory global
                
                snap.forEach(doc => {
                    const data = doc.data();
                    data.firebaseId = doc.id;
                    // Gerar código se não existir
                    if (!data.code) {
                        data.code = generateCode(data.name);
                        db.collection('trainees').doc(doc.id).update({code: data.code});
                    }
                    trainees.push(data);
                });
                
                // Reconstruir evalHistory global a partir dos dados de cada colaborador
                trainees.forEach((t, idx) => {
                    if (t.evalHistory && Array.isArray(t.evalHistory)) {
                        t.evalHistory.forEach(e => {
                            // Garantir que o traineeIndex está correto
                            e.traineeIndex = idx;
                            e.traineeName = t.name;
                            evalHistory.push(e);
                        });
                    }
                });
                
                // Ordenar por data (mais recentes primeiro)
                evalHistory.sort((a, b) => {
                    try {
                        const dateA = new Date(a.date.split(',')[0].split('/').reverse().join('-'));
                        const dateB = new Date(b.date.split(',')[0].split('/').reverse().join('-'));
                        return dateB - dateA;
                    } catch(e) {
                        return 0;
                    }
                });
                
                console.log('Dados carregados - Colaboradores:', trainees.length, '| Avaliações:', evalHistory.length);
                
                if (!trainees.length) {
                    // Adicionar colaboradores padrão
                    addDefaultTrainees();
                }
                populateEmployeeSelect();
                populateAdminTraineeSelect();
                if (currentUser && !isAdmin) {
                    const updated = trainees.find(t => t.firebaseId === currentUser.firebaseId);
                    if (updated) {
                        currentUser = updated;
                        currentTrainee = trainees.indexOf(updated);
                    }
                    try {
                        updateView();
                    } catch(e) {
                        console.log('Erro ao atualizar view:', e);
                    }
                }
                if (isAdmin) {
                    try {
                        renderAdmin();
                    } catch(e) {
                        console.log('Erro ao renderizar admin:', e);
                    }
                }
                resolve();
            }, err => {
                console.log('Erro ao carregar:', err);
                loadFromLocalStorage();
                resolve();
            });
        });
    } else {
        loadFromLocalStorage();
    }
}

function loadFromLocalStorage() {
    const s = localStorage.getItem('badgesSystemData');
    if (s) {
        const d = JSON.parse(s);
        trainees = d.trainees || [];
        if (d.adminCreds) adminCreds = d.adminCreds;
        if (d.evalHistory) evalHistory = d.evalHistory;
    }
    if (!trainees.length) {
        trainees = [
            {name:'João Silva', function:'B2B', brand:'ECA USP', points:0, badges:[], code:'JOAO2025'},
            {name:'Maria Santos', function:'B2C', brand:'MACKENZIE', points:0, badges:[], code:'MARIA2025'}
        ];
    }
    // Garantir que todos tenham código
    trainees.forEach((t, i) => {
        if (!t.code) t.code = generateCode(t.name);
    });
}

async function addDefaultTrainees() {
    const defaults = [
        {name:'João Silva', function:'B2B', brand:'ECA USP', points:0, badges:[], code:'JOAO2025'},
        {name:'Maria Santos', function:'B2C', brand:'MACKENZIE', points:0, badges:[], code:'MARIA2025'}
    ];
    for (const t of defaults) {
        await db.collection('trainees').add(t);
    }
}

function generateCode(name) {
    const fn = name.split(' ')[0].toUpperCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    return `${fn}${new Date().getFullYear()}${String(Math.floor(Math.random()*100)).padStart(2,'0')}`;
}

async function saveData() {
    if (useFirebase && db && currentUser && currentUser.firebaseId) {
        try {
            await db.collection('trainees').doc(currentUser.firebaseId).update({
                points: currentUser.points || 0,
                badges: currentUser.badges || [],
                evalHistory: currentUser.evalHistory || []
            });
        } catch(e) {
            console.log('Erro ao salvar no Firebase:', e);
            saveToLocalStorage();
        }
    } else {
        saveToLocalStorage();
    }
}

function saveToLocalStorage() {
    localStorage.setItem('badgesSystemData', JSON.stringify({trainees, adminCreds, evalHistory}));
}
function populateEmployeeSelect(){const s=document.getElementById('employee-select');s.innerHTML='<option value="">-- Selecione --</option>'+trainees.map((t,i)=>'<option value="'+i+'">'+t.name+'</option>').join('');}
function populateAdminTraineeSelect(){const s=document.getElementById('admin-trainee-select');if(s){s.innerHTML='<option value="">-- Selecione um colaborador --</option>'+trainees.map((t,i)=>'<option value="'+i+'">'+t.name+' ('+t.function+' - '+t.brand+')</option>').join('');}}
function switchLoginTab(t){document.querySelectorAll('.login-tab').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.login-form').forEach(f=>f.classList.remove('active'));if(t==='employee'){document.querySelector('.login-tab:first-child').classList.add('active');document.getElementById('employee-form').classList.add('active');}else{document.querySelector('.login-tab:last-child').classList.add('active');document.getElementById('admin-form').classList.add('active');}hideError();}
function showError(m){const e=document.getElementById('error-message');e.textContent=m;e.classList.add('show');}
function hideError(){document.getElementById('error-message').classList.remove('show');}
function loginEmployee(e){
    e.preventDefault();
    const code = document.getElementById('employee-code').value.trim().toUpperCase();
    if(!code){
        showError('❌ Digite seu código de acesso');
        return;
    }
    
    // Procurar colaborador pelo código
    const index = trainees.findIndex(t => t.code && t.code.toUpperCase() === code);
    
    if(index === -1){
        showError('❌ Código não encontrado. Verifique com o T&D.');
        return;
    }
    
    // Verificar se está bloqueado
    if(trainees[index].blocked){
        showError('🚫 Acesso bloqueado. Entre em contato com o T&D.');
        return;
    }
    
    currentTrainee = index;
    currentUser = trainees[currentTrainee];
    isAdmin = false;
    showMainSystem();
    
    // Verificar e mostrar quiz diário (acumula dias pendentes)
    if (checkPendingQuizzes()) {
        setTimeout(() => showDailyQuiz(), 500);
    }
}
function loginAdmin(e){e.preventDefault();const u=document.getElementById('admin-username').value;const p=document.getElementById('admin-password').value;if(u===adminCreds.username&&p===adminCreds.password){isAdmin=true;currentUser={name:'Administrador'};showMainSystem();switchMode('admin');}else{showError('❌ Usuário ou senha incorretos');}}
function showMainSystem(){document.getElementById('login-screen').style.display='none';document.getElementById('main-system').style.display='block';document.getElementById('user-name').textContent=currentUser.name;document.getElementById('user-role').textContent=isAdmin?'Administrador':'Colaborador';document.getElementById('user-role').classList.toggle('admin',isAdmin);const a=document.getElementById('admin-btn');const b=document.getElementById('badges-btn');if(isAdmin){a.classList.remove('disabled');b.style.display='none';}else{a.classList.add('disabled');b.style.display='block';}updateView();renderEvalButtons();}
function logout(){if(confirm('Sair?')){document.getElementById('login-screen').style.display='flex';document.getElementById('main-system').style.display='none';document.getElementById('employee-code').value='';document.getElementById('admin-username').value='';document.getElementById('admin-password').value='';currentUser=null;isAdmin=false;switchLoginTab('employee');}}
function changePassword(){const c=prompt('Senha atual:');if(c!==adminCreds.password){alert('❌ Incorreta');return;}const n=prompt('Nova senha (min 6):');if(!n||n.length<6){alert('❌ Min 6 chars');return;}const f=prompt('Confirme:');if(n!==f){alert('❌ Não coincidem');return;}adminCreds.password=n;saveData();alert('✅ Alterada!');}
function switchMode(m){if(m==='admin'&&!isAdmin){alert('⚠️ Só admin!');return;}document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.view-section').forEach(s=>s.classList.remove('active'));if(m==='view'){document.querySelector('.mode-btn[onclick*="view"]').classList.add('active');document.getElementById('view-mode').classList.add('active');updateView();}else if(m==='content'){document.querySelector('.mode-btn[onclick*="content"]').classList.add('active');document.getElementById('content-mode').classList.add('active');loadContents().then(()=>renderContents());}else if(m==='eval'){document.querySelector('.mode-btn[onclick*="eval"]').classList.add('active');document.getElementById('eval-mode').classList.add('active');renderEvalButtons();}else{document.querySelector('.mode-btn[onclick*="admin"]').classList.add('active');document.getElementById('admin-mode').classList.add('active');document.getElementById('admin-dashboard').classList.add('active');document.getElementById('detail-panel').classList.remove('active');document.getElementById('eval-details-container').innerHTML='';renderAdminDashboard();}}
function addTrainee(){
    const n=document.getElementById('trainee-name').value.trim();
    const f=document.getElementById('trainee-function').value;
    const b=document.getElementById('trainee-brand').value;
    if(!n){alert('⚠️ Nome!');return;}
    
    const code = generateCode(n);
    const newTrainee = {name:n, function:f, brand:b, points:0, badges:[], code:code, evalHistory:[], quizData:null};
    
    if(useFirebase && db) {
        db.collection('trainees').add(newTrainee).then(() => {
            document.getElementById('trainee-name').value='';
            alert('✅ Adicionado!\n\nCódigo de acesso: ' + code);
        }).catch(e => {
            console.log('Erro ao adicionar:', e);
            alert('❌ Erro ao adicionar: ' + e.message);
        });
    } else {
        trainees.push(newTrainee);
        saveToLocalStorage();
        document.getElementById('trainee-name').value='';
        renderAdmin();
        populateEmployeeSelect();
        alert('✅ Adicionado!\n\nCódigo de acesso: ' + code);
    }
}
function deleteTrainee(i){
    if(confirm('Excluir?')){
        if(useFirebase && db && trainees[i].firebaseId) {
            db.collection('trainees').doc(trainees[i].firebaseId).delete().then(() => {
                if(currentTrainee>=trainees.length)currentTrainee=Math.max(0,trainees.length-1);
                renderAdmin();
                populateEmployeeSelect();
            });
        } else {
            trainees.splice(i,1);
            if(currentTrainee>=trainees.length)currentTrainee=Math.max(0,trainees.length-1);
            saveToLocalStorage();
            renderAdmin();
            populateEmployeeSelect();
        }
    }
}

async function toggleBlockTrainee(i) {
    const t = trainees[i];
    if (!t) return;
    
    const isBlocked = t.blocked === true;
    const action = isBlocked ? 'desbloquear' : 'bloquear';
    
    if (!confirm(`Tem certeza que deseja ${action} o acesso de ${t.name}?`)) return;
    
    t.blocked = !isBlocked;
    
    if (useFirebase && db && t.firebaseId) {
        try {
            await db.collection('trainees').doc(t.firebaseId).update({ blocked: t.blocked });
        } catch (e) {
            console.log('Erro ao atualizar bloqueio:', e);
        }
    } else {
        saveToLocalStorage();
    }
    
    const statusMsg = t.blocked ? '🚫 Acesso BLOQUEADO' : '✅ Acesso LIBERADO';
    alert(`${statusMsg} para ${t.name}`);
    
    // Atualizar a tela
    showTraineeDetail(i);
}

function renderAdmin(){
    populateAdminTraineeSelect();
    
    // Renderizar lista de colaboradores se existir
    const l=document.getElementById('trainees-list');
    if(l) {
        l.innerHTML=trainees.map((t,i)=>'<div class="list-item"><div class="list-item-info"><div class="list-item-name">'+t.name+'</div><div class="list-item-details">'+t.function+' • '+t.brand+' • '+t.points+'pts • '+(t.badges?t.badges.length:0)+' badges</div><div class="list-item-details" style="margin-top:5px;"><strong>Código:</strong> <span style="background:#667eea;color:white;padding:2px 8px;border-radius:4px;font-family:monospace;">'+(t.code||'N/A')+'</span></div></div><button class="btn-delete" onclick="deleteTrainee('+i+')">🗑️</button></div>').join('');
    }
    
    // Renderizar dashboard admin se estiver visível
    const dashEl = document.getElementById('admin-dashboard');
    if(dashEl && dashEl.classList.contains('active')) {
        renderAdminDashboard();
    }
}
function updateView(){renderBadges();updateStats();renderUserQuizProgress();renderPendingTrainings();}
function renderBadges(){
    const c=document.getElementById('badges-container');
    const t=trainees[currentTrainee];
    let h='';
    
    // Lista de marcas válidas
    const marcasValidas = ['ECA USP', 'ESALQ/PECEGE', 'MACKENZIE', 'POLI'];
    
    // DEBUG
    console.log('Colaborador:', t.name, 'Função:', t.function, 'Marca:', t.brand);
    
    for(const[k,cat]of Object.entries(badgeCategories)){
        // Verificar tipo de categoria
        const isB2BCategory = cat.isB2B === true;
        const isB2CCategory = cat.isB2C === true;
        const isBackofficeCategory = cat.isBackoffice === true;
        const isGeralCategory = k.startsWith('Geral');
        const isMarcaCategory = marcasValidas.includes(k);
        
        // Filtrar: mostrar apenas Geral + função + marca do colaborador selecionado
        const isSuaMarca = (k === t.brand);
        const isSubcategoriaFuncao = (t.function === 'B2B' && isB2BCategory) || 
                                     (t.function === 'B2C' && isB2CCategory) || 
                                     (t.function === 'Backoffice' && isBackofficeCategory);
        
        // Mostrar se: é Geral OU é a marca do colaborador OU é subcategoria da função dele
        const deveMostrar = isGeralCategory || isSuaMarca || isSubcategoriaFuncao;
        
        // DEBUG
        if(isMarcaCategory) {
            console.log('Categoria:', k, '| isSuaMarca:', isSuaMarca, '| t.brand:', t.brand, '| deveMostrar:', deveMostrar);
        }
        
        if(!deveMostrar) continue;
        
        // Determinar tag (Função, Marca ou Geral)
        let tag = 'Função';
        if(isGeralCategory) tag = 'Geral';
        else if(isMarcaCategory) tag = 'Marca';
        
        h+='<div class="category-section"><div class="category-header"><div class="category-icon">'+cat.icon+'</div><div class="category-info"><h3>'+cat.name+'</h3><p>'+cat.description+'</p></div></div><div class="badges-grid">';
        cat.badges.forEach(b=>{
            const u=t.badges.includes(b.id);
            const cl=isAdmin?'onclick="toggleBadge(\''+b.id+'\')"':'';
            const ro=isAdmin?'':'read-only';
            h+='<div class="badge '+(u?'unlocked':'locked')+' '+ro+'" '+cl+'><span class="badge-tag">'+tag+'</span><div class="badge-icon">'+b.icon+'</div><div class="badge-name">'+b.name+'</div><div class="badge-desc">'+b.desc+'</div><div class="badge-points">+'+b.points+'pts</div></div>';
        });
        h+='</div></div>';
    }
    c.innerHTML=h;
}
function toggleBadge(id){
    if(!isAdmin){alert('⚠️ Só admin!');return;}
    const t=trainees[currentTrainee];
    const i=t.badges.indexOf(id);
    if(i===-1)t.badges.push(id);
    else t.badges.splice(i,1);
    recalculatePoints(t);
    
    if(useFirebase && db && t.firebaseId) {
        db.collection('trainees').doc(t.firebaseId).update({
            badges: t.badges,
            points: t.points
        }).catch(e => console.log('Erro ao salvar badge:', e));
    } else {
        saveToLocalStorage();
    }
    updateView();
}
function recalculatePoints(t){t.points=0;t.badges.forEach(id=>{for(const c of Object.values(badgeCategories)){const b=c.badges.find(x=>x.id===id);if(b){t.points+=b.points;break;}}});}
function updateStats(){
    const t=trainees[currentTrainee];
    // Lista de marcas válidas
    const marcasValidas = ['ECA USP', 'ESALQ/PECEGE', 'MACKENZIE', 'POLI'];
    
    // Contar apenas badges e pontos disponíveis para este colaborador
    let availableBadges = 0;
    let availablePoints = 0;
    for(const[k,cat] of Object.entries(badgeCategories)){
        const isB2BCategory = cat.isB2B === true;
        const isB2CCategory = cat.isB2C === true;
        const isBackofficeCategory = cat.isBackoffice === true;
        const isGeralCategory = k.startsWith('Geral');
        
        const isSuaMarca = k === t.brand;
        const isSubcategoriaFuncao = (t.function === 'B2B' && isB2BCategory) || 
                                     (t.function === 'B2C' && isB2CCategory) || 
                                     (t.function === 'Backoffice' && isBackofficeCategory);
        
        const deveMostrar = isGeralCategory || isSuaMarca || isSubcategoriaFuncao;
        
        if(deveMostrar){
            availableBadges += cat.badges.length;
            cat.badges.forEach(b => { availablePoints += b.points; });
        }
    }
    const cp = Math.round((t.badges.length/availableBadges)*100);
    document.getElementById('total-points').textContent = t.points;
    document.getElementById('badges-count').textContent = t.badges.length + '/' + availableBadges;
    document.getElementById('completion').textContent = cp + '%';
    
    // Atualizar barra de progresso
    document.getElementById('progress-percent').textContent = cp + '%';
    document.getElementById('progress-bar').style.width = cp + '%';
    document.getElementById('progress-bar-text').textContent = cp >= 10 ? cp + '%' : '';
    document.getElementById('progress-badges').textContent = t.badges.length + ' de ' + availableBadges + ' badges';
    document.getElementById('progress-points').textContent = t.points + ' de ' + availablePoints + ' pontos';
}


function renderUserQuizProgress(){
    const container = document.getElementById('quiz-user-progress');
    const btn = document.getElementById('quiz-play-btn');
    if(!container || !currentUser || isAdmin) {
        if(container) container.innerHTML = '';
        if(btn) btn.style.display = 'none';
        return;
    }
    
    const t = currentUser;
    const completedDays = getCompletedDays(t);
    const releasedDays = t.releasedQuizDays || [];
    const totalPoints = getTotalQuizPoints(t);
    const streak = getQuizStreak(t);
    const pendingDays = getPendingDays(t);
    const completedToday = hasCompletedQuizToday(t);
    
    let html = '';
    
    // Progresso visual dos dias
    html += '<div style="display:flex;justify-content:center;gap:12px;margin-bottom:15px;">';
    for(let d=1; d<=5; d++){
        const completed = completedDays.includes(d);
        const released = releasedDays.includes(d);
        html += '<div style="width:45px;height:45px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;';
        if (completed) {
            html += 'background:#28a745;color:white;';
        } else if (released) {
            html += 'background:#667eea;color:white;';
        } else {
            html += 'background:#e0e0e0;color:#999;';
        }
        html += '">';
        html += completed ? '✓' : (released ? d : '🔒');
        html += '</div>';
    }
    html += '</div>';
    
    // Stats
    html += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;text-align:center;">';
    html += '<div style="background:#f8f9fa;padding:10px;border-radius:8px;">';
    html += '<div style="font-size:20px;font-weight:bold;color:#1e3c72;">' + completedDays.length + '/5</div>';
    html += '<div style="font-size:11px;color:#666;">Dias</div>';
    html += '</div>';
    html += '<div style="background:#f8f9fa;padding:10px;border-radius:8px;">';
    html += '<div style="font-size:20px;font-weight:bold;color:#1e3c72;">' + totalPoints + '</div>';
    html += '<div style="font-size:11px;color:#666;">Pontos</div>';
    html += '</div>';
    html += '<div style="background:#f8f9fa;padding:10px;border-radius:8px;">';
    html += '<div style="font-size:20px;font-weight:bold;color:#1e3c72;">🔥 ' + streak + '</div>';
    html += '<div style="font-size:11px;color:#666;">Perfeitos</div>';
    html += '</div>';
    html += '</div>';
    
    // Status e botão
    if(completedDays.length === 5){
        html += '<div style="margin-top:15px;padding:10px;background:#d4edda;border-radius:8px;text-align:center;color:#155724;">';
        html += '🎓 <strong>Parabéns!</strong> Você completou todos os 5 dias do quiz!';
        html += '</div>';
        btn.style.display = 'none';
    } else if(completedToday){
        html += '<div style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;text-align:center;color:#856404;">';
        html += '✅ Quiz de hoje concluído! Volte amanhã para continuar.';
        html += '</div>';
        btn.style.display = 'none';
    } else if(pendingDays.length === 0) {
        // Não completou todos, mas não tem dias liberados
        const releasedDays = t.releasedQuizDays || [];
        if (releasedDays.length === 0 || releasedDays.every(d => completedDays.includes(d))) {
            html += '<div style="margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;text-align:center;color:#666;">';
            html += '🔒 Aguarde a liberação dos próximos dias pelo T&D.';
            html += '</div>';
            btn.style.display = 'none';
        }
    } else {
        html += '<div style="margin-top:15px;padding:10px;background:#cce5ff;border-radius:8px;text-align:center;color:#004085;">';
        html += '📚 ' + pendingDays.length + ' dia(s) liberado(s) - Próximo: <strong>Dia ' + pendingDays[0] + '</strong>';
        html += '</div>';
        btn.style.display = 'block';
    }
    
    container.innerHTML = html;
}

function renderEvalButtons(){
    const btn=document.getElementById('eval-buttons');
    const t=trainees[currentTrainee];
    
    // Função para verificar se já fez a avaliação
    function jaFezAvaliacao(type, brand) {
        return evalHistory.some(e => 
            e.traineeIndex === currentTrainee && 
            e.type === type && 
            e.brand === brand
        );
    }
    
    // Função para obter resultado anterior
    function getResultadoAnterior(type, brand) {
        return evalHistory.find(e => 
            e.traineeIndex === currentTrainee && 
            e.type === type && 
            e.brand === brand
        );
    }
    
    let html='<div class="btn-group">';
    
    if(isAdmin){
        // Admin pode fazer todas as avaliações sem restrição
        html+='<button class="btn-primary" onclick="startEval(\'b2b\',\'POLI\')">B2B - POLI</button>';
        html+='<button class="btn-primary" onclick="startEval(\'b2b\',\'ESALQ/PECEGE\')">B2B - ESALQ</button>';
        html+='<button class="btn-primary" onclick="startEval(\'b2b\',\'MACKENZIE\')">B2B - MACK</button>';
        html+='<button class="btn-primary" onclick="startEval(\'b2b\',\'ECA USP\')">B2B - ECA</button>';
        html+='<button class="btn-primary" onclick="startEval(\'b2c\',\'\')">B2C</button>';
        html+='<button class="btn-primary" onclick="startEval(\'backoffice\',\'\')">Backoffice</button>';
    } else {
        // Colaborador - verificar se já fez
        let type = '';
        let brand = '';
        let label = '';
        
        if(t.function==='B2B'){
            type = 'b2b';
            brand = t.brand;
            label = 'Avaliação B2B - ' + t.brand;
        } else if(t.function==='B2C'){
            type = 'b2c';
            brand = '';
            label = 'Avaliação B2C';
        } else if(t.function==='Backoffice'){
            type = 'backoffice';
            brand = '';
            label = 'Avaliação Backoffice';
        }
        
        if(jaFezAvaliacao(type, brand)) {
            const resultado = getResultadoAnterior(type, brand);
            const statusColor = resultado.passed ? '#28a745' : '#dc3545';
            const statusText = resultado.passed ? '✅ Aprovado' : '❌ Reprovado';
            html += '<div class="info-box" style="background:#f8f9fa;border-color:'+statusColor+';text-align:center;">';
            html += '<h3 style="color:'+statusColor+';margin-bottom:10px;">Avaliação já realizada</h3>';
            html += '<div style="font-size:48px;font-weight:bold;color:'+statusColor+';">'+resultado.score+'%</div>';
            html += '<p style="color:'+statusColor+';font-size:18px;margin:10px 0;">'+statusText+'</p>';
            html += '<p style="color:#666;font-size:13px;">Realizada em: '+resultado.date+'</p>';
            html += '<p style="color:#888;font-size:12px;margin-top:15px;">⚠️ Cada avaliação pode ser feita apenas 1 vez.<br>As questões dissertativas serão corrigidas pelo coordenador.</p>';
            html += '</div>';
        } else {
            html += '<button class="btn-primary" onclick="startEval(\''+type+'\',\''+brand+'\')">'+label+'</button>';
        }
    }
    
    html+='</div>';
    btn.innerHTML=html;
    document.getElementById('eval-content').innerHTML='';
}

function startEval(type,brand){currentEval={type,brand,answers:{},started:true};renderEval();}

function renderEval(){
    const c=document.getElementById('eval-content');
    let qs=[];
    if(currentEval.type==='b2b'){
        qs=[...Q.b2b_comum];
        if(currentEval.brand==='POLI')qs.push(...Q.b2b_poli);
        else if(currentEval.brand==='ESALQ/PECEGE')qs.push(...Q.b2b_esalq);
        else if(currentEval.brand==='MACKENZIE')qs.push(...Q.b2b_mackenzie);
        else if(currentEval.brand==='ECA USP')qs.push(...Q.b2b_eca);
    }else if(currentEval.type==='b2c'){
        qs=[...Q.b2c];
    }else if(currentEval.type==='backoffice'){
        qs=[...Q.backoffice];
    }
    
    // Ordenar: alternativas primeiro, dissertativas depois
    const alternativas = qs.filter(q => q.tipo !== 'text');
    const dissertativas = qs.filter(q => q.tipo === 'text');
    qs = [...alternativas, ...dissertativas];
    
    let html='<div class="eval-card"><h2 class="section-title">'+(currentEval.type==='b2b'?'Avaliação B2B - '+currentEval.brand:currentEval.type==='b2c'?'Avaliação B2C':'Avaliação Backoffice')+'</h2>';
    
    // Seção de Alternativas
    html+='<h3 style="color:#1e3c72;margin:20px 0 15px;border-bottom:2px solid #667eea;padding-bottom:10px;">📊 Questões Objetivas ('+alternativas.length+')</h3>';
    alternativas.forEach(q=>{
        html+='<div class="question"><div class="question-header"><span class="question-number">Q'+q.n+'</span><span class="question-type">'+(q.tipo==='multi'?'Múltipla escolha':'Única escolha')+'</span></div><div class="question-text">'+q.q+'</div>';
        html+='<div class="options">';
        q.opts.forEach((o,i)=>{
            const inputType=q.tipo==='multi'?'checkbox':'radio';
            const name='q'+q.n;
            html+='<div class="option"><input type="'+inputType+'" name="'+name+'" value="'+i+'" id="'+name+'_'+i+'"><label for="'+name+'_'+i+'">'+o+'</label></div>';
        });
        html+='</div></div>';
    });
    
    // Seção de Dissertativas
    html+='<h3 style="color:#1e3c72;margin:30px 0 15px;border-bottom:2px solid #667eea;padding-bottom:10px;">📝 Questões Dissertativas ('+dissertativas.length+')</h3>';
    dissertativas.forEach(q=>{
        html+='<div class="question"><div class="question-header"><span class="question-number">Q'+q.n+'</span><span class="question-type">Dissertativa</span></div><div class="question-text">'+q.q+'</div>';
        html+='<textarea class="textarea-answer" id="q'+q.n+'_text" placeholder="Digite sua resposta aqui..."></textarea></div>';
    });
    
    html+='<button class="btn-primary" onclick="submitEval()">✅ Enviar Avaliação</button></div>';
    c.innerHTML=html;
}

function submitEval(){let qs=[];if(currentEval.type==='b2b'){qs=[...Q.b2b_comum];if(currentEval.brand==='POLI')qs.push(...Q.b2b_poli);else if(currentEval.brand==='ESALQ/PECEGE')qs.push(...Q.b2b_esalq);else if(currentEval.brand==='MACKENZIE')qs.push(...Q.b2b_mackenzie);else if(currentEval.brand==='ECA USP')qs.push(...Q.b2b_eca);}else if(currentEval.type==='b2c'){qs=Q.b2c;}else{qs=Q.backoffice;}let correct=0,total=0;qs.forEach(q=>{if(q.tipo==='text')return;total++;const answers=[];document.querySelectorAll('input[name="q'+q.n+'"]:checked').forEach(el=>{answers.push(parseInt(el.value));});let isCorrect=false;if(q.tipo==='single'){isCorrect=answers.length===1&&answers[0]===q.correct;}else{isCorrect=answers.length===q.correct.length&&answers.every(a=>q.correct.includes(a));}if(isCorrect)correct++;});const score=total>0?Math.round((correct/total)*100):0;const passed=score>=70;
// Salvar histórico da avaliação
const evalRecord={
    traineeIndex:currentTrainee,
    traineeName:trainees[currentTrainee].name,
    type:currentEval.type,
    brand:currentEval.brand,
    score:score,
    correct:correct,
    total:total,
    passed:passed,
    date:new Date().toLocaleString('pt-BR'),
    answers:{}
};
// Salvar todas as respostas
qs.forEach(q=>{
    if(q.tipo==='text'){
        const textarea=document.getElementById('q'+q.n+'_text');
        evalRecord.answers['q'+q.n]={
            tipo:'text',
            pergunta:q.q,
            tema:q.t,
            resposta:textarea?textarea.value:''
        };
    }else{
        const selected=[];
        document.querySelectorAll('input[name="q'+q.n+'"]:checked').forEach(el=>{
            selected.push(parseInt(el.value));
        });
        const isCorrect=q.tipo==='single'?(selected.length===1&&selected[0]===q.correct):(selected.length===q.correct.length&&selected.every(a=>q.correct.includes(a)));
        evalRecord.answers['q'+q.n]={
            tipo:q.tipo,
            pergunta:q.q,
            tema:q.t,
            opcoes:q.opts,
            selecionadas:selected,
            corretas:Array.isArray(q.correct)?q.correct:[q.correct],
            acertou:isCorrect
        };
    }
});
evalHistory.push(evalRecord);

// Salvar no Firebase se disponível
if(useFirebase && db && trainees[currentTrainee].firebaseId) {
    const t = trainees[currentTrainee];
    if(!t.evalHistory) t.evalHistory = [];
    t.evalHistory.push(evalRecord);
    db.collection('trainees').doc(t.firebaseId).update({
        evalHistory: t.evalHistory
    }).catch(e => console.log('Erro ao salvar avaliação:', e));
} else {
    saveToLocalStorage();
}

document.getElementById('eval-content').innerHTML='<div class="result-card" style="text-align:center;"><h2 style="color:'+(passed?'#28a745':'#dc3545')+';">'+(passed?'🎉 Parabéns! Aprovado!':'📚 Reprovado')+'</h2><div class="score-big" style="font-size:72px;color:'+(passed?'#28a745':'#dc3545')+';">'+score+'%</div><p style="font-size:16px;color:#666;margin:20px 0;"><strong>Nota mínima para aprovação:</strong> 70%</p><div style="background:#f8f9fa;padding:15px;border-radius:10px;margin:20px 0;"><p style="color:#888;font-size:14px;margin:0;">📝 As questões dissertativas serão avaliadas pelo coordenador e podem alterar sua nota final.</p></div><button class="btn-secondary" onclick="renderEvalButtons();">← Voltar</button></div>';}

// ========== INICIALIZAÇÃO ==========
async function init() {
    useFirebase = await initFirebase();
    console.log('Firebase:', useFirebase ? 'Ativo' : 'Inativo (usando localStorage)');
    await loadData();
    populateEmployeeSelect();
}

init();

// ========== DASHBOARD ADMIN FUNCTIONS ==========
function renderAdminDashboard() {
    updateWelcomeSection();
    updateKPIs();
    updatePrioritySection();
    updateTeamCards('all');
    updateActivityList();
    setupTeamFilter();
}

function updateWelcomeSection() {
    const hour = new Date().getHours();
    let greeting = 'Boa noite';
    if (hour < 12) greeting = 'Bom dia';
    else if (hour < 18) greeting = 'Boa tarde';
    
    document.getElementById('welcome-greeting').textContent = greeting + '! 👋';
    
    // Contar pendências
    const pendencias = getPendingCorrections();
    if (pendencias.length > 0) {
        document.getElementById('welcome-message').textContent = 'Você tem ' + pendencias.length + ' avaliação(ões) aguardando correção';
    } else {
        document.getElementById('welcome-message').textContent = 'Tudo em dia! Nenhuma correção pendente.';
    }
    
    // Stats
    document.getElementById('dash-total-colab').textContent = trainees.length;
    
    const totalBadges = trainees.reduce((sum, t) => sum + (t.badges ? t.badges.length : 0), 0);
    document.getElementById('dash-total-badges').textContent = totalBadges;
    
    // Taxa de aprovação
    const todasAvaliacoes = evalHistory.filter(e => e.score !== undefined);
    const aprovadas = todasAvaliacoes.filter(e => e.passed);
    const taxaAprovacao = todasAvaliacoes.length > 0 ? Math.round((aprovadas.length / todasAvaliacoes.length) * 100) : 0;
    document.getElementById('dash-taxa-aprovacao').textContent = taxaAprovacao + '%';
}

function updateKPIs() {
    // Total avaliações
    document.getElementById('kpi-avaliacoes').textContent = evalHistory.length;
    
    // Taxa aprovação
    const aprovadas = evalHistory.filter(e => e.passed);
    const taxa = evalHistory.length > 0 ? Math.round((aprovadas.length / evalHistory.length) * 100) : 0;
    document.getElementById('kpi-aprovacao').textContent = taxa + '%';
    
    // Média geral
    const somaNotas = evalHistory.reduce((sum, e) => sum + (e.score || 0), 0);
    const media = evalHistory.length > 0 ? Math.round(somaNotas / evalHistory.length) : 0;
    document.getElementById('kpi-media').textContent = media + '%';
    
    // Quiz completados
    let quizCompletos = 0;
    trainees.forEach(t => {
        if (t.quizProgress) {
            quizCompletos += Object.keys(t.quizProgress).length;
        }
    });
    document.getElementById('kpi-quiz').textContent = quizCompletos;
}

function getPendingCorrections() {
    const pendencias = [];
    evalHistory.forEach((e, idx) => {
        if (!e.answers) return;
        
        let dissertativasTotal = 0;
        let dissertativasCorrigidas = 0;
        
        for (const [key, ans] of Object.entries(e.answers)) {
            if (ans.tipo === 'text') {
                dissertativasTotal++;
                if (ans.corrigida !== undefined) dissertativasCorrigidas++;
            }
        }
        
        if (dissertativasTotal > 0 && dissertativasCorrigidas < dissertativasTotal) {
            pendencias.push({
                evalIndex: idx,
                traineeIndex: e.traineeIndex,
                traineeName: e.traineeName,
                type: e.type,
                brand: e.brand,
                date: e.date,
                pendentes: dissertativasTotal - dissertativasCorrigidas,
                total: dissertativasTotal
            });
        }
    });
    return pendencias;
}

function updatePrioritySection() {
    const pendencias = getPendingCorrections();
    const section = document.getElementById('priority-section');
    const title = document.getElementById('priority-title');
    const count = document.getElementById('priority-count');
    const list = document.getElementById('priority-list');
    
    document.getElementById('pending-corrections-count').textContent = pendencias.length + ' pendentes';
    
    if (pendencias.length === 0) {
        section.classList.add('no-pending');
        title.innerHTML = '✅ Tudo em dia!';
        count.textContent = 'Nenhuma pendência';
        list.innerHTML = '<p style="color:#28a745;text-align:center;padding:20px;">🎉 Parabéns! Todas as avaliações foram corrigidas.</p>';
        return;
    }
    
    section.classList.remove('no-pending');
    title.innerHTML = '🚨 Requer sua atenção';
    count.textContent = pendencias.length + ' pendência(s)';
    
    let html = '';
    pendencias.slice(0, 6).forEach(p => {
        const initials = p.traineeName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        html += `
            <div class="priority-item">
                <div class="priority-avatar">${initials}</div>
                <div class="priority-info">
                    <div class="priority-name">${p.traineeName}</div>
                    <div class="priority-detail">${p.pendentes} dissertativa(s) para corrigir</div>
                    <div class="priority-meta">${p.type.toUpperCase()}${p.brand ? ' - ' + p.brand : ''} • ${p.date}</div>
                </div>
                <button class="priority-action" onclick="openEvalCorrection(${p.evalIndex})">Corrigir →</button>
            </div>
        `;
    });
    
    list.innerHTML = html;
}

function updateTeamCards(filter) {
    const container = document.getElementById('team-cards-grid');
    
    // Agrupar por equipe
    const teams = {
        'POLI': { name: 'B2B - POLI', subtitle: 'POLI USP Pro', class: 'poli', members: [], pendentes: 0 },
        'ESALQ/PECEGE': { name: 'B2B - ESALQ', subtitle: 'MBA USP ESALQ', class: 'esalq', members: [], pendentes: 0 },
        'MACKENZIE': { name: 'B2B - MACKENZIE', subtitle: 'Multicompany Mackenzie', class: 'mackenzie', members: [], pendentes: 0 },
        'ECA USP': { name: 'B2B - ECA', subtitle: 'ECA USP', class: 'eca', members: [], pendentes: 0 },
        'B2C': { name: 'B2C', subtitle: 'Vendas Diretas', class: 'b2c', members: [], pendentes: 0 },
        'Backoffice': { name: 'Backoffice', subtitle: 'Operações', class: 'backoffice', members: [], pendentes: 0 }
    };
    
    trainees.forEach((t, idx) => {
        if (t.function === 'B2B' && teams[t.brand]) {
            teams[t.brand].members.push({ ...t, index: idx });
        } else if (t.function === 'B2C') {
            teams['B2C'].members.push({ ...t, index: idx });
        } else if (t.function === 'Backoffice') {
            teams['Backoffice'].members.push({ ...t, index: idx });
        }
    });
    
    // Contar pendências por equipe
    const pendencias = getPendingCorrections();
    pendencias.forEach(p => {
        const t = trainees[p.traineeIndex];
        if (t) {
            if (t.function === 'B2B' && teams[t.brand]) {
                teams[t.brand].pendentes++;
            } else if (teams[t.function]) {
                teams[t.function].pendentes++;
            }
        }
    });
    
    // Update filter counts
    document.getElementById('filter-all-count').textContent = trainees.length;
    document.getElementById('filter-b2b-count').textContent = trainees.filter(t => t.function === 'B2B').length;
    document.getElementById('filter-b2c-count').textContent = trainees.filter(t => t.function === 'B2C').length;
    document.getElementById('filter-back-count').textContent = trainees.filter(t => t.function === 'Backoffice').length;
    
    // Filtrar equipes
    let teamsToShow = Object.entries(teams);
    if (filter === 'b2b') {
        teamsToShow = teamsToShow.filter(([key]) => !['B2C', 'Backoffice'].includes(key));
    } else if (filter === 'b2c') {
        teamsToShow = teamsToShow.filter(([key]) => key === 'B2C');
    } else if (filter === 'backoffice') {
        teamsToShow = teamsToShow.filter(([key]) => key === 'Backoffice');
    }
    
    // Só mostrar equipes com membros
    teamsToShow = teamsToShow.filter(([key, team]) => team.members.length > 0);
    
    let html = '';
    teamsToShow.forEach(([key, team]) => {
        // Calcular média de aprovação da equipe
        const membersIds = team.members.map(m => m.index);
        const teamEvals = evalHistory.filter(e => membersIds.includes(e.traineeIndex));
        const teamAprovadas = teamEvals.filter(e => e.passed);
        const mediaAprovacao = teamEvals.length > 0 ? Math.round((teamAprovadas.length / teamEvals.length) * 100) : 0;
        
        html += `
            <div class="team-card" onclick="showTeamDetail('${key}')">
                <div class="team-card-header ${team.class}">
                    <div class="team-card-title">${team.name}</div>
                    <div class="team-card-subtitle">${team.subtitle}</div>
                    <div class="team-card-count">${team.members.length}</div>
                </div>
                <div class="team-card-body">
                    <div class="team-card-stat">
                        <span class="team-stat-label">Colaboradores</span>
                        <span class="team-stat-value">${team.members.length}</span>
                    </div>
                    <div class="team-card-stat">
                        <span class="team-stat-label">Correções Pendentes</span>
                        <span class="team-stat-value ${team.pendentes > 0 ? 'pending' : ''}">${team.pendentes}</span>
                    </div>
                    <div class="team-card-stat">
                        <span class="team-stat-label">Taxa de Aprovação</span>
                        <span class="team-stat-value success">${mediaAprovacao}%</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    if (html === '') {
        html = '<p style="text-align:center;color:#666;padding:30px;">Nenhuma equipe encontrada para este filtro.</p>';
    }
    
    container.innerHTML = html;
}

function setupTeamFilter() {
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', function() {
            buttons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            updateTeamCards(this.dataset.filter);
        });
    });
}

function updateActivityList() {
    const list = document.getElementById('activity-list');
    
    // Pegar últimas atividades (avaliações recentes)
    const activities = [];
    
    evalHistory.slice(-10).reverse().forEach(e => {
        activities.push({
            type: 'eval',
            text: `<strong>${e.traineeName}</strong> completou avaliação ${e.type.toUpperCase()}${e.brand ? ' - ' + e.brand : ''}`,
            time: e.date
        });
    });
    
    if (activities.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">Nenhuma atividade recente.</p>';
        return;
    }
    
    let html = '';
    activities.slice(0, 8).forEach(a => {
        html += `
            <div class="activity-item">
                <div class="activity-dot ${a.type}"></div>
                <div class="activity-content">
                    <div class="activity-text">${a.text}</div>
                    <div class="activity-time">${a.time}</div>
                </div>
            </div>
        `;
    });
    
    list.innerHTML = html;
}

function openEvalCorrection(evalIndex) {
    adminSelectedTrainee = evalHistory[evalIndex].traineeIndex;
    viewEvalDetails(evalIndex);
    document.getElementById('eval-details-container').scrollIntoView({ behavior: 'smooth' });
}

function showTeamDetail(teamKey) {
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    // Filtrar membros da equipe
    let members = [];
    if (['POLI', 'ESALQ/PECEGE', 'MACKENZIE', 'ECA USP'].includes(teamKey)) {
        members = trainees.filter((t, idx) => t.function === 'B2B' && t.brand === teamKey).map((t, idx) => ({ ...t, index: trainees.indexOf(t) }));
    } else if (teamKey === 'B2C') {
        members = trainees.filter(t => t.function === 'B2C').map((t, idx) => ({ ...t, index: trainees.indexOf(t) }));
    } else if (teamKey === 'Backoffice') {
        members = trainees.filter(t => t.function === 'Backoffice').map((t, idx) => ({ ...t, index: trainees.indexOf(t) }));
    }
    
    let html = `<h2 class="section-title">👥 Equipe: ${teamKey}</h2>`;
    html += '<div style="display:grid;gap:15px;">';
    
    members.forEach(m => {
        const initials = m.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        html += `
            <div class="list-item" style="cursor:pointer;" onclick="showTraineeDetail(${m.index})">
                <div style="display:flex;align-items:center;gap:15px;">
                    <div class="priority-avatar">${initials}</div>
                    <div class="list-item-info">
                        <div class="list-item-name">${m.name}</div>
                        <div class="list-item-details">${m.function}${m.brand ? ' - ' + m.brand : ''} | ${m.points} pts | Código: ${m.code}</div>
                    </div>
                </div>
                <span style="color:#667eea;">Ver detalhes →</span>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
}

function showTraineeDetail(traineeIdx) {
    adminSelectedTrainee = traineeIdx;
    const t = trainees[traineeIdx];
    
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    const isBlocked = t.blocked === true;
    const statusBg = isBlocked ? '#ffebee' : '#d4edda';
    const statusBorder = isBlocked ? '#dc3545' : '#28a745';
    const statusColor = isBlocked ? '#c62828' : '#155724';
    const statusIcon = isBlocked ? '🚫' : '👤';
    const statusText = isBlocked ? ' | <span style="color:#dc3545;font-weight:bold;">BLOQUEADO</span>' : '';
    
    const blockBtnText = isBlocked ? '🔓 Desbloquear Acesso' : '🔒 Bloquear Acesso';
    const blockBtnColor = isBlocked ? '#28a745' : '#dc3545';
    
    let html = `
        <div class="info-box" style="background:${statusBg};border-color:${statusBorder};margin-bottom:20px;">
            <strong style="color:${statusColor};">${statusIcon} ${t.name}</strong> | ${t.function}${t.brand ? ' - ' + t.brand : ''} | ${t.points} pts | Código: ${t.code}${statusText}
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:25px;">
            <button class="btn-primary" style="width:auto;" onclick="exportTraineeReport()">📄 Exportar Relatório</button>
            <button class="btn-primary" style="width:auto;background:${blockBtnColor};" onclick="toggleBlockTrainee(${traineeIdx})">${blockBtnText}</button>
        </div>
        
        <h3 class="section-title">🏅 Badges</h3>
        <div id="detail-badges-container"></div>
        
        <h3 class="section-title" style="margin-top:25px;">📝 Histórico de Avaliações</h3>
        <div id="detail-eval-history"></div>
        
        <h3 class="section-title" style="margin-top:25px;">🎯 Quiz Diário</h3>
        <div id="detail-quiz-progress"></div>
    `;
    
    content.innerHTML = html;
    
    // Renderizar conteúdos
    renderDetailBadges();
    renderDetailEvalHistory();
    renderDetailQuizProgress();
}

function renderDetailBadges() {
    if (adminSelectedTrainee < 0) return;
    const c = document.getElementById('detail-badges-container');
    const t = trainees[adminSelectedTrainee];
    let h = '';
    
    const marcasValidas = ['ECA USP', 'ESALQ/PECEGE', 'MACKENZIE', 'POLI'];
    
    for (const [k, cat] of Object.entries(badgeCategories)) {
        const isB2BCategory = cat.isB2B === true;
        const isB2CCategory = cat.isB2C === true;
        const isBackofficeCategory = cat.isBackoffice === true;
        const isGeralCategory = k.startsWith('Geral');
        const isMarcaCategory = marcasValidas.includes(k);
        
        const isSuaMarca = (k === t.brand);
        const isSubcategoriaFuncao = (t.function === 'B2B' && isB2BCategory) || 
                                     (t.function === 'B2C' && isB2CCategory) || 
                                     (t.function === 'Backoffice' && isBackofficeCategory);
        
        const deveMostrar = isGeralCategory || isSuaMarca || isSubcategoriaFuncao;
        
        if (!deveMostrar) continue;
        
        let tag = 'Função';
        if (isGeralCategory) tag = 'Geral';
        else if (isMarcaCategory) tag = 'Marca';
        
        h += '<div class="category-section"><div class="category-header"><div class="category-icon">' + cat.icon + '</div><div class="category-info"><h3>' + cat.name + '</h3><p>' + cat.description + '</p></div></div><div class="badges-grid">';
        cat.badges.forEach(b => {
            const u = t.badges.includes(b.id);
            h += '<div class="badge ' + (u ? 'unlocked' : 'locked') + '" onclick="toggleAdminBadge(\'' + b.id + '\')"><span class="badge-tag">' + tag + '</span><div class="badge-icon">' + b.icon + '</div><div class="badge-name">' + b.name + '</div><div class="badge-desc">' + b.desc + '</div><div class="badge-points">+' + b.points + 'pts</div></div>';
        });
        h += '</div></div>';
    }
    c.innerHTML = h;
}

function renderDetailEvalHistory() {
    if (adminSelectedTrainee < 0) return;
    const c = document.getElementById('detail-eval-history');
    const history = evalHistory.filter(e => e.traineeIndex === adminSelectedTrainee);
    
    if (history.length === 0) {
        c.innerHTML = '<p style="color:#666;">Nenhuma avaliação realizada ainda.</p>';
        return;
    }
    
    let h = '<table style="width:100%;border-collapse:collapse;">';
    h += '<tr style="background:#f8f9fa;"><th style="padding:12px;text-align:left;">Data</th><th style="padding:12px;text-align:left;">Tipo</th><th style="padding:12px;text-align:center;">Nota</th><th style="padding:12px;text-align:center;">Status</th><th style="padding:12px;text-align:center;">Ações</th></tr>';
    
    history.forEach((e, i) => {
        e.origIndex = evalHistory.indexOf(e);
        const statusColor = e.passed ? '#28a745' : '#dc3545';
        const statusText = e.passed ? 'Aprovado' : 'Reprovado';
        const bg = i % 2 === 0 ? '#fff' : '#f8f9fa';
        h += '<tr style="background:' + bg + ';"><td style="padding:12px;">' + e.date + '</td><td style="padding:12px;">' + e.type.toUpperCase() + (e.brand ? ' - ' + e.brand : '') + '</td><td style="padding:12px;text-align:center;font-weight:bold;">' + e.score + '%</td><td style="padding:12px;text-align:center;color:' + statusColor + ';font-weight:bold;">' + statusText + '</td><td style="padding:12px;text-align:center;"><button class="btn-primary" style="padding:8px 16px;width:auto;" onclick="viewEvalDetails(' + e.origIndex + ')">👁️ Ver</button></td></tr>';
    });
    
    h += '</table>';
    c.innerHTML = h;
}

function renderDetailQuizProgress() {
    if (adminSelectedTrainee < 0) return;
    const c = document.getElementById('detail-quiz-progress');
    const t = trainees[adminSelectedTrainee];
    
    const completedDays = getCompletedDays(t);
    const releasedDays = t.releasedQuizDays || [];
    const totalPoints = getTotalQuizPoints(t);
    
    let h = `<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:15px;">`;
    for (let day = 1; day <= 5; day++) {
        const completed = completedDays.includes(day);
        const released = releasedDays.includes(day);
        const dayData = t.quizProgress ? t.quizProgress['day' + day] : null;
        
        let bg, color, statusText;
        if (completed) {
            bg = 'linear-gradient(135deg, #28a745, #20c997)';
            color = 'white';
            statusText = `${dayData ? dayData.correct : 0}/3 acertos`;
        } else if (released) {
            bg = 'linear-gradient(135deg, #667eea, #764ba2)';
            color = 'white';
            statusText = '🔓 Liberado';
        } else {
            bg = '#e0e0e0';
            color = '#666';
            statusText = '🔒 Bloqueado';
        }
        
        h += `<div style="background:${bg};color:${color};padding:15px;border-radius:10px;text-align:center;">
            <div style="font-size:24px;font-weight:bold;">Dia ${day}</div>
            <div style="font-size:12px;">${statusText}</div>
        </div>`;
    }
    h += `</div>`;
    h += `<p><strong>Total:</strong> ${completedDays.length}/5 dias | <strong>Pontos:</strong> ${totalPoints} pts</p>`;
    
    // Botões para liberar dias
    h += `
        <div style="margin-top:20px;padding:20px;background:#f8f9fa;border-radius:12px;">
            <h4 style="color:#1e3c72;margin-bottom:15px;">🔓 Liberar Dias do Quiz</h4>
            <p style="color:#666;font-size:13px;margin-bottom:15px;">Clique nos dias para liberar/bloquear o acesso do colaborador:</p>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
    `;
    
    for (let day = 1; day <= 5; day++) {
        const completed = completedDays.includes(day);
        const released = releasedDays.includes(day);
        
        if (completed) {
            h += `<button disabled style="padding:12px 20px;border-radius:8px;border:none;background:#28a745;color:white;cursor:not-allowed;opacity:0.7;">Dia ${day} ✅</button>`;
        } else if (released) {
            h += `<button onclick="toggleQuizDay(${adminSelectedTrainee}, ${day})" style="padding:12px 20px;border-radius:8px;border:none;background:#667eea;color:white;cursor:pointer;">Dia ${day} 🔓</button>`;
        } else {
            h += `<button onclick="toggleQuizDay(${adminSelectedTrainee}, ${day})" style="padding:12px 20px;border-radius:8px;border:2px solid #667eea;background:white;color:#667eea;cursor:pointer;">Dia ${day} 🔒</button>`;
        }
    }
    
    h += `
            </div>
            <div style="margin-top:15px;display:flex;gap:10px;">
                <button class="btn-primary" style="width:auto;padding:10px 20px;" onclick="releaseAllQuizDays(${adminSelectedTrainee})">🔓 Liberar Todos</button>
                <button class="btn-secondary" style="width:auto;padding:10px 20px;margin:0;" onclick="blockAllQuizDays(${adminSelectedTrainee})">🔒 Bloquear Todos</button>
            </div>
        </div>
    `;
    
    c.innerHTML = h;
}

async function toggleQuizDay(traineeIdx, day) {
    const t = trainees[traineeIdx];
    if (!t) return;
    
    if (!t.releasedQuizDays) t.releasedQuizDays = [];
    
    const idx = t.releasedQuizDays.indexOf(day);
    if (idx >= 0) {
        t.releasedQuizDays.splice(idx, 1); // Bloquear
    } else {
        t.releasedQuizDays.push(day); // Liberar
    }
    
    // Salvar no Firebase
    if (useFirebase && db && t.firebaseId) {
        try {
            await db.collection('trainees').doc(t.firebaseId).update({ releasedQuizDays: t.releasedQuizDays });
        } catch (e) {
            console.log('Erro ao salvar liberação de quiz:', e);
        }
    } else {
        saveToLocalStorage();
    }
    
    renderDetailQuizProgress();
}

async function releaseAllQuizDays(traineeIdx) {
    const t = trainees[traineeIdx];
    if (!t) return;
    
    const completedDays = getCompletedDays(t);
    t.releasedQuizDays = [1, 2, 3, 4, 5].filter(d => !completedDays.includes(d));
    
    if (useFirebase && db && t.firebaseId) {
        try {
            await db.collection('trainees').doc(t.firebaseId).update({ releasedQuizDays: t.releasedQuizDays });
        } catch (e) {
            console.log('Erro ao salvar liberação de quiz:', e);
        }
    } else {
        saveToLocalStorage();
    }
    
    renderDetailQuizProgress();
    alert('✅ Todos os dias do quiz foram liberados para ' + t.name);
}

async function blockAllQuizDays(traineeIdx) {
    const t = trainees[traineeIdx];
    if (!t) return;
    
    t.releasedQuizDays = [];
    
    if (useFirebase && db && t.firebaseId) {
        try {
            await db.collection('trainees').doc(t.firebaseId).update({ releasedQuizDays: t.releasedQuizDays });
        } catch (e) {
            console.log('Erro ao salvar liberação de quiz:', e);
        }
    } else {
        saveToLocalStorage();
    }
    
    renderDetailQuizProgress();
    alert('🔒 Todos os dias do quiz foram bloqueados para ' + t.name);
}

function backToDashboard() {
    document.getElementById('detail-panel').classList.remove('active');
    document.getElementById('admin-dashboard').classList.add('active');
    document.getElementById('eval-details-container').innerHTML = '';
    renderAdminDashboard();
}

function showPendingCorrections() {
    const pendencias = getPendingCorrections();
    if (pendencias.length === 0) {
        alert('Não há avaliações pendentes de correção!');
        return;
    }
    openEvalCorrection(pendencias[0].evalIndex);
}

function showBadgesPanel() {
    showAllTrainees();
}

function showAddTraineePanel() {
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    content.innerHTML = `
        <h2 class="section-title">➕ Adicionar Novo Colaborador</h2>
        <div class="form-group"><label>Nome</label><input type="text" id="trainee-name" placeholder="Nome completo"></div>
        <div class="form-group"><label>Função</label><select id="trainee-function"><option value="B2B">B2B</option><option value="B2C">B2C</option><option value="Backoffice">Backoffice</option></select></div>
        <div class="form-group"><label>Marca</label><select id="trainee-brand"><option value="POLI">POLI</option><option value="ESALQ/PECEGE">ESALQ/PECEGE</option><option value="MACKENZIE">MACKENZIE</option><option value="ECA USP">ECA USP</option></select></div>
        <button class="btn-primary" onclick="addTrainee();backToDashboard();">➕ Adicionar</button>
        
        <h2 class="section-title" style="margin-top:30px;">📋 Colaboradores Cadastrados</h2>
        <div id="trainees-list-detail"></div>
        
        <button class="btn-secondary" style="margin-top:20px;" onclick="changePassword()">🔑 Alterar Senha Admin</button>
    `;
    
    renderTraineesList();
}

function renderTraineesList() {
    const c = document.getElementById('trainees-list-detail');
    if (!c) return;
    
    let h = '';
    trainees.forEach((t, i) => {
        h += `<div class="list-item">
            <div class="list-item-info">
                <div class="list-item-name">${t.name}</div>
                <div class="list-item-details">${t.function}${t.brand ? ' - ' + t.brand : ''} | Código: ${t.code}</div>
            </div>
            <button class="btn-delete" onclick="deleteTrainee(${i})">🗑️ Remover</button>
        </div>`;
    });
    
    c.innerHTML = h || '<p style="color:#666;">Nenhum colaborador cadastrado.</p>';
}

function showAllTrainees() {
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    let html = '<h2 class="section-title">👥 Todos os Colaboradores</h2>';
    html += '<div style="display:grid;gap:15px;">';
    
    trainees.forEach((t, idx) => {
        const initials = t.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        const isBlocked = t.blocked === true;
        const blockedBadge = isBlocked ? '<span style="background:#dc3545;color:white;padding:2px 8px;border-radius:12px;font-size:11px;margin-left:10px;">🚫 BLOQUEADO</span>' : '';
        const avatarBg = isBlocked ? 'background:linear-gradient(135deg, #dc3545, #c0392b);' : '';
        const itemBorder = isBlocked ? 'border-left:4px solid #dc3545;' : '';
        
        html += `
            <div class="list-item" style="cursor:pointer;${itemBorder}" onclick="showTraineeDetail(${idx})">
                <div style="display:flex;align-items:center;gap:15px;">
                    <div class="priority-avatar" style="${avatarBg}">${initials}</div>
                    <div class="list-item-info">
                        <div class="list-item-name">${t.name}${blockedBadge}</div>
                        <div class="list-item-details">${t.function}${t.brand ? ' - ' + t.brand : ''} | ${t.points} pts | Código: ${t.code}</div>
                    </div>
                </div>
                <span style="color:#667eea;">Ver detalhes →</span>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
}

function exportAllReports() {
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    content.innerHTML = `
        <h2 class="section-title">📊 Central de Relatórios</h2>
        <p style="color:#666;margin-bottom:25px;">Selecione o tipo de relatório que deseja gerar:</p>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;">
            
            <div class="report-card" onclick="generateReportNotas()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">📝</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Notas das Avaliações</h3>
                <p style="color:#666;font-size:14px;">Lista com todos os colaboradores e suas notas nas avaliações</p>
            </div>
            
            <div class="report-card" onclick="generateReportQuestoesErradas()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">❌</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Questões Mais Erradas</h3>
                <p style="color:#666;font-size:14px;">Identificar gaps de conhecimento e pontos de melhoria</p>
            </div>
            
            <div class="report-card" onclick="generateReportVisaoGeral()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">📊</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Visão Geral</h3>
                <p style="color:#666;font-size:14px;">Resumo executivo com KPIs principais do treinamento</p>
            </div>
            
            <div class="report-card" onclick="generateReportProgresso()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">⏱️</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Progresso Geral</h3>
                <p style="color:#666;font-size:14px;">Quem completou, em andamento ou não começou</p>
            </div>
            
            <div class="report-card" onclick="exportToExcel()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">📥</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Exportar para Excel</h3>
                <p style="color:#666;font-size:14px;">Dados brutos em CSV para análise própria</p>
            </div>
            
            <div class="report-card" onclick="exportToPDF()" style="background:white;border-radius:12px;padding:25px;cursor:pointer;border:2px solid #e0e0e0;transition:all 0.3s;">
                <div style="font-size:36px;margin-bottom:15px;">📄</div>
                <h3 style="color:#1e3c72;margin-bottom:8px;">Exportar para PDF</h3>
                <p style="color:#666;font-size:14px;">Relatório formatado para apresentação</p>
            </div>
            
        </div>
        
        <div id="report-output" style="margin-top:30px;"></div>
    `;
    
    // Adicionar hover effect
    setTimeout(() => {
        document.querySelectorAll('.report-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.borderColor = '#667eea';
                this.style.transform = 'translateY(-3px)';
                this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.1)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.borderColor = '#e0e0e0';
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            });
        });
    }, 100);
}

// ========== TREINAMENTOS PONTUAIS ==========
let punctualTrainings = [];

async function loadPunctualTrainings() {
    if (useFirebase && db) {
        try {
            const doc = await db.collection('settings').doc('punctualTrainings').get();
            if (doc.exists) {
                punctualTrainings = doc.data().items || [];
            }
        } catch (e) {
            console.log('Erro ao carregar treinamentos pontuais:', e);
        }
    } else {
        const saved = localStorage.getItem('punctualTrainings');
        if (saved) punctualTrainings = JSON.parse(saved);
    }
}

async function savePunctualTrainings() {
    if (useFirebase && db) {
        try {
            await db.collection('settings').doc('punctualTrainings').set({ items: punctualTrainings });
        } catch (e) {
            console.log('Erro ao salvar treinamentos pontuais:', e);
        }
    } else {
        localStorage.setItem('punctualTrainings', JSON.stringify(punctualTrainings));
    }
}

function showPunctualTrainingsPanel() {
    const panel = document.getElementById('detail-panel');
    const content = document.getElementById('detail-content');
    
    document.getElementById('admin-dashboard').classList.remove('active');
    panel.classList.add('active');
    
    loadPunctualTrainings().then(() => {
        let html = `
            <h2 class="section-title">🎯 Treinamentos Pontuais</h2>
            <p style="color:#666;margin-bottom:20px;">Crie treinamentos específicos para colaboradores selecionados.</p>
            
            <button class="btn-primary" style="margin-bottom:25px;" onclick="showCreateTrainingForm()">➕ Criar Novo Treinamento</button>
            
            <div id="create-training-form" style="display:none;"></div>
            
            <div id="punctual-trainings-list"></div>
        `;
        
        content.innerHTML = html;
        renderPunctualTrainingsList();
    });
}

function renderPunctualTrainingsList() {
    const list = document.getElementById('punctual-trainings-list');
    
    if (punctualTrainings.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:#999;padding:30px;">Nenhum treinamento pontual criado ainda.</p>';
        return;
    }
    
    let html = '<h3 style="color:#1e3c72;margin-bottom:15px;">📋 Treinamentos Criados</h3>';
    
    punctualTrainings.forEach((t, idx) => {
        const deadline = new Date(t.deadline);
        const hoje = new Date();
        const isExpired = deadline < hoje;
        const diasRestantes = Math.ceil((deadline - hoje) / (1000 * 60 * 60 * 24));
        
        // Contar conclusões
        const totalAssigned = t.assignedTo ? t.assignedTo.length : 0;
        const completions = t.completions || {};
        const totalCompleted = Object.keys(completions).length;
        
        const statusColor = isExpired ? '#dc3545' : (diasRestantes <= 3 ? '#fd7e14' : '#28a745');
        const statusText = isExpired ? 'Encerrado' : `${diasRestantes} dia(s) restante(s)`;
        
        html += `
            <div style="background:white;border-radius:12px;padding:20px;margin-bottom:15px;border-left:4px solid ${statusColor};">
                <div style="display:flex;justify-content:space-between;align-items:start;flex-wrap:wrap;gap:10px;">
                    <div style="flex:1;">
                        <h4 style="color:#1e3c72;margin:0 0 8px 0;">${t.title}</h4>
                        <p style="color:#666;font-size:14px;margin:0 0 10px 0;">${t.description || 'Sem descrição'}</p>
                        <div style="display:flex;gap:15px;flex-wrap:wrap;font-size:13px;">
                            <span style="color:${statusColor};">⏰ ${statusText}</span>
                            <span>📅 Prazo: ${deadline.toLocaleDateString('pt-BR')}</span>
                            <span>👥 ${totalCompleted}/${totalAssigned} concluídos</span>
                        </div>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="btn-primary" style="width:auto;padding:8px 16px;" onclick="viewTrainingDetails(${idx})">👁️ Ver</button>
                        <button class="btn-delete" onclick="deletePunctualTraining(${idx})">🗑️</button>
                    </div>
                </div>
                <div style="background:#e0e0e0;height:6px;border-radius:3px;margin-top:15px;">
                    <div style="background:${statusColor};height:100%;border-radius:3px;width:${totalAssigned > 0 ? (totalCompleted/totalAssigned)*100 : 0}%;"></div>
                </div>
            </div>
        `;
    });
    
    list.innerHTML = html;
}

function showCreateTrainingForm() {
    const form = document.getElementById('create-training-form');
    
    // Gerar lista de colaboradores
    let colaboradoresHtml = '';
    trainees.forEach((t, idx) => {
        colaboradoresHtml += `
            <label style="display:flex;align-items:center;gap:10px;padding:8px;background:#f8f9fa;border-radius:8px;margin-bottom:5px;cursor:pointer;">
                <input type="checkbox" name="training-colaborador" value="${idx}">
                <span>${t.name}</span>
                <span style="color:#666;font-size:12px;">(${t.function}${t.brand ? ' - ' + t.brand : ''})</span>
            </label>
        `;
    });
    
    form.innerHTML = `
        <div style="background:#f8f9fa;padding:25px;border-radius:12px;margin-bottom:25px;border:2px dashed #667eea;">
            <h3 style="color:#1e3c72;margin-bottom:20px;">➕ Novo Treinamento Pontual</h3>
            
            <div class="form-group">
                <label>Título do Treinamento *</label>
                <input type="text" id="training-title" placeholder="Ex: Reciclagem - Novo Sistema de Vendas">
            </div>
            
            <div class="form-group">
                <label>Descrição</label>
                <textarea id="training-description" style="width:100%;min-height:80px;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-family:inherit;" placeholder="Descreva o objetivo do treinamento..."></textarea>
            </div>
            
            <div class="form-group">
                <label>Link do Material (PDF/Vídeo) *</label>
                <input type="text" id="training-material" placeholder="https://drive.google.com/...">
            </div>
            
            <div class="form-group">
                <label>Prazo de Conclusão *</label>
                <input type="date" id="training-deadline" style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;">
            </div>
            
            <div class="form-group">
                <label>Selecionar Colaboradores *</label>
                <div style="display:flex;gap:10px;margin-bottom:10px;">
                    <button type="button" class="btn-secondary" style="width:auto;margin:0;padding:8px 16px;" onclick="selectAllColaboradores()">Selecionar Todos</button>
                    <button type="button" class="btn-secondary" style="width:auto;margin:0;padding:8px 16px;" onclick="deselectAllColaboradores()">Desmarcar Todos</button>
                </div>
                <div style="max-height:200px;overflow-y:auto;border:2px solid #e0e0e0;border-radius:8px;padding:10px;">
                    ${colaboradoresHtml}
                </div>
            </div>
            
            <h4 style="color:#1e3c72;margin:25px 0 15px 0;">📝 Questões da Avaliação</h4>
            <p style="color:#666;font-size:13px;margin-bottom:15px;">Adicione questões objetivas (múltipla escolha)</p>
            
            <div id="training-questions-container"></div>
            
            <button type="button" class="btn-secondary" style="margin-bottom:20px;" onclick="addTrainingQuestion()">➕ Adicionar Questão</button>
            
            <div style="display:flex;gap:10px;">
                <button class="btn-primary" onclick="saveNewTraining()">✅ Criar Treinamento</button>
                <button class="btn-secondary" onclick="hideCreateTrainingForm()">❌ Cancelar</button>
            </div>
        </div>
    `;
    
    form.style.display = 'block';
    
    // Definir data mínima como hoje
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('training-deadline').min = hoje;
    
    // Adicionar primeira questão
    addTrainingQuestion();
    
    form.scrollIntoView({ behavior: 'smooth' });
}

function hideCreateTrainingForm() {
    document.getElementById('create-training-form').style.display = 'none';
}

let questionCount = 0;

function addTrainingQuestion() {
    questionCount++;
    const container = document.getElementById('training-questions-container');
    
    const questionHtml = `
        <div id="question-${questionCount}" style="background:white;padding:20px;border-radius:8px;margin-bottom:15px;border:1px solid #e0e0e0;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                <strong style="color:#667eea;">Questão ${questionCount}</strong>
                <button type="button" onclick="removeTrainingQuestion(${questionCount})" style="background:#dc3545;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;">🗑️</button>
            </div>
            <div class="form-group">
                <label>Pergunta</label>
                <input type="text" id="q${questionCount}-text" placeholder="Digite a pergunta...">
            </div>
            <div class="form-group">
                <label>Alternativas (marque a correta)</label>
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                    <input type="radio" name="q${questionCount}-correct" value="0" checked>
                    <input type="text" id="q${questionCount}-opt0" placeholder="Alternativa A" style="flex:1;">
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                    <input type="radio" name="q${questionCount}-correct" value="1">
                    <input type="text" id="q${questionCount}-opt1" placeholder="Alternativa B" style="flex:1;">
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                    <input type="radio" name="q${questionCount}-correct" value="2">
                    <input type="text" id="q${questionCount}-opt2" placeholder="Alternativa C" style="flex:1;">
                </div>
                <div style="display:flex;align-items:center;gap:10px;">
                    <input type="radio" name="q${questionCount}-correct" value="3">
                    <input type="text" id="q${questionCount}-opt3" placeholder="Alternativa D" style="flex:1;">
                </div>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', questionHtml);
}

function removeTrainingQuestion(num) {
    const el = document.getElementById('question-' + num);
    if (el) el.remove();
}

function selectAllColaboradores() {
    document.querySelectorAll('input[name="training-colaborador"]').forEach(cb => cb.checked = true);
}

function deselectAllColaboradores() {
    document.querySelectorAll('input[name="training-colaborador"]').forEach(cb => cb.checked = false);
}

async function saveNewTraining() {
    const title = document.getElementById('training-title').value.trim();
    const description = document.getElementById('training-description').value.trim();
    const material = document.getElementById('training-material').value.trim();
    const deadline = document.getElementById('training-deadline').value;
    
    if (!title) { alert('⚠️ Digite o título do treinamento!'); return; }
    if (!material) { alert('⚠️ Digite o link do material!'); return; }
    if (!deadline) { alert('⚠️ Selecione o prazo de conclusão!'); return; }
    
    // Pegar colaboradores selecionados
    const selectedColabs = [];
    document.querySelectorAll('input[name="training-colaborador"]:checked').forEach(cb => {
        selectedColabs.push(parseInt(cb.value));
    });
    
    if (selectedColabs.length === 0) { alert('⚠️ Selecione pelo menos um colaborador!'); return; }
    
    // Pegar questões
    const questions = [];
    document.querySelectorAll('[id^="question-"]').forEach(qEl => {
        const num = qEl.id.replace('question-', '');
        const text = document.getElementById('q' + num + '-text')?.value?.trim();
        if (!text) return;
        
        const opts = [];
        for (let i = 0; i < 4; i++) {
            const opt = document.getElementById('q' + num + '-opt' + i)?.value?.trim();
            if (opt) opts.push(opt);
        }
        
        const correctRadio = document.querySelector('input[name="q' + num + '-correct"]:checked');
        const correct = correctRadio ? parseInt(correctRadio.value) : 0;
        
        if (opts.length >= 2) {
            questions.push({ text, opts, correct });
        }
    });
    
    if (questions.length === 0) { alert('⚠️ Adicione pelo menos uma questão com 2 alternativas!'); return; }
    
    const newTraining = {
        id: Date.now(),
        title,
        description,
        material,
        deadline,
        assignedTo: selectedColabs,
        questions,
        completions: {},
        createdAt: new Date().toISOString()
    };
    
    punctualTrainings.push(newTraining);
    await savePunctualTrainings();
    
    hideCreateTrainingForm();
    renderPunctualTrainingsList();
    questionCount = 0;
    
    alert('✅ Treinamento criado com sucesso!\n\nOs colaboradores selecionados verão o treinamento em destaque.');
}

async function deletePunctualTraining(idx) {
    if (!confirm('Tem certeza que deseja excluir este treinamento?')) return;
    punctualTrainings.splice(idx, 1);
    await savePunctualTrainings();
    renderPunctualTrainingsList();
}

function viewTrainingDetails(idx) {
    const t = punctualTrainings[idx];
    if (!t) return;
    
    const content = document.getElementById('detail-content');
    
    const deadline = new Date(t.deadline);
    const totalAssigned = t.assignedTo ? t.assignedTo.length : 0;
    const completions = t.completions || {};
    
    let colaboradoresHtml = '';
    t.assignedTo.forEach(colabIdx => {
        const colab = trainees[colabIdx];
        if (!colab) return;
        
        const completed = completions[colabIdx];
        const status = completed ? '✅ Concluído' : '⏳ Pendente';
        const statusColor = completed ? '#28a745' : '#fd7e14';
        const completedDate = completed ? ` em ${new Date(completed.date).toLocaleDateString('pt-BR')}` : '';
        
        colaboradoresHtml += `
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;">
                <div>
                    <strong>${colab.name}</strong>
                    <span style="color:#666;font-size:12px;margin-left:10px;">${colab.function}${colab.brand ? ' - ' + colab.brand : ''}</span>
                </div>
                <span style="color:${statusColor};font-weight:bold;">${status}${completedDate}</span>
            </div>
        `;
    });
    
    content.innerHTML = `
        <h2 class="section-title">🎯 ${t.title}</h2>
        <p style="color:#666;margin-bottom:20px;">${t.description || 'Sem descrição'}</p>
        
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px;">
            <div style="background:#e3f2fd;padding:20px;border-radius:12px;text-align:center;">
                <div style="font-size:28px;font-weight:bold;color:#1565c0;">${Object.keys(completions).length}/${totalAssigned}</div>
                <div style="font-size:13px;color:#666;">Concluídos</div>
            </div>
            <div style="background:#fff3e0;padding:20px;border-radius:12px;text-align:center;">
                <div style="font-size:28px;font-weight:bold;color:#ef6c00;">${deadline.toLocaleDateString('pt-BR')}</div>
                <div style="font-size:13px;color:#666;">Prazo</div>
            </div>
            <div style="background:#e8f5e9;padding:20px;border-radius:12px;text-align:center;">
                <div style="font-size:28px;font-weight:bold;color:#2e7d32;">${t.questions.length}</div>
                <div style="font-size:13px;color:#666;">Questões</div>
            </div>
        </div>
        
        <h3 style="color:#1e3c72;margin-bottom:15px;">👥 Status dos Colaboradores</h3>
        ${colaboradoresHtml}
        
        <button class="btn-secondary" style="margin-top:20px;" onclick="showPunctualTrainingsPanel()">← Voltar</button>
    `;
}

// Renderizar treinamentos pendentes para o colaborador
function renderPendingTrainings() {
    if (isAdmin || !currentUser || currentTrainee < 0) return;
    
    const container = document.getElementById('pending-trainings-container');
    if (!container) return;
    
    loadPunctualTrainings().then(() => {
        const hoje = new Date();
        const meusTrainings = punctualTrainings.filter(t => {
            if (!t.assignedTo || !t.assignedTo.includes(currentTrainee)) return false;
            const deadline = new Date(t.deadline);
            // Mostrar apenas não concluídos e não expirados
            const completions = t.completions || {};
            if (completions[currentTrainee]) return false;
            return deadline >= hoje;
        });
        
        if (meusTrainings.length === 0) {
            container.style.display = 'none';
            return;
        }
        
        container.style.display = 'block';
        
        let html = '';
        meusTrainings.forEach((t, idx) => {
            const realIdx = punctualTrainings.indexOf(t);
            const deadline = new Date(t.deadline);
            const diasRestantes = Math.ceil((deadline - hoje) / (1000 * 60 * 60 * 24));
            const isUrgent = diasRestantes <= 3;
            
            html += `
                <div class="pending-training-card ${isUrgent ? 'urgent' : ''}">
                    <div class="training-header">
                        <div class="training-badge">🎯 Treinamento Pontual</div>
                        ${isUrgent ? '<div class="training-badge" style="background:rgba(255,255,255,0.3);">⚠️ URGENTE</div>' : ''}
                    </div>
                    <div class="training-title">${t.title}</div>
                    ${t.description ? `<div class="training-desc">${t.description}</div>` : ''}
                    <div class="training-deadline">
                        <span>⏰</span>
                        <span class="training-deadline-urgent">Prazo: ${deadline.toLocaleDateString('pt-BR')} (${diasRestantes} dia${diasRestantes !== 1 ? 's' : ''})</span>
                    </div>
                    <div class="training-actions">
                        <button class="training-btn material" onclick="window.open('${t.material}', '_blank')">📚 Ver Material</button>
                        <button class="training-btn avaliar" onclick="startPunctualTrainingEval(${realIdx})">📝 Fazer Avaliação</button>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    });
}

function startPunctualTrainingEval(trainingIdx) {
    const t = punctualTrainings[trainingIdx];
    if (!t) return;
    
    // Criar modal de avaliação
    const overlay = document.getElementById('quiz-overlay');
    const content = document.getElementById('quiz-content');
    
    let questionsHtml = '';
    t.questions.forEach((q, qIdx) => {
        questionsHtml += `
            <div class="question" style="margin-bottom:20px;">
                <div class="question-header">
                    <span class="question-number">Questão ${qIdx + 1}</span>
                </div>
                <div class="question-text">${q.text}</div>
                <div class="options">
                    ${q.opts.map((opt, optIdx) => `
                        <div class="option">
                            <input type="radio" name="pt-q${qIdx}" value="${optIdx}" id="pt-q${qIdx}-${optIdx}">
                            <label for="pt-q${qIdx}-${optIdx}">${opt}</label>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    });
    
    content.innerHTML = `
        <div class="quiz-header">
            <h2>📝 Avaliação: ${t.title}</h2>
            <p>Responda todas as questões para concluir o treinamento</p>
        </div>
        
        <div id="punctual-eval-questions">
            ${questionsHtml}
        </div>
        
        <div style="display:flex;gap:10px;margin-top:20px;">
            <button class="btn-primary" onclick="submitPunctualTrainingEval(${trainingIdx})">✅ Enviar Avaliação</button>
            <button class="btn-secondary" onclick="closePunctualTrainingEval()">❌ Cancelar</button>
        </div>
    `;
    
    overlay.style.display = 'flex';
}

function closePunctualTrainingEval() {
    document.getElementById('quiz-overlay').style.display = 'none';
}

async function submitPunctualTrainingEval(trainingIdx) {
    const t = punctualTrainings[trainingIdx];
    if (!t) return;
    
    // Verificar se todas as questões foram respondidas
    let allAnswered = true;
    const answers = [];
    
    t.questions.forEach((q, qIdx) => {
        const selected = document.querySelector(`input[name="pt-q${qIdx}"]:checked`);
        if (!selected) {
            allAnswered = false;
        } else {
            answers.push({
                questionIdx: qIdx,
                selected: parseInt(selected.value),
                correct: q.correct,
                isCorrect: parseInt(selected.value) === q.correct
            });
        }
    });
    
    if (!allAnswered) {
        alert('⚠️ Por favor, responda todas as questões!');
        return;
    }
    
    // Calcular resultado
    const correctCount = answers.filter(a => a.isCorrect).length;
    const totalQuestions = t.questions.length;
    const score = Math.round((correctCount / totalQuestions) * 100);
    
    // Registrar conclusão
    if (!t.completions) t.completions = {};
    t.completions[currentTrainee] = {
        date: new Date().toISOString(),
        score,
        correctCount,
        totalQuestions,
        answers
    };
    
    await savePunctualTrainings();
    
    // Mostrar resultado
    const content = document.getElementById('quiz-content');
    content.innerHTML = `
        <div style="text-align:center;padding:40px;">
            <div style="font-size:72px;margin-bottom:20px;">🎉</div>
            <h2 style="color:#28a745;margin-bottom:15px;">Treinamento Concluído!</h2>
            <p style="font-size:18px;margin-bottom:10px;">Você acertou <strong>${correctCount}</strong> de <strong>${totalQuestions}</strong> questões</p>
            <p style="font-size:32px;font-weight:bold;color:#1e3c72;margin:20px 0;">${score}%</p>
            <button class="btn-primary" onclick="closePunctualTrainingEval();renderPendingTrainings();">✅ Fechar</button>
        </div>
    `;
}

// ========== CONTEÚDOS DO TREINAMENTO ==========
let trainingContents = [];

async function loadContents() {
    if (useFirebase && db) {
        try {
            const doc = await db.collection('settings').doc('contents').get();
            if (doc.exists) {
                trainingContents = doc.data().items || [];
            }
        } catch (e) {
            console.log('Erro ao carregar conteúdos:', e);
        }
    } else {
        const saved = localStorage.getItem('trainingContents');
        if (saved) trainingContents = JSON.parse(saved);
    }
}

async function saveContents() {
    if (useFirebase && db) {
        try {
            await db.collection('settings').doc('contents').set({ items: trainingContents });
        } catch (e) {
            console.log('Erro ao salvar conteúdos:', e);
        }
    } else {
        localStorage.setItem('trainingContents', JSON.stringify(trainingContents));
    }
}

function renderContents() {
    const list = document.getElementById('content-list');
    const addBtn = document.getElementById('add-content-btn');
    
    // Mostrar botão de adicionar só para admin
    if (addBtn) {
        addBtn.style.display = isAdmin ? 'block' : 'none';
    }
    
    // Filtrar conteúdos para o colaborador (admin vê todos)
    let contentsFiltrados = trainingContents;
    if (!isAdmin && currentUser && trainees[currentTrainee]) {
        const userFunc = trainees[currentTrainee].function;
        const userBrand = trainees[currentTrainee].brand;
        
        contentsFiltrados = trainingContents.filter(c => {
            const funcMatch = !c.function || c.function === 'Todos' || c.function === userFunc;
            const brandMatch = !c.brand || c.brand === 'Todas' || c.brand === userBrand;
            return funcMatch && brandMatch;
        });
    }
    
    if (contentsFiltrados.length === 0) {
        list.innerHTML = `
            <div class="no-content">
                <div class="no-content-icon">📚</div>
                <p>Nenhum conteúdo disponível ${isAdmin ? 'ainda' : 'para seu perfil'}.</p>
                ${isAdmin ? '<p style="font-size:13px;margin-top:10px;">Clique em "Adicionar Conteúdo" para começar.</p>' : ''}
            </div>
        `;
        return;
    }
    
    let html = '';
    contentsFiltrados.forEach((c) => {
        const idx = trainingContents.indexOf(c);
        const tags = [];
        if (c.function && c.function !== 'Todos') tags.push(c.function);
        if (c.brand && c.brand !== 'Todas') tags.push(c.brand);
        const tagsHtml = tags.length > 0 ? `<div style="margin-top:8px;">${tags.map(t => `<span style="background:#e3f2fd;color:#1565c0;padding:3px 10px;border-radius:12px;font-size:11px;margin-right:5px;">${t}</span>`).join('')}</div>` : '';
        
        html += `
            <div class="content-card" onclick="openContent('${c.url}')">
                <div class="content-icon">${c.icon || '📄'}</div>
                <div class="content-info">
                    <div class="content-title">${c.title}</div>
                    ${c.desc ? `<div class="content-desc">${c.desc}</div>` : ''}
                    ${isAdmin ? tagsHtml : ''}
                </div>
                <div class="content-actions" onclick="event.stopPropagation();">
                    <button class="content-btn open" onclick="openContent('${c.url}')">📖 Abrir</button>
                    ${isAdmin === true ? `
                        <button class="content-btn edit" onclick="editContent(${idx})">✏️</button>
                        <button class="content-btn delete" onclick="deleteContent(${idx})">🗑️</button>
                    ` : ''}
                </div>
            </div>
        `;
    });
    
    list.innerHTML = html;
}

function showAddContentForm() {
    if (!isAdmin) return;
    document.getElementById('add-content-form').style.display = 'block';
    document.getElementById('content-title').value = '';
    document.getElementById('content-desc').value = '';
    document.getElementById('content-url').value = '';
    document.getElementById('content-function').value = 'Todos';
    document.getElementById('content-brand').value = 'Todas';
    document.getElementById('content-icon').value = '📄';
    document.getElementById('content-title').focus();
}

function hideAddContentForm() {
    document.getElementById('add-content-form').style.display = 'none';
}

async function addContent() {
    const title = document.getElementById('content-title').value.trim();
    const desc = document.getElementById('content-desc').value.trim();
    const url = document.getElementById('content-url').value.trim();
    const func = document.getElementById('content-function').value;
    const brand = document.getElementById('content-brand').value;
    const icon = document.getElementById('content-icon').value;
    
    if (!title) {
        alert('⚠️ Digite o título do conteúdo!');
        return;
    }
    if (!url) {
        alert('⚠️ Digite o link do documento!');
        return;
    }
    
    trainingContents.push({
        id: Date.now(),
        title,
        desc,
        url,
        function: func,
        brand: brand,
        icon,
        createdAt: new Date().toISOString()
    });
    
    await saveContents();
    hideAddContentForm();
    renderContents();
    alert('✅ Conteúdo adicionado com sucesso!');
}

function editContent(idx) {
    if (!isAdmin) return;
    const c = trainingContents[idx];
    if (!c) return;
    
    // Esconder formulário de adicionar se estiver aberto
    hideAddContentForm();
    
    // Preencher formulário de edição
    document.getElementById('edit-content-idx').value = idx;
    document.getElementById('edit-content-title').value = c.title || '';
    document.getElementById('edit-content-desc').value = c.desc || '';
    document.getElementById('edit-content-url').value = c.url || '';
    document.getElementById('edit-content-function').value = c.function || 'Todos';
    document.getElementById('edit-content-brand').value = c.brand || 'Todas';
    document.getElementById('edit-content-icon').value = c.icon || '📄';
    
    // Mostrar formulário
    document.getElementById('edit-content-form').style.display = 'block';
    document.getElementById('edit-content-title').focus();
    
    // Scroll para o formulário
    document.getElementById('edit-content-form').scrollIntoView({ behavior: 'smooth' });
}

function hideEditContentForm() {
    document.getElementById('edit-content-form').style.display = 'none';
}

async function saveEditContent() {
    const idx = parseInt(document.getElementById('edit-content-idx').value);
    const c = trainingContents[idx];
    if (!c) return;
    
    const title = document.getElementById('edit-content-title').value.trim();
    const desc = document.getElementById('edit-content-desc').value.trim();
    const url = document.getElementById('edit-content-url').value.trim();
    const func = document.getElementById('edit-content-function').value;
    const brand = document.getElementById('edit-content-brand').value;
    const icon = document.getElementById('edit-content-icon').value;
    
    if (!title) {
        alert('⚠️ Digite o título do conteúdo!');
        return;
    }
    if (!url) {
        alert('⚠️ Digite o link do documento!');
        return;
    }
    
    c.title = title;
    c.desc = desc;
    c.url = url;
    c.function = func;
    c.brand = brand;
    c.icon = icon;
    
    await saveContents();
    hideEditContentForm();
    renderContents();
    alert('✅ Conteúdo atualizado com sucesso!');
}

async function deleteContent(idx) {
    if (!isAdmin) return;
    if (!confirm('Tem certeza que deseja excluir este conteúdo?')) return;
    
    trainingContents.splice(idx, 1);
    await saveContents();
    renderContents();
    alert('✅ Conteúdo removido!');
}

function openContent(url) {
    window.open(url, '_blank');
}

// ========== RELATÓRIO: NOTAS DAS AVALIAÇÕES ==========
function generateReportNotas() {
    const output = document.getElementById('report-output');
    
    let html = `
        <div style="background:white;border-radius:12px;padding:25px;margin-top:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:#1e3c72;margin:0;">📝 Relatório de Notas das Avaliações</h3>
                <button onclick="printReport()" class="btn-primary" style="width:auto;padding:10px 20px;">🖨️ Imprimir</button>
            </div>
            <p style="color:#666;margin-bottom:20px;">Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
    `;
    
    if (evalHistory.length === 0) {
        html += '<p style="text-align:center;color:#999;padding:30px;">Nenhuma avaliação realizada ainda.</p>';
    } else {
        html += `
            <table style="width:100%;border-collapse:collapse;font-size:14px;">
                <thead>
                    <tr style="background:linear-gradient(135deg,#1e3c72,#2a5298);color:white;">
                        <th style="padding:12px;text-align:left;border-radius:8px 0 0 0;">Colaborador</th>
                        <th style="padding:12px;text-align:left;">Função</th>
                        <th style="padding:12px;text-align:left;">Avaliação</th>
                        <th style="padding:12px;text-align:center;">Nota</th>
                        <th style="padding:12px;text-align:center;">Status</th>
                        <th style="padding:12px;text-align:left;border-radius:0 8px 0 0;">Data</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        evalHistory.forEach((e, i) => {
            const bg = i % 2 === 0 ? '#f8f9fa' : '#fff';
            const statusColor = e.passed ? '#28a745' : '#dc3545';
            const statusText = e.passed ? '✅ Aprovado' : '❌ Reprovado';
            const trainee = trainees[e.traineeIndex];
            const funcao = trainee ? trainee.function + (trainee.brand ? ' - ' + trainee.brand : '') : '-';
            
            html += `
                <tr style="background:${bg};">
                    <td style="padding:12px;border-bottom:1px solid #eee;">${e.traineeName}</td>
                    <td style="padding:12px;border-bottom:1px solid #eee;">${funcao}</td>
                    <td style="padding:12px;border-bottom:1px solid #eee;">${e.type.toUpperCase()}${e.brand ? ' - ' + e.brand : ''}</td>
                    <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;font-weight:bold;font-size:16px;">${e.score}%</td>
                    <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;color:${statusColor};font-weight:bold;">${statusText}</td>
                    <td style="padding:12px;border-bottom:1px solid #eee;">${e.date}</td>
                </tr>
            `;
        });
        
        html += '</tbody></table>';
        
        // Resumo
        const aprovados = evalHistory.filter(e => e.passed).length;
        const reprovados = evalHistory.length - aprovados;
        const mediaGeral = evalHistory.length > 0 ? Math.round(evalHistory.reduce((s, e) => s + e.score, 0) / evalHistory.length) : 0;
        
        html += `
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-top:25px;padding-top:20px;border-top:2px solid #eee;">
                <div style="text-align:center;padding:15px;background:#e3f2fd;border-radius:8px;">
                    <div style="font-size:28px;font-weight:bold;color:#1e3c72;">${evalHistory.length}</div>
                    <div style="font-size:12px;color:#666;">Total Avaliações</div>
                </div>
                <div style="text-align:center;padding:15px;background:#e8f5e9;border-radius:8px;">
                    <div style="font-size:28px;font-weight:bold;color:#28a745;">${aprovados}</div>
                    <div style="font-size:12px;color:#666;">Aprovados</div>
                </div>
                <div style="text-align:center;padding:15px;background:#ffebee;border-radius:8px;">
                    <div style="font-size:28px;font-weight:bold;color:#dc3545;">${reprovados}</div>
                    <div style="font-size:12px;color:#666;">Reprovados</div>
                </div>
                <div style="text-align:center;padding:15px;background:#fff3e0;border-radius:8px;">
                    <div style="font-size:28px;font-weight:bold;color:#fd7e14;">${mediaGeral}%</div>
                    <div style="font-size:12px;color:#666;">Média Geral</div>
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    output.innerHTML = html;
    output.scrollIntoView({ behavior: 'smooth' });
}

// ========== RELATÓRIO: QUESTÕES MAIS ERRADAS ==========
function generateReportQuestoesErradas() {
    const output = document.getElementById('report-output');
    
    // Analisar erros por questão
    const errosPorQuestao = {};
    
    evalHistory.forEach(e => {
        if (!e.answers) return;
        for (const [key, ans] of Object.entries(e.answers)) {
            if (ans.tipo === 'text') continue; // Ignorar dissertativas
            
            const qKey = e.type + '_' + (e.brand || '') + '_' + key;
            if (!errosPorQuestao[qKey]) {
                errosPorQuestao[qKey] = {
                    pergunta: ans.pergunta,
                    tema: ans.tema,
                    tipo: e.type.toUpperCase() + (e.brand ? ' - ' + e.brand : ''),
                    total: 0,
                    erros: 0
                };
            }
            errosPorQuestao[qKey].total++;
            if (!ans.acertou) errosPorQuestao[qKey].erros++;
        }
    });
    
    // Ordenar por taxa de erro
    const questoesOrdenadas = Object.values(errosPorQuestao)
        .map(q => ({ ...q, taxaErro: q.total > 0 ? Math.round((q.erros / q.total) * 100) : 0 }))
        .sort((a, b) => b.taxaErro - a.taxaErro);
    
    let html = `
        <div style="background:white;border-radius:12px;padding:25px;margin-top:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:#1e3c72;margin:0;">❌ Questões Mais Erradas - Gaps de Conhecimento</h3>
                <button onclick="printReport()" class="btn-primary" style="width:auto;padding:10px 20px;">🖨️ Imprimir</button>
            </div>
            <p style="color:#666;margin-bottom:20px;">Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
    `;
    
    if (questoesOrdenadas.length === 0) {
        html += '<p style="text-align:center;color:#999;padding:30px;">Nenhuma avaliação realizada ainda.</p>';
    } else {
        // Top 10 mais erradas
        html += '<h4 style="color:#dc3545;margin-bottom:15px;">🔴 Top 10 Questões com Maior Taxa de Erro</h4>';
        
        questoesOrdenadas.slice(0, 10).forEach((q, i) => {
            const barColor = q.taxaErro >= 70 ? '#dc3545' : q.taxaErro >= 50 ? '#fd7e14' : '#ffc107';
            html += `
                <div style="background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:10px;border-left:4px solid ${barColor};">
                    <div style="display:flex;justify-content:space-between;align-items:start;gap:15px;">
                        <div style="flex:1;">
                            <div style="font-size:12px;color:#666;margin-bottom:5px;">${q.tipo} | ${q.tema}</div>
                            <div style="font-weight:500;color:#333;">${q.pergunta}</div>
                        </div>
                        <div style="text-align:right;min-width:100px;">
                            <div style="font-size:24px;font-weight:bold;color:${barColor};">${q.taxaErro}%</div>
                            <div style="font-size:11px;color:#666;">${q.erros} erros de ${q.total}</div>
                        </div>
                    </div>
                    <div style="background:#e0e0e0;height:8px;border-radius:4px;margin-top:10px;overflow:hidden;">
                        <div style="background:${barColor};height:100%;width:${q.taxaErro}%;border-radius:4px;"></div>
                    </div>
                </div>
            `;
        });
        
        // Insights
        const altasTaxas = questoesOrdenadas.filter(q => q.taxaErro >= 50);
        html += `
            <div style="background:#fff3cd;padding:20px;border-radius:8px;margin-top:25px;border-left:4px solid #ffc107;">
                <h4 style="color:#856404;margin-bottom:10px;">💡 Insights</h4>
                <ul style="color:#856404;margin:0;padding-left:20px;">
                    <li><strong>${altasTaxas.length}</strong> questões têm taxa de erro acima de 50%</li>
                    <li>Considere reforçar o treinamento nos temas com maior dificuldade</li>
                    <li>Revise o material didático das questões mais erradas</li>
                </ul>
            </div>
        `;
    }
    
    html += '</div>';
    output.innerHTML = html;
    output.scrollIntoView({ behavior: 'smooth' });
}

// ========== RELATÓRIO: VISÃO GERAL ==========
function generateReportVisaoGeral() {
    const output = document.getElementById('report-output');
    
    // Calcular KPIs
    const totalColaboradores = trainees.length;
    const totalAvaliacoes = evalHistory.length;
    const aprovados = evalHistory.filter(e => e.passed).length;
    const taxaAprovacao = totalAvaliacoes > 0 ? Math.round((aprovados / totalAvaliacoes) * 100) : 0;
    const mediaGeral = totalAvaliacoes > 0 ? Math.round(evalHistory.reduce((s, e) => s + e.score, 0) / totalAvaliacoes) : 0;
    const totalBadges = trainees.reduce((s, t) => s + (t.badges ? t.badges.length : 0), 0);
    const totalPontos = trainees.reduce((s, t) => s + (t.points || 0), 0);
    
    // Quiz stats
    let quizCompletos = 0;
    trainees.forEach(t => {
        if (t.quizProgress) {
            quizCompletos += Object.keys(t.quizProgress).length;
        }
    });
    
    // Por função
    const porFuncao = {
        'B2B': trainees.filter(t => t.function === 'B2B'),
        'B2C': trainees.filter(t => t.function === 'B2C'),
        'Backoffice': trainees.filter(t => t.function === 'Backoffice')
    };
    
    let html = `
        <div style="background:white;border-radius:12px;padding:25px;margin-top:20px;" id="report-content">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:#1e3c72;margin:0;">📊 Visão Geral - Resumo Executivo</h3>
                <button onclick="printReport()" class="btn-primary" style="width:auto;padding:10px 20px;">🖨️ Imprimir</button>
            </div>
            <p style="color:#666;margin-bottom:25px;">Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
            
            <!-- KPIs Principais -->
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:30px;">
                <div style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:25px;border-radius:12px;text-align:center;">
                    <div style="font-size:36px;font-weight:bold;">${totalColaboradores}</div>
                    <div style="font-size:13px;opacity:0.9;">Colaboradores</div>
                </div>
                <div style="background:linear-gradient(135deg,#11998e,#38ef7d);color:white;padding:25px;border-radius:12px;text-align:center;">
                    <div style="font-size:36px;font-weight:bold;">${taxaAprovacao}%</div>
                    <div style="font-size:13px;opacity:0.9;">Taxa de Aprovação</div>
                </div>
                <div style="background:linear-gradient(135deg,#f093fb,#f5576c);color:white;padding:25px;border-radius:12px;text-align:center;">
                    <div style="font-size:36px;font-weight:bold;">${mediaGeral}%</div>
                    <div style="font-size:13px;opacity:0.9;">Média Geral</div>
                </div>
                <div style="background:linear-gradient(135deg,#4facfe,#00f2fe);color:white;padding:25px;border-radius:12px;text-align:center;">
                    <div style="font-size:36px;font-weight:bold;">${totalBadges}</div>
                    <div style="font-size:13px;opacity:0.9;">Badges Atribuídos</div>
                </div>
            </div>
            
            <!-- Detalhes -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:25px;">
                
                <!-- Avaliações -->
                <div style="background:#f8f9fa;padding:20px;border-radius:12px;">
                    <h4 style="color:#1e3c72;margin-bottom:15px;">📝 Avaliações</h4>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>Total de Avaliações</span>
                        <strong>${totalAvaliacoes}</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span style="color:#28a745;">Aprovados</span>
                        <strong style="color:#28a745;">${aprovados}</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;">
                        <span style="color:#dc3545;">Reprovados</span>
                        <strong style="color:#dc3545;">${totalAvaliacoes - aprovados}</strong>
                    </div>
                </div>
                
                <!-- Por Função -->
                <div style="background:#f8f9fa;padding:20px;border-radius:12px;">
                    <h4 style="color:#1e3c72;margin-bottom:15px;">👥 Por Função</h4>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>B2B</span>
                        <strong>${porFuncao['B2B'].length} colaboradores</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>B2C</span>
                        <strong>${porFuncao['B2C'].length} colaboradores</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;">
                        <span>Backoffice</span>
                        <strong>${porFuncao['Backoffice'].length} colaboradores</strong>
                    </div>
                </div>
                
                <!-- Gamificação -->
                <div style="background:#f8f9fa;padding:20px;border-radius:12px;">
                    <h4 style="color:#1e3c72;margin-bottom:15px;">🏆 Gamificação</h4>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>Badges Atribuídos</span>
                        <strong>${totalBadges}</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>Pontos Distribuídos</span>
                        <strong>${totalPontos}</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;">
                        <span>Média por Colaborador</span>
                        <strong>${totalColaboradores > 0 ? Math.round(totalPontos / totalColaboradores) : 0} pts</strong>
                    </div>
                </div>
                
                <!-- Quiz -->
                <div style="background:#f8f9fa;padding:20px;border-radius:12px;">
                    <h4 style="color:#1e3c72;margin-bottom:15px;">🎯 Quiz Diário</h4>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e0e0e0;">
                        <span>Dias de Quiz Completados</span>
                        <strong>${quizCompletos}</strong>
                    </div>
                    <div style="display:flex;justify-content:space-between;padding:10px 0;">
                        <span>Máximo Possível</span>
                        <strong>${totalColaboradores * 5} dias</strong>
                    </div>
                </div>
                
            </div>
        </div>
    `;
    
    output.innerHTML = html;
    output.scrollIntoView({ behavior: 'smooth' });
}

// ========== RELATÓRIO: PROGRESSO GERAL ==========
function generateReportProgresso() {
    const output = document.getElementById('report-output');
    
    // Classificar colaboradores
    const colaboradores = trainees.map((t, idx) => {
        const avaliacoes = evalHistory.filter(e => e.traineeIndex === idx);
        const quizDias = t.quizProgress ? Object.keys(t.quizProgress).length : 0;
        const badges = t.badges ? t.badges.length : 0;
        
        let status = 'nao_comecou';
        let statusText = '⚪ Não começou';
        let statusColor = '#6c757d';
        
        if (avaliacoes.length > 0 || quizDias > 0 || badges > 0) {
            status = 'em_andamento';
            statusText = '🟡 Em andamento';
            statusColor = '#ffc107';
        }
        
        // Verificar se completou (tem avaliação aprovada e quiz completo)
        const temAvaliacaoAprovada = avaliacoes.some(e => e.passed);
        const quizCompleto = quizDias >= 5;
        
        if (temAvaliacaoAprovada && quizCompleto) {
            status = 'completou';
            statusText = '🟢 Completou';
            statusColor = '#28a745';
        }
        
        return {
            ...t,
            index: idx,
            avaliacoes,
            quizDias,
            badges,
            status,
            statusText,
            statusColor
        };
    });
    
    const completou = colaboradores.filter(c => c.status === 'completou');
    const emAndamento = colaboradores.filter(c => c.status === 'em_andamento');
    const naoComecou = colaboradores.filter(c => c.status === 'nao_comecou');
    
    let html = `
        <div style="background:white;border-radius:12px;padding:25px;margin-top:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:#1e3c72;margin:0;">⏱️ Progresso Geral dos Colaboradores</h3>
                <button onclick="printReport()" class="btn-primary" style="width:auto;padding:10px 20px;">🖨️ Imprimir</button>
            </div>
            <p style="color:#666;margin-bottom:25px;">Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
            
            <!-- Resumo Visual -->
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px;">
                <div style="background:#e8f5e9;padding:25px;border-radius:12px;text-align:center;border:2px solid #28a745;">
                    <div style="font-size:42px;font-weight:bold;color:#28a745;">${completou.length}</div>
                    <div style="color:#28a745;font-weight:bold;">🟢 Completaram</div>
                </div>
                <div style="background:#fff8e1;padding:25px;border-radius:12px;text-align:center;border:2px solid #ffc107;">
                    <div style="font-size:42px;font-weight:bold;color:#f57c00;">${emAndamento.length}</div>
                    <div style="color:#f57c00;font-weight:bold;">🟡 Em Andamento</div>
                </div>
                <div style="background:#f5f5f5;padding:25px;border-radius:12px;text-align:center;border:2px solid #6c757d;">
                    <div style="font-size:42px;font-weight:bold;color:#6c757d;">${naoComecou.length}</div>
                    <div style="color:#6c757d;font-weight:bold;">⚪ Não Começaram</div>
                </div>
            </div>
            
            <!-- Lista Detalhada -->
            <table style="width:100%;border-collapse:collapse;font-size:14px;">
                <thead>
                    <tr style="background:linear-gradient(135deg,#1e3c72,#2a5298);color:white;">
                        <th style="padding:12px;text-align:left;border-radius:8px 0 0 0;">Colaborador</th>
                        <th style="padding:12px;text-align:left;">Função</th>
                        <th style="padding:12px;text-align:center;">Avaliações</th>
                        <th style="padding:12px;text-align:center;">Quiz</th>
                        <th style="padding:12px;text-align:center;">Badges</th>
                        <th style="padding:12px;text-align:center;border-radius:0 8px 0 0;">Status</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    // Ordenar: completou > em andamento > não começou
    const ordenados = [...completou, ...emAndamento, ...naoComecou];
    
    ordenados.forEach((c, i) => {
        const bg = i % 2 === 0 ? '#f8f9fa' : '#fff';
        const funcao = c.function + (c.brand ? ' - ' + c.brand : '');
        const avaliacoesAprovadas = c.avaliacoes.filter(e => e.passed).length;
        
        html += `
            <tr style="background:${bg};">
                <td style="padding:12px;border-bottom:1px solid #eee;font-weight:500;">${c.name}</td>
                <td style="padding:12px;border-bottom:1px solid #eee;">${funcao}</td>
                <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;">${avaliacoesAprovadas}/${c.avaliacoes.length}</td>
                <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;">${c.quizDias}/5 dias</td>
                <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;">${c.badges}</td>
                <td style="padding:12px;border-bottom:1px solid #eee;text-align:center;color:${c.statusColor};font-weight:bold;">${c.statusText}</td>
            </tr>
        `;
    });
    
    html += '</tbody></table></div>';
    
    output.innerHTML = html;
    output.scrollIntoView({ behavior: 'smooth' });
}

// ========== EXPORTAR PARA EXCEL (CSV) ==========
function exportToExcel() {
    // Criar CSV com dados dos colaboradores
    let csv = 'Nome,Função,Marca,Código,Pontos,Badges,Avaliações,Média,Quiz Dias\n';
    
    trainees.forEach((t, idx) => {
        const avaliacoes = evalHistory.filter(e => e.traineeIndex === idx);
        const media = avaliacoes.length > 0 ? Math.round(avaliacoes.reduce((s, e) => s + e.score, 0) / avaliacoes.length) : 0;
        const quizDias = t.quizProgress ? Object.keys(t.quizProgress).length : 0;
        const badges = t.badges ? t.badges.length : 0;
        
        csv += `"${t.name}","${t.function}","${t.brand || ''}","${t.code}",${t.points || 0},${badges},${avaliacoes.length},${media},${quizDias}\n`;
    });
    
    // Adicionar aba de avaliações
    csv += '\n\nAVALIAÇÕES DETALHADAS\n';
    csv += 'Colaborador,Tipo,Marca,Nota,Status,Data\n';
    
    evalHistory.forEach(e => {
        csv += `"${e.traineeName}","${e.type}","${e.brand || ''}",${e.score},"${e.passed ? 'Aprovado' : 'Reprovado'}","${e.date}"\n`;
    });
    
    // Download
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'relatorio_treinamento_' + new Date().toISOString().split('T')[0] + '.csv';
    link.click();
    
    alert('✅ Arquivo CSV exportado com sucesso!\n\nAbra no Excel para visualizar os dados.');
}

// ========== EXPORTAR PARA PDF ==========
function exportToPDF() {
    // Gerar relatório visual primeiro
    generateReportVisaoGeral();
    
    setTimeout(() => {
        alert('📄 Para salvar como PDF:\n\n1. Clique em "Imprimir" no relatório\n2. Selecione "Salvar como PDF" na impressora\n3. Clique em Salvar\n\nOu use Ctrl+P e escolha "Salvar como PDF"');
    }, 500);
}

// ========== FUNÇÃO DE IMPRESSÃO ==========
function printReport() {
    const reportContent = document.getElementById('report-output').innerHTML;
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Relatório - Treinamento Grupo Ello</title>
            <style>
                body { font-family: 'Segoe UI', sans-serif; padding: 20px; }
                table { width: 100%; border-collapse: collapse; }
                th, td { padding: 10px; border: 1px solid #ddd; }
                th { background: #1e3c72; color: white; }
                @media print {
                    button { display: none !important; }
                }
            </style>
        </head>
        <body>
            <div style="text-align:center;margin-bottom:30px;">
                <h1 style="color:#1e3c72;">🎓 Grupo Ello - Treinamento T&D</h1>
            </div>
            ${reportContent}
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

// Modificar switchMode para chamar o dashboard
const originalSwitchMode = typeof switchMode === 'function' ? switchMode : null;

// Funções do Admin para gerenciar colaboradores
function selectTraineeToManage(){
    const sel=document.getElementById('admin-trainee-select');
    adminSelectedTrainee=sel.value?parseInt(sel.value):-1;
    if(adminSelectedTrainee>=0){
        const t=trainees[adminSelectedTrainee];
        document.getElementById('selected-trainee-info').style.display='block';
        document.getElementById('managing-name').textContent=t.name;
        document.getElementById('managing-function').textContent=t.function;
        document.getElementById('managing-brand').textContent=t.brand;
        document.getElementById('managing-points').textContent=t.points;
        document.getElementById('admin-badges-section').style.display='block';
        document.getElementById('admin-eval-section').style.display='block';
        document.getElementById('admin-quiz-section').style.display='block';
        renderAdminBadges();
        renderAdminEvalHistory();
        renderAdminQuizProgress();
    }else{
        document.getElementById('selected-trainee-info').style.display='none';
        document.getElementById('admin-badges-section').style.display='none';
        document.getElementById('admin-eval-section').style.display='none';
        document.getElementById('admin-quiz-section').style.display='none';
    }
}

function renderAdminBadges(){
    if(adminSelectedTrainee<0)return;
    const c=document.getElementById('admin-badges-container');
    const t=trainees[adminSelectedTrainee];
    let h='';
    
    // Lista de marcas válidas
    const marcasValidas = ['ECA USP', 'ESALQ/PECEGE', 'MACKENZIE', 'POLI'];
    
    for(const[k,cat]of Object.entries(badgeCategories)){
        // Verificar tipo de categoria
        const isB2BCategory = cat.isB2B === true;
        const isB2CCategory = cat.isB2C === true;
        const isBackofficeCategory = cat.isBackoffice === true;
        const isGeralCategory = k.startsWith('Geral');
        const isMarcaCategory = marcasValidas.includes(k);
        
        // Filtrar: mostrar apenas Geral + função + marca do colaborador selecionado
        const isSuaMarca = (k === t.brand);
        const isSubcategoriaFuncao = (t.function === 'B2B' && isB2BCategory) || 
                                     (t.function === 'B2C' && isB2CCategory) || 
                                     (t.function === 'Backoffice' && isBackofficeCategory);
        
        // Mostrar se: é Geral OU é a marca do colaborador OU é subcategoria da função dele
        const deveMostrar = isGeralCategory || isSuaMarca || isSubcategoriaFuncao;
        
        if(!deveMostrar) continue;
        
        // Determinar tag (Função, Marca ou Geral)
        let tag = 'Função';
        if(isGeralCategory) tag = 'Geral';
        else if(isMarcaCategory) tag = 'Marca';
        
        h+='<div class="category-section"><div class="category-header"><div class="category-icon">'+cat.icon+'</div><div class="category-info"><h3>'+cat.name+'</h3><p>'+cat.description+'</p></div></div><div class="badges-grid">';
        cat.badges.forEach(b=>{
            const u=t.badges.includes(b.id);
            h+='<div class="badge '+(u?'unlocked':'locked')+'" onclick="toggleAdminBadge(\''+b.id+'\')"><span class="badge-tag">'+tag+'</span><div class="badge-icon">'+b.icon+'</div><div class="badge-name">'+b.name+'</div><div class="badge-desc">'+b.desc+'</div><div class="badge-points">+'+b.points+'pts</div></div>';
        });
        h+='</div></div>';
    }
    c.innerHTML=h;
}

function toggleAdminBadge(id){
    if(adminSelectedTrainee<0)return;
    const t=trainees[adminSelectedTrainee];
    const i=t.badges.indexOf(id);
    if(i===-1)t.badges.push(id);
    else t.badges.splice(i,1);
    recalculatePoints(t);
    
    if(useFirebase && db && t.firebaseId) {
        db.collection('trainees').doc(t.firebaseId).update({
            badges: t.badges,
            points: t.points
        }).catch(e => console.log('Erro ao salvar badge:', e));
    } else {
        saveToLocalStorage();
    }
    
    renderAdminBadges();
    document.getElementById('managing-points').textContent=t.points;
    renderAdmin();
}

function renderAdminEvalHistory(){
    if(adminSelectedTrainee<0)return;
    const c=document.getElementById('admin-eval-history');
    const history=evalHistory.filter(e=>e.traineeIndex===adminSelectedTrainee);
    if(history.length===0){
        c.innerHTML='<div class="info-box"><strong>📋 Nenhuma avaliação registrada</strong><br>Este colaborador ainda não realizou avaliações.</div>';
        return;
    }
    // Encontrar índices originais no evalHistory
    const historyWithIndex=history.map(e=>{
        const origIndex=evalHistory.findIndex(x=>x===e);
        return {...e,origIndex};
    });
    let h='<div style="overflow-x:auto;"><table style="width:100%;border-collapse:collapse;"><thead><tr style="background:#1e3c72;color:white;"><th style="padding:12px;text-align:left;border-radius:8px 0 0 0;">Data</th><th style="padding:12px;text-align:left;">Tipo</th><th style="padding:12px;text-align:left;">Marca</th><th style="padding:12px;text-align:center;">Acertos</th><th style="padding:12px;text-align:center;">Nota</th><th style="padding:12px;text-align:center;">Status</th><th style="padding:12px;text-align:center;border-radius:0 8px 0 0;">Ações</th></tr></thead><tbody>';
    historyWithIndex.reverse().forEach((e,i)=>{
        const bg=i%2===0?'#f8f9fa':'white';
        const statusColor=e.passed?'#28a745':'#dc3545';
        const statusText=e.passed?'✅ Aprovado':'❌ Reprovado';
        h+='<tr style="background:'+bg+';"><td style="padding:12px;">'+e.date+'</td><td style="padding:12px;">'+e.type.toUpperCase()+'</td><td style="padding:12px;">'+(e.brand||'-')+'</td><td style="padding:12px;text-align:center;">'+e.correct+'/'+e.total+'</td><td style="padding:12px;text-align:center;font-weight:bold;">'+e.score+'%</td><td style="padding:12px;text-align:center;color:'+statusColor+';font-weight:bold;">'+statusText+'</td><td style="padding:12px;text-align:center;"><button class="btn-primary" style="padding:8px 16px;width:auto;" onclick="viewEvalDetails('+e.origIndex+')">👁️ Ver Respostas</button></td></tr>';
    });
    h+='</tbody></table></div>';
    h+='<div id="eval-details-container"></div>';
    c.innerHTML=h;
}

function renderAdminQuizProgress(){
    if(adminSelectedTrainee<0)return;
    const c=document.getElementById('admin-quiz-progress');
    const t=trainees[adminSelectedTrainee];
    
    const completedDays = getCompletedDays(t);
    const totalPoints = getTotalQuizPoints(t);
    const streak = getQuizStreak(t);
    const history = getQuizHistory(t);
    
    let h = '';
    
    // Progresso visual dos dias
    h += '<div style="margin-bottom:20px;">';
    h += '<p style="font-weight:bold;margin-bottom:10px;">Progresso: ' + completedDays.length + '/5 dias completos</p>';
    h += '<div style="display:flex;gap:10px;margin-bottom:15px;">';
    for(let d=1; d<=5; d++){
        const completed = completedDays.includes(d);
        h += '<div style="width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:18px;';
        h += completed ? 'background:#28a745;color:white;">' : 'background:#e0e0e0;color:#666;">';
        h += completed ? '✓' : d;
        h += '</div>';
    }
    h += '</div>';
    h += '</div>';
    
    // Stats
    h += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:20px;">';
    h += '<div style="background:#f8f9fa;padding:15px;border-radius:10px;text-align:center;">';
    h += '<div style="font-size:24px;font-weight:bold;color:#1e3c72;">' + totalPoints + '</div>';
    h += '<div style="font-size:12px;color:#666;">Pontos do Quiz</div>';
    h += '</div>';
    h += '<div style="background:#f8f9fa;padding:15px;border-radius:10px;text-align:center;">';
    h += '<div style="font-size:24px;font-weight:bold;color:#1e3c72;">' + streak + '</div>';
    h += '<div style="font-size:12px;color:#666;">🔥 Dias Perfeitos</div>';
    h += '</div>';
    h += '<div style="background:#f8f9fa;padding:15px;border-radius:10px;text-align:center;">';
    h += '<div style="font-size:24px;font-weight:bold;color:#1e3c72;">' + (75 - totalPoints) + '</div>';
    h += '<div style="font-size:12px;color:#666;">Pontos Restantes</div>';
    h += '</div>';
    h += '</div>';
    
    // Histórico detalhado
    if(history.length > 0){
        h += '<h4 style="margin-bottom:10px;color:#1e3c72;">📋 Histórico de Respostas</h4>';
        h += '<div style="overflow-x:auto;"><table style="width:100%;border-collapse:collapse;">';
        h += '<thead><tr style="background:#667eea;color:white;">';
        h += '<th style="padding:10px;text-align:left;">Data</th>';
        h += '<th style="padding:10px;text-align:center;">Dia</th>';
        h += '<th style="padding:10px;text-align:center;">Acertos</th>';
        h += '<th style="padding:10px;text-align:center;">Pontos</th>';
        h += '</tr></thead><tbody>';
        history.forEach((item, i) => {
            const bg = i % 2 === 0 ? '#f8f9fa' : 'white';
            h += '<tr style="background:' + bg + ';">';
            h += '<td style="padding:10px;">' + item.date + '</td>';
            h += '<td style="padding:10px;text-align:center;">Dia ' + item.day + '</td>';
            h += '<td style="padding:10px;text-align:center;">' + item.correct + '/3</td>';
            h += '<td style="padding:10px;text-align:center;font-weight:bold;color:#28a745;">+' + item.points + '</td>';
            h += '</tr>';
        });
        h += '</tbody></table></div>';
    } else {
        h += '<div class="info-box"><strong>📋 Nenhum quiz respondido</strong><br>Este colaborador ainda não respondeu o quiz diário.</div>';
    }
    
    c.innerHTML = h;
}

function viewEvalDetails(evalIndex){
    const e=evalHistory[evalIndex];
    if(!e||!e.answers){
        alert('Esta avaliação não possui respostas salvas (formato antigo).');
        return;
    }
    const c=document.getElementById('eval-details-container');
    let h='<div class="eval-card" style="margin-top:25px;"><h2 class="section-title">📋 Detalhes da Avaliação - '+e.traineeName+'</h2>';
    h+='<div class="info-box" style="background:#e7f3ff;border-color:#0066cc;margin-bottom:20px;"><strong style="color:#004085;">📅 '+e.date+'</strong> | '+e.type.toUpperCase()+(e.brand?' - '+e.brand:'')+' | Nota: <strong id="nota-atual-'+evalIndex+'">'+e.score+'%</strong> ('+(e.passed?'Aprovado':'Reprovado')+')</div>';
    
    // Separar questões objetivas e dissertativas
    const objetivas=[];
    const dissertativas=[];
    for(const[key,ans] of Object.entries(e.answers)){
        if(ans.tipo==='text'){
            dissertativas.push({key,ans});
        }else{
            objetivas.push({key,ans});
        }
    }
    
    // Questões Objetivas
    if(objetivas.length>0){
        h+='<h3 style="color:#1e3c72;margin:20px 0 15px;border-bottom:2px solid #1e3c72;padding-bottom:10px;">📊 Questões Objetivas ('+e.correct+'/'+e.total+')</h3>';
        objetivas.forEach(({key,ans})=>{
            const statusIcon=ans.acertou?'✅':'❌';
            const statusBg=ans.acertou?'#d4edda':'#f8d7da';
            const statusBorder=ans.acertou?'#28a745':'#dc3545';
            h+='<div class="question" style="border-left-color:'+statusBorder+';background:'+statusBg+';">';
            h+='<div class="question-header"><span class="question-number">'+key.toUpperCase()+'</span><span class="question-type">'+ans.tema+' '+statusIcon+'</span></div>';
            h+='<div class="question-text">'+ans.pergunta+'</div>';
            h+='<div style="margin-top:10px;">';
            ans.opcoes.forEach((opt,idx)=>{
                const wasSelected=ans.selecionadas.includes(idx);
                const isCorrect=ans.corretas.includes(idx);
                let style='padding:8px 12px;margin:4px 0;border-radius:6px;';
                if(wasSelected&&isCorrect)style+='background:#28a745;color:white;';
                else if(wasSelected&&!isCorrect)style+='background:#dc3545;color:white;';
                else if(!wasSelected&&isCorrect)style+='background:#ffc107;color:#333;';
                else style+='background:#e9ecef;color:#666;';
                const icon=wasSelected?(isCorrect?'✓':'✗'):(isCorrect?'●':'○');
                h+='<div style="'+style+'">'+icon+' '+opt+'</div>';
            });
            h+='</div></div>';
        });
    }
    
    // Questões Dissertativas com botões de correção
    if(dissertativas.length>0){
        h+='<h3 style="color:#1e3c72;margin:30px 0 15px;border-bottom:2px solid #1e3c72;padding-bottom:10px;">📝 Questões Dissertativas ('+dissertativas.length+') - Correção Manual</h3>';
        h+='<p style="color:#666;margin-bottom:15px;font-size:13px;">⚠️ Marque cada questão como Correta ou Incorreta. A nota será recalculada automaticamente incluindo as dissertativas.</p>';
        dissertativas.forEach(({key,ans})=>{
            const corrigida = ans.corrigida !== undefined;
            const correta = ans.corrigida === true;
            const statusBg = corrigida ? (correta ? '#d4edda' : '#f8d7da') : '#fff';
            const statusBorder = corrigida ? (correta ? '#28a745' : '#dc3545') : '#667eea';
            h+='<div class="question" id="diss-'+evalIndex+'-'+key+'" style="border-left-color:'+statusBorder+';background:'+statusBg+';">';
            h+='<div class="question-header"><span class="question-number">'+key.toUpperCase()+'</span><span class="question-type">'+ans.tema+'</span></div>';
            h+='<div class="question-text">'+ans.pergunta+'</div>';
            h+='<div style="background:white;padding:15px;border-radius:8px;margin-top:10px;border:2px solid #e0e0e0;min-height:60px;">';
            h+=ans.resposta?'<p style="color:#333;white-space:pre-wrap;">'+ans.resposta+'</p>':'<p style="color:#999;font-style:italic;">Não respondida</p>';
            h+='</div>';
            h+='<div style="margin-top:15px;display:flex;gap:10px;">';
            h+='<button onclick="corrigirDissertativa('+evalIndex+',\''+key+'\',true)" class="btn-primary" style="background:'+(corrigida && correta ? '#28a745' : '#6c757d')+';padding:10px 20px;width:auto;flex:1;">✅ Correta</button>';
            h+='<button onclick="corrigirDissertativa('+evalIndex+',\''+key+'\',false)" class="btn-primary" style="background:'+(corrigida && !correta ? '#dc3545' : '#6c757d')+';padding:10px 20px;width:auto;flex:1;">❌ Incorreta</button>';
            h+='</div>';
            if(corrigida){
                h+='<div style="margin-top:10px;padding:8px;background:'+(correta?'#28a745':'#dc3545')+';color:white;border-radius:6px;text-align:center;font-weight:bold;">'+(correta?'✅ Marcada como CORRETA':'❌ Marcada como INCORRETA')+'</div>';
            }
            h+='</div>';
        });
    }
    
    h+='<button class="btn-secondary" style="margin-top:20px;" onclick="document.getElementById(\'eval-details-container\').innerHTML=\'\';">✖️ Fechar Detalhes</button>';
    h+='</div>';
    c.innerHTML=h;
    c.scrollIntoView({behavior:'smooth'});
}

async function corrigirDissertativa(evalIndex, questionKey, correta) {
    const e = evalHistory[evalIndex];
    if (!e || !e.answers || !e.answers[questionKey]) return;
    
    // Marcar como corrigida
    e.answers[questionKey].corrigida = correta;
    
    // Contar objetivas e dissertativas
    let totalObjetivas = 0;
    let acertosObjetivas = 0;
    let totalDissertativas = 0;
    let totalDissertativasCorrigidas = 0;
    let acertosDissertativas = 0;
    
    for (const [key, ans] of Object.entries(e.answers)) {
        if (ans.tipo === 'text') {
            totalDissertativas++;
            if (ans.corrigida !== undefined) {
                totalDissertativasCorrigidas++;
                if (ans.corrigida === true) acertosDissertativas++;
            }
        } else {
            totalObjetivas++;
            if (ans.acertou) acertosObjetivas++;
        }
    }
    
    // Calcular porcentagem de cada tipo
    const pctObjetivas = totalObjetivas > 0 ? (acertosObjetivas / totalObjetivas) * 100 : 0;
    const pctDissertativas = totalDissertativasCorrigidas > 0 ? (acertosDissertativas / totalDissertativasCorrigidas) * 100 : 0;
    
    // Nota = média das duas porcentagens (só considera dissertativas se pelo menos 1 foi corrigida)
    let novaNota;
    if (totalDissertativasCorrigidas > 0) {
        novaNota = Math.round((pctObjetivas + pctDissertativas) / 2);
    } else {
        novaNota = Math.round(pctObjetivas);
    }
    const aprovado = novaNota >= 70;
    
    // Atualizar registro
    e.score = novaNota;
    e.passed = aprovado;
    e.correct = acertosObjetivas;
    e.total = totalObjetivas;
    e.correctDissertativas = acertosDissertativas;
    e.totalDissertativas = totalDissertativas;
    e.totalDissertativasCorrigidas = totalDissertativasCorrigidas;
    e.pctObjetivas = Math.round(pctObjetivas);
    e.pctDissertativas = Math.round(pctDissertativas);
    
    // Salvar no Firebase
    const trainee = trainees[e.traineeIndex];
    if (useFirebase && db && trainee && trainee.firebaseId) {
        const traineeEvalHistory = trainee.evalHistory || [];
        const evalInTrainee = traineeEvalHistory.find(ev => ev.date === e.date && ev.type === e.type);
        if (evalInTrainee) {
            Object.assign(evalInTrainee, {
                answers: e.answers,
                score: e.score,
                passed: e.passed,
                correctDissertativas: e.correctDissertativas,
                totalDissertativas: e.totalDissertativas,
                totalDissertativasCorrigidas: e.totalDissertativasCorrigidas,
                pctObjetivas: e.pctObjetivas,
                pctDissertativas: e.pctDissertativas
            });
        }
        await db.collection('trainees').doc(trainee.firebaseId).update({
            evalHistory: traineeEvalHistory
        });
    } else {
        saveToLocalStorage();
    }
    
    // Atualizar apenas a questão específica visualmente (sem fechar a tela)
    const questionDiv = document.getElementById('diss-' + evalIndex + '-' + questionKey);
    if (questionDiv) {
        const statusBg = correta ? '#d4edda' : '#f8d7da';
        const statusBorder = correta ? '#28a745' : '#dc3545';
        questionDiv.style.background = statusBg;
        questionDiv.style.borderLeftColor = statusBorder;
        
        // Atualizar botões
        const buttons = questionDiv.querySelectorAll('button');
        if (buttons.length >= 2) {
            buttons[0].style.background = correta ? '#28a745' : '#6c757d';
            buttons[1].style.background = !correta ? '#dc3545' : '#6c757d';
        }
        
        // Adicionar ou atualizar status
        let statusDiv = questionDiv.querySelector('.correcao-status');
        if (!statusDiv) {
            statusDiv = document.createElement('div');
            statusDiv.className = 'correcao-status';
            statusDiv.style.cssText = 'margin-top:10px;padding:8px;color:white;border-radius:6px;text-align:center;font-weight:bold;';
            questionDiv.appendChild(statusDiv);
        }
        statusDiv.style.background = correta ? '#28a745' : '#dc3545';
        statusDiv.textContent = correta ? '✅ Marcada como CORRETA' : '❌ Marcada como INCORRETA';
    }
    
    // Atualizar nota e detalhes no cabeçalho
    const infoBox = document.querySelector('#eval-details-container .info-box');
    if (infoBox) {
        const statusText = aprovado ? 'Aprovado' : 'Reprovado';
        const statusColor = aprovado ? '#28a745' : '#dc3545';
        let detalhes = '<strong style="color:#004085;">📅 '+e.date+'</strong> | '+e.type.toUpperCase()+(e.brand?' - '+e.brand:'');
        detalhes += '<br><span style="font-size:13px;">📊 Objetivas: '+acertosObjetivas+'/'+totalObjetivas+' ('+Math.round(pctObjetivas)+'%)';
        detalhes += ' | 📝 Dissertativas: '+acertosDissertativas+'/'+totalDissertativasCorrigidas+' ('+Math.round(pctDissertativas)+'%)</span>';
        detalhes += '<br><strong style="font-size:18px;color:'+statusColor+';">Nota Final: '+novaNota+'% - '+statusText+'</strong>';
        infoBox.innerHTML = detalhes;
    }
    
    console.log('Dissertativa corrigida:', questionKey, correta ? 'CORRETA' : 'INCORRETA');
    console.log('Objetivas:', acertosObjetivas+'/'+totalObjetivas+' = '+Math.round(pctObjetivas)+'%');
    console.log('Dissertativas:', acertosDissertativas+'/'+totalDissertativasCorrigidas+' = '+Math.round(pctDissertativas)+'%');
    console.log('Nota Final (média):', novaNota+'%');
}

function exportTraineeReport(){
    if(adminSelectedTrainee<0){
        alert('Selecione um colaborador primeiro!');
        return;
    }
    const t=trainees[adminSelectedTrainee];
    const history=evalHistory.filter(e=>e.traineeIndex===adminSelectedTrainee);
    
    // Calcular totais possíveis (pontos e badges) APENAS para função e marca do colaborador
    const marcasValidas = ['ECA USP', 'ESALQ/PECEGE', 'MACKENZIE', 'POLI'];
    let totalBadgesPossiveis = 0;
    let totalPontosPossiveis = 0;
    
    for(const[k,cat] of Object.entries(badgeCategories)){
        const isB2BCategory = cat.isB2B === true;
        const isB2CCategory = cat.isB2C === true;
        const isBackofficeCategory = cat.isBackoffice === true;
        const isGeralCategory = k.startsWith('Geral');
        
        const isSuaMarca = k === t.brand;
        const isSubcategoriaFuncao = (t.function === 'B2B' && isB2BCategory) || 
                                     (t.function === 'B2C' && isB2CCategory) || 
                                     (t.function === 'Backoffice' && isBackofficeCategory);
        
        const deveMostrar = isGeralCategory || isSuaMarca || isSubcategoriaFuncao;
        
        if(deveMostrar){
            totalBadgesPossiveis += cat.badges.length;
            cat.badges.forEach(b => {
                totalPontosPossiveis += b.points;
            });
        }
    }
    
    // Obter badges conquistados com detalhes
    const badgesConquistados=[];
    t.badges.forEach(id=>{
        for(const[catKey,cat] of Object.entries(badgeCategories)){
            const b=cat.badges.find(x=>x.id===id);
            if(b){
                badgesConquistados.push({
                    categoria:cat.name,
                    nome:b.name,
                    descricao:b.desc,
                    pontos:b.points,
                    icon:b.icon
                });
                break;
            }
        }
    });
    
    // Criar HTML do relatório
    let html=`
    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <title>Relatório - ${t.name}</title>
        <style>
            *{margin:0;padding:0;box-sizing:border-box;}
            body{font-family:'Segoe UI',sans-serif;padding:40px;background:#f5f5f5;}
            .report{max-width:800px;margin:0 auto;background:white;padding:40px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
            .header{text-align:center;border-bottom:3px solid #1e3c72;padding-bottom:20px;margin-bottom:30px;}
            .header h1{color:#1e3c72;font-size:24px;margin-bottom:5px;}
            .header p{color:#666;font-size:14px;}
            .section{margin-bottom:30px;}
            .section-title{color:#1e3c72;font-size:18px;border-bottom:2px solid #e0e0e0;padding-bottom:10px;margin-bottom:15px;}
            .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
            .info-item{background:#f8f9fa;padding:15px;border-radius:8px;}
            .info-label{font-size:12px;color:#666;text-transform:uppercase;margin-bottom:5px;}
            .info-value{font-size:18px;font-weight:bold;color:#333;}
            .badge-item{display:flex;align-items:center;padding:10px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;}
            .badge-icon{font-size:24px;margin-right:15px;}
            .badge-info{flex:1;}
            .badge-name{font-weight:bold;color:#333;}
            .badge-desc{font-size:12px;color:#666;}
            .badge-points{background:#1e3c72;color:white;padding:4px 10px;border-radius:12px;font-size:12px;}
            .eval-item{background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;}
            .eval-info{flex:1;}
            .eval-date{font-weight:bold;color:#333;}
            .eval-type{font-size:12px;color:#666;}
            .eval-score{font-size:24px;font-weight:bold;}
            .eval-score.passed{color:#28a745;}
            .eval-score.failed{color:#dc3545;}
            .summary{background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);color:white;padding:20px;border-radius:10px;text-align:center;margin-top:30px;}
            .summary h3{margin-bottom:15px;}
            .summary-grid{display:flex;justify-content:space-around;}
            .summary-item{text-align:center;}
            .summary-value{font-size:32px;font-weight:bold;}
            .summary-label{font-size:12px;opacity:0.8;}
            .no-data{color:#999;font-style:italic;padding:20px;text-align:center;}
            .print-btn{background:#1e3c72;color:white;border:none;padding:12px 30px;border-radius:8px;font-size:14px;cursor:pointer;margin-top:20px;}
            @media print{.print-btn{display:none;}}
        </style>
    </head>
    <body>
        <div class="report">
            <div class="header">
                <h1>📋 Relatório do Colaborador</h1>
                <p>Grupo Ello - T&D - Trilha de Aprendizagem T&D</p>
                <p style="margin-top:10px;font-size:12px;color:#999;">Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
            </div>
            
            <div class="section">
                <h2 class="section-title">👤 Dados do Colaborador</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Nome</div>
                        <div class="info-value">${t.name}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Função</div>
                        <div class="info-value">${t.function}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Marca</div>
                        <div class="info-value">${t.brand}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Total de Pontos</div>
                        <div class="info-value">${t.points} de ${totalPontosPossiveis} possíveis</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">🏅 Conquistas de Badges (${badgesConquistados.length} de ${totalBadgesPossiveis} possíveis)</h2>
                ${badgesConquistados.length>0?badgesConquistados.map(b=>`
                    <div class="badge-item">
                        <div class="badge-icon">${b.icon}</div>
                        <div class="badge-info">
                            <div class="badge-name">${b.nome}</div>
                            <div class="badge-desc">${b.categoria} - ${b.descricao}</div>
                        </div>
                        <div class="badge-points">+${b.pontos} pts</div>
                    </div>
                `).join(''):'<div class="no-data">Nenhum badge conquistado ainda.</div>'}
            </div>
            
            <div class="section">
                <h2 class="section-title">📝 Histórico de Avaliações (${history.length})</h2>
                ${history.length>0?history.map(e=>{
                    // Calcular nota correta (média objetivas + dissertativas)
                    let notaExibir = e.score;
                    let detalhesNota = 'Acertos: '+e.correct+'/'+e.total;
                    if(e.pctObjetivas !== undefined && e.pctDissertativas !== undefined && e.totalDissertativasCorrigidas > 0) {
                        detalhesNota = 'Obj: '+e.pctObjetivas+'% | Diss: '+e.pctDissertativas+'%';
                    }
                    // Buscar depoimento da avaliação do treinamento
                    let depoimento = '';
                    if(e.answers) {
                        for(const[key,ans] of Object.entries(e.answers)) {
                            if(ans.tipo === 'text' && ans.tema && ans.tema.includes('Avaliação do Treinamento') && ans.resposta) {
                                depoimento = ans.resposta;
                                break;
                            }
                        }
                    }
                    return `
                    <div class="eval-item" style="flex-direction:column;align-items:stretch;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="eval-info">
                                <div class="eval-date">${e.date}</div>
                                <div class="eval-type">${e.type.toUpperCase()}${e.brand?' - '+e.brand:''} | ${detalhesNota}</div>
                            </div>
                            <div class="eval-score ${e.passed?'passed':'failed'}">${notaExibir}%</div>
                        </div>
                        ${depoimento ? `
                        <div style="margin-top:12px;padding:12px;background:#f8f9fa;border-left:4px solid #667eea;border-radius:4px;">
                            <div style="font-size:12px;color:#666;margin-bottom:5px;">💬 Feedback sobre o treinamento:</div>
                            <div style="color:#333;font-style:italic;">"${depoimento}"</div>
                        </div>
                        ` : ''}
                    </div>
                `}).join(''):'<div class="no-data">Nenhuma avaliação realizada ainda.</div>'}
            </div>
            
            <div class="summary">
                <h3>📊 Resumo Geral</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value">${t.points}/${totalPontosPossiveis}</div>
                        <div class="summary-label">Pontos Conquistados</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${badgesConquistados.length}/${totalBadgesPossiveis}</div>
                        <div class="summary-label">Badges Conquistados</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${history.length}</div>
                        <div class="summary-label">Avaliações Realizadas</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${history.length>0?Math.round(history.reduce((s,e)=>s+e.score,0)/history.length):0}%</div>
                        <div class="summary-label">Média das Avaliações</div>
                    </div>
                </div>
            </div>
            
            <center><button class="print-btn" onclick="window.print()">🖨️ Imprimir Relatório</button></center>
        </div>
    </body>
    </html>`;
    
    // Abrir em nova janela
    const win=window.open('','_blank');
    win.document.write(html);
    win.document.close();
}
    </script>
</body>
</html>
